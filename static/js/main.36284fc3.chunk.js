(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,function(e,t,i){"use strict";i(68),i(33);var r=i(19);i.d(t,"CenterApi",function(){return r.a}),i.d(t,"UnitxApi",function(){return r.b}),i.d(t,"UsqApi",function(){return r.c}),i.d(t,"loadAppUsqs",function(){return r.h}),i.d(t,"meInFrame",function(){return r.j}),i.d(t,"postWsToTop",function(){return r.k});var n=i(30);i.o(n,"Controller")&&i.d(t,"Controller",function(){return n.Controller}),i.o(n,"Field")&&i.d(t,"Field",function(){return n.Field}),i.o(n,"Form")&&i.d(t,"Form",function(){return n.Form}),i.o(n,"Loading")&&i.d(t,"Loading",function(){return n.Loading}),i.o(n,"NavView")&&i.d(t,"NavView",function(){return n.NavView}),i.o(n,"Page")&&i.d(t,"Page",function(){return n.Page}),i.o(n,"TabCaptionComponent")&&i.d(t,"TabCaptionComponent",function(){return n.TabCaptionComponent}),i.o(n,"Tabs")&&i.d(t,"Tabs",function(){return n.Tabs}),i.o(n,"VPage")&&i.d(t,"VPage",function(){return n.VPage}),i.o(n,"View")&&i.d(t,"View",function(){return n.View}),i.o(n,"nav")&&i.d(t,"nav",function(){return n.nav}),i.o(n,"resLang")&&i.d(t,"resLang",function(){return n.resLang});i(31);var s=i(78);i.d(t,"PageItems",function(){return s.a});i(79)},,function(e,t,i){"use strict";var r,n=i(3),s=i(12),o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),a=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},l=function(){function e(e){this.formView=e}return e.prototype.render=function(){return n.createElement("div",{className:"col-sm-10"},this.renderControl())},Object.defineProperty(e.prototype,"hasError",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filled",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.clear=function(){},e.prototype.clearErrors=function(){},e.prototype.readValues=function(e){},e.prototype.setError=function(e,t){},e.prototype.setInitValues=function(e){},e.prototype.isOk=function(){return this.validate(),!this.hasError},e.prototype.validate=function(){},a([s.d],e.prototype,"hasError",null),a([s.d],e.prototype,"filled",null),e}(),c=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.field=i,n.face=r,n.init(),n.setProps(),n}return o(t,e),t.prototype.ref=function(e){this.element=e},t.prototype.init=function(){var e;this.rules=[];var t=this.field.rules;void 0!==t&&(!0===Array.isArray(t)?(e=this.rules).push.apply(e,t):this.rules.push(t))},t.prototype.setProps=function(){return this.props={ref:this.ref.bind(this),name:this.field.name}},Object.defineProperty(t.prototype,"hasError",{get:function(){return void 0!==this.error},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filled",{get:function(){return void 0!==this.value&&this.value!==this.field.defaultValue},enumerable:!0,configurable:!0}),t.prototype.clearValue=function(){this.value=void 0},t.prototype.clear=function(){this.clearErrors(),this.clearValue()},t.prototype.clearErrors=function(){this.isOK=void 0,this.error=void 0},t.prototype.readValues=function(e){e[this.field.name]=this.value},t.prototype.setError=function(e,t){},t.prototype.setInitValues=function(e){},t.prototype.getValueFromElement=function(){return this.value},t.prototype.validate=function(){try{var e=this.getValueFromElement();if(this.rules.length>0){for(var t=void 0,i=0,r=this.rules;i<r.length;i++){var n=r[i];console.log("validate: %s",e);var s=n(e);if(console.log("validate: %s err: %s",e,s),!0===s)this.error=void 0,t=!0;else if(void 0!==s)return this.error=s,void(this.isOK=!1)}this.isOK=t}this.value=e}catch(o){this.error=o.message}},t.prototype.render=function(){var e;if(void 0!==this.face){var t=this.face.notes;void 0!==t&&(e=n.createElement("small",{className:"text-muted"},t))}return n.createElement("div",{className:"col-sm-10"},this.renderControl(),e)},a([s.k],t.prototype,"isOK",void 0),a([s.k],t.prototype,"error",void 0),a([s.k],t.prototype,"value",void 0),a([s.d],t.prototype,"hasError",null),a([s.d],t.prototype,"filled",null),t}(l),u=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),h=function(e){function t(t){var i=e.call(this,t)||this;return i.otherClick=i.otherClick.bind(i),i}return u(t,e),t.prototype.otherClick=function(){var e=this.formView.props.onOther;void 0!==e&&e(this.formView.readValues())},t.prototype.renderControl=function(){console.log("buttons.renderControl");var e=this.formView.nothing,t=this.formView.hasError,i=this.formView.props;console.log("buttons.renderControl nothing:%s hasError:%s",e,t);var r,s=i.submitButton,o=i.otherButton;i.onOther;return void 0!==o&&(r=n.createElement("button",{className:"btn btn-outline-info ml-auto",onClick:this.otherClick},o)),n.createElement("div",{className:"d-flex justify-content-start"},n.createElement("button",{className:"btn btn-primary",type:"submit",disabled:e||t},s||"\u63d0\u4ea4"),r)},t}(l),d=i(21),p=i(5),m=i.n(p),f=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),v=function(){return(v=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return f(t,e),t.prototype.init=function(){e.prototype.init.call(this),!0===this.field.required&&this.rules.push(function(e){return null!==e&&void 0!==e&&0!==e.trim().length||"\u5fc5\u987b\u586b\u5165\u8981\u6c42\u5185\u5bb9"})},t.prototype.getValueFromElement=function(){return this.parseValue(this.element.value)},t.prototype.setProps=function(){e.prototype.setProps.call(this),d.assign(this.props,{onBlur:this.onBlur.bind(this),onFocus:this.onFocus.bind(this),onChange:this.onChange.bind(this)});var t=this.face;return void 0!==t&&d.assign(this.props,{placeholder:t.placeholder}),this.props},t.prototype.parseValue=function(e){return e},t.prototype.onBlur=function(){this.validate()},t.prototype.onChange=function(){console.log("onChange"),this.validate()},t.prototype.onFocus=function(){this.clearErrors()},t.prototype.className=function(){return p({"form-control":!0,"has-success":!0===this.isOK,"is-invalid":void 0!==this.error,"is-valid":void 0===this.error&&!0===this.isOK})},t.prototype.renderInput=function(){return n.createElement("input",v({className:this.className()},this.props))},t.prototype.ref=function(t){e.prototype.ref.call(this,t),t&&(t.value=void 0===this.value?"":this.value)},t.prototype.renderError=function(){return void 0===this.error?null:n.createElement("div",{className:"invalid-feedback"},this.error)},t.prototype.clearValue=function(){e.prototype.clearValue.call(this),this.element.value=""},t.prototype.setError=function(e,t){this.field.name===e&&(this.error=t)},t.prototype.setInitValues=function(e){var t=e[this.field.name];void 0!==t&&(this.value=t)},t.prototype.renderControl=function(){return n.createElement(n.Fragment,null,this.renderInput(),this.renderError())},t}(c),y=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return y(t,e),t.prototype.setProps=function(){var t=e.prototype.setProps.call(this);return d.assign(t,{type:"text",maxLength:this.field.maxLength}),t},t.prototype.parseValue=function(e){if(void 0!==e&&0!==e.trim().length)return e},t}(g),w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return y(t,e),t.prototype.setProps=function(){var t=e.prototype.setProps.call(this);return d.assign(t,{type:"password",maxLength:this.field.maxLength}),t},t}(b),E=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return E(t,e),t.prototype.init=function(){e.prototype.init.call(this),this.extraChars=[];var t=this.field,i=t.min,r=t.max;switch(void 0!==i?(this.rules.push(function(e){if(void 0!==e)return!(e<i)||"\u6700\u5c0f\u503c\u4e3a"+i}),i<0&&this.extraChars.push(45)):this.extraChars.push(45),void 0!==r&&this.rules.push(function(e){if(void 0!==e)return!(e>r)||"\u6700\u5927\u503c\u4e3a"+r}),this.field.type){case"dec":case"number":this.extraChars.push(46)}},t.prototype.parseValue=function(e){if(void 0!==e&&0!==e.trim().length){var t=Number.parseFloat(e);if(isNaN(t))throw new Error("\u65e0\u6548\u7684\u6570\u5b57");return t}},t.prototype.setProps=function(){e.prototype.setProps.call(this),d.assign(this.props,{type:"number",step:this.field.step,onKeyPress:this.onKeyPress.bind(this)})},t.prototype.onKeyPress=function(e){var t=e.charCode;if(!(8===t||0===t||13===t||t>=48&&t<=57))if(void 0!==this.extraChars&&this.extraChars.indexOf(t)>=0)switch(t){case 46:this.onKeyDot();break;case 45:this.onKeyNeg(),e.preventDefault()}else e.preventDefault()},t.prototype.onKeyDot=function(){var e=this.element.value;e.indexOf(".")>=0&&(this.element.value=e.replace(".",""))},t.prototype.onKeyNeg=function(){var e=this.element.value,t=e.indexOf("-");e=t>=0?e.replace("-",""):"-"+e,this.element.value=e},t}(g),k=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),N=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t.prototype.init=function(){e.prototype.init.call(this);var t=this.field,i=t.trueValue,r=t.falseValue;void 0===i&&(this.trueValue=1),void 0===r&&(this.falseValue=0)},t.prototype.setProps=function(){e.prototype.setProps.call(this),d.assign(this.props,{onChange:this.onChange.bind(this)})},t.prototype.clearValue=function(){this.element.checked=this.field.defaultValue===this.trueValue,this.value=this.getValueFromElement()},t.prototype.setInitValues=function(e){var t=e[this.field.name];void 0===t&&(t=this.field.defaultValue)},t.prototype.getValueFromElement=function(){return this.element.checked?this.trueValue:this.falseValue},t.prototype.onChange=function(){this.value=this.getValueFromElement()},t.prototype.renderControl=function(){return n.createElement("div",{className:"form-control-static"},n.createElement("label",{className:"form-control"},n.createElement("label",{className:"custom-control custom-checkbox mb-0"},n.createElement("input",{type:"checkbox",name:this.field.name,ref:this.props.ref,onChange:this.props.onChange,className:"custom-control-input"}),n.createElement("span",{className:"custom-control-indicator"}),n.createElement("span",{className:"custom-control-description"},this.face.label))))},t}(c),x=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),S=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return x(t,e),t.prototype.renderControl=function(){var e=this;return n.createElement("div",{className:"form-control-static"},n.createElement("div",{className:"form-control"},this.face.list.map(function(t,i){var r;return"object"!==typeof t?r=t:(r=t.text,t.value),n.createElement("label",{key:i,className:"custom-control custom-radio w-25"},n.createElement("input",{type:"radio",name:e.field.name,className:"custom-control-input"}),n.createElement("span",{className:"custom-control-indicator"}),n.createElement("span",{className:"custom-control-description"},r))})))},t}(c),P=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),O=function(){return(O=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},F=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return P(t,e),t.prototype.setProps=function(){var t=e.prototype.setProps.call(this),i=this.field.maxLength,r=this.face.rows;return d.assign(t,{maxLength:i,rows:r}),t},t.prototype.renderInput=function(){var e=this;return n.createElement("textarea",O({ref:function(t){e.el=t,void 0!==t&&(t.value="")},className:this.className()},this.props))},t}(g),V=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),A=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.ref=n.ref.bind(n),n}return V(t,e),t.prototype.getValueFromElement=function(){var e=this.element,t=(e.selectedIndex,e.selectedOptions[0].value);switch(this.field.type){case"number":t=Number(t);break;case"date":t=new Date(t);break;case"bool":"string"===typeof t&&(t="true"===t.toLowerCase())}return t},t.prototype.renderControl=function(){var e=this.face.list,t=[];return void 0===this.face.default&&t.push(n.createElement("option",{key:-1,value:void 0},"\u8bf7\u9009\u62e9")),t.push.apply(t,e.map(function(e,t){var i,r;return"object"!==typeof e?i=r=e:(i=e.text,r=e.value),n.createElement("option",{key:t,value:r},i)})),n.createElement("div",{className:"form-control-static"},n.createElement("select",{name:this.field.name,className:"form-control",ref:this.ref},t))},t}(c),I=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return I(t,e),t.prototype.renderControl=function(){return n.createElement("div",{className:"form-control-plaintext"},n.createElement("div",{className:"alert alert-primary",role:"alert"},"don't know how to create control",n.createElement("br",null),"field: ",JSON.stringify(this.field)," must be object ",n.createElement("br",null),"face: ",JSON.stringify(this.face)," must be object ",n.createElement("br",null)))},t}(c),q=function(e){function t(t,i){var r=e.call(this,t)||this;return r.element=i,r}return I(t,e),t.prototype.renderControl=function(){return n.createElement("div",{className:"form-control-plaintext"},this.element)},t}(l),j=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),R=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},D=function(e,t,i,r){return new(i||(i=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(t){s(t)}}function a(e){try{l(r.throw(e))}catch(t){s(t)}}function l(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(o,a)}l((r=r.apply(e,t||[])).next())})},U=function(e,t){var i,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(a){s=[6,a],r=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(){return D(t,void 0,void 0,function(){var e,t,i,r,n,s,o;return U(this,function(a){switch(a.label){case 0:return e=this.face,t=e.pick,i=e.fromPicked,[4,t(this.face,this.formView.props,this.formView.readValues())];case 1:return void 0===(r=a.sent())?(this.value=void 0,[2]):void 0===i?(this.value=r.id,[2]):(n=i(r),s=n.id,o=n.caption,this.value=s,this.caption=o,[2])}})})},t.onPicked=function(e){t.value=e.id},t}return j(t,e),t.prototype.setInitValues=function(e){var t=e[this.field.name];this.value=t},t.prototype.controlContent=function(){var e=this.face,t=e.itemFromId,i=e.fromPicked,r=e.initCaption;if(void 0===this.value)return r||"\u8bf7\u9009\u62e9Id";if(void 0!==this.caption)return this.caption;if(void 0!==t&&void 0!==i){var n=t(this.value);if(n){var s=i(n);if(void 0!==s)return s.caption}}return String(this.value)},t.prototype.renderControl=function(){var e=this.face,t=e.tuid,i=e.input;return void 0===i?n.createElement("div",{className:"form-control-plaintext px-2 border text-primary rounded cursor-pointer",onClick:this.onClick},this.controlContent()):n.createElement("div",{className:"form-control-static "},n.createElement(i.component,{id:this.value,ui:t}))},R([s.k],t.prototype,"caption",void 0),t}(c),M=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),_=function(){return(_=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},B=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},H=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.onIdChanged=n.onIdChanged.bind(n),n}return M(t,e),t.prototype.onIdChanged=function(e){this.value=e.id},t.prototype.setInitValues=function(e){var t=e[this.field.name];this.value=t},t.prototype.buildContent=function(){var e=this;return n.createElement(this.face.input.component,_({},this.face,{id:this.value,onFormValues:function(){return e.formView.readValues()},onIdChanged:this.onIdChanged}))},t.prototype.renderControl=function(){return n.createElement("div",{className:"form-control-static "},this.buildContent())},B([s.k],t.prototype,"caption",void 0),t}(c),K=i(20),W=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Q=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},J=function(e,t,i,r){return new(i||(i=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(t){s(t)}}function a(e){try{l(r.throw(e))}catch(t){s(t)}}function l(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(o,a)}l((r=r.apply(e,t||[])).next())})},z=function(e,t){var i,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(a){s=[6,a],r=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},X=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(){return J(t,void 0,void 0,function(){var e,t,i,r,n,s,o;return z(this,function(a){switch(a.label){case 0:return e=this.face,t=e.pick,i=e.fromPicked,[4,t(this.face,this.formView.props,this.formView.readValues())];case 1:return void 0===(r=a.sent())?(this.value=void 0,[2]):(n=i(r),s=n.id,o=n.caption,this.value=s,this.caption=o,[2])}})})},t.view=Object(K.a)(function(){var e,i=t.face.content;return e=void 0===t.value||null===t.value?"\u8bf7\u9009\u62e9":n.createElement(i,{id:t.value}),n.createElement("div",{className:"form-control-plaintext px-2 border text-primary rounded cursor-pointer bg-light",onClick:t.onClick},e)}),t}return W(t,e),t.prototype.setInitValues=function(e){var t=e[this.field.name];this.value=t},t.prototype.renderControl=function(){return n.createElement(this.view,null)},Q([s.k],t.prototype,"caption",void 0),t}(c),Z=function(e,t){t.label;return void 0!==t.group?function(e,t,i){return new T(e,i,void 0)}(e,0,t):void 0!==t.field?function(e,t,i){var r=i.field,n=i.face;switch(typeof r){case"string":r={name:r,type:"string"};break;case"object":break;default:return new T(e,r,n)}var s=r.type||"string";if(void 0===n){if(void 0===(n=Y[s]))return new T(e,r,n)}else if(void 0===n.type){var o=Y[s];n.type=void 0===o?"string":o.type}return new(G[n.type||s]||T)(e,r,n)}(e,0,t):new q(e,t.help)},G={string:b,password:w,number:C,checkbox:N,radiobox:S,select:A,"pick-id":L,"pick-tuid":H,textarea:F,pick:X},Y={string:{type:"string"},number:{type:"number"},int:{type:"number"},dec:{type:"number"},bool:{type:"checkbox"}};var $=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ee=function(){function e(e,t){if(this.form=e,this.row=t,void 0===t.type){var i=t.createControl;void 0===i&&(i=e.createControl),void 0===i&&(i=Z),this.control=i(e,t)}}return e.prototype.isOk=function(){return void 0===this.control||this.control.isOk()},e.prototype.contains=function(e){var t=this.row.field;if(void 0!==t)return e===t.name;var i=this.row.group;return void 0!==i&&void 0!==i.find(function(t){return t.field.name===e})},Object.defineProperty(e.prototype,"hasError",{get:function(){return this.control.hasError},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filled",{get:function(){return this.control.filled},enumerable:!0,configurable:!0}),e.prototype.clear=function(){void 0!==this.control&&this.control.clear()},e.prototype.clearErrors=function(){void 0!==this.control&&this.control.clearErrors()},e.prototype.readValues=function(e){void 0!==this.control&&this.control.readValues(e)},e.prototype.setError=function(e,t){void 0!==this.control&&this.control.setError(e,t)},e.prototype.setInitValues=function(e){void 0!==this.control&&this.control.setInitValues(e)},e}(),te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype.render=function(e){return n.createElement("div",{key:e,className:"form-group"},this.row)},Object.defineProperty(t.prototype,"hasError",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filled",{get:function(){return!1},enumerable:!0,configurable:!0}),t}(ee),ie=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype.render=function(e){return n.createElement("div",{key:e,className:"form-group row"},n.createElement("label",{className:"col-sm-2 col-form-label"},this.row.label),this.control.render())},t}(ee);function re(e,t){return new ie(e,t)}function ne(e,t){return new te(e,t)}var se="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",oe=8;function ae(){for(var e=se.length,t="",i=0;i<oe;i++)t+=se.charAt(Math.floor(Math.random()*e));return t}var le=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},ce=function(e,t,i,r){return new(i||(i=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(t){s(t)}}function a(e){try{l(r.throw(e))}catch(t){s(t)}}function l(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(o,a)}l((r=r.apply(e,t||[])).next())})},ue=function(e,t){var i,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(a){s=[6,a],r=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},he=function(){function e(e){this.rows=[],this.uid=ae(),this.props=e,this.buildRows(e),this.createControl=e.createControl,this.onSubmit=this.onSubmit.bind(this)}return Object.defineProperty(e.prototype,"hasError",{get:function(){var e=this.rows.map(function(e,t){return t+": "+e.hasError+"\n"});return console.log(e),this.rows.some(function(e){return e.hasError})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nothing",{get:function(){return this.rows.every(function(e){return!e.filled})},enumerable:!0,configurable:!0}),e.prototype.readValues=function(){for(var e={},t=0,i=this.rows;t<i.length;t++){i[t].readValues(e)}return e},e.prototype.clear=function(){for(var e=0,t=this.rows;e<t.length;e++){t[e].clear()}},e.prototype.clearErrors=function(){for(var e=0,t=this.rows;e<t.length;e++){t[e].clearErrors()}},e.prototype.setError=function(e,t){for(var i=0,r=this.rows;i<r.length;i++){r[i].setError(e,t)}},e.prototype.setInitValues=function(e){if(void 0!==e)for(var t=0,i=this.rows;t<i.length;t++){i[t].setInitValues(e)}},e.prototype.buildRows=function(e){var t=e.formRows,i=e.createRow;if(void 0!==t){for(var r=0,s=t;r<s.length;r++){var o=s[r];this.rows.push(this.buildRow(o,i))}!0!==this.props.readOnly&&(this.buttonsRow=this.buildRow({createControl:this.createButtons.bind(this)},void 0))}else this.rows.push(ne(this,n.createElement("div",{className:"text-warning"},"TonvaForm need formRows defined")))},e.prototype.buildRow=function(e,t){var i;return void 0!==e.type?i=ne:void 0===(i=e.createRow)&&void 0===(i=t)&&(i=re),i(this,e)},e.prototype.createButtons=function(e,t){return new h(e)},e.prototype.isOk=function(){for(var e=!0,t=0,i=this.rows;t<i.length;t++){i[t].isOk()||(e=!1)}return e},e.prototype.render=function(){var e=this;return n.createElement("form",{onSubmit:this.onSubmit},this.rows.map(function(t,i){return t.render(e.uid+i)}),this.buttons())},e.prototype.buttons=function(){if(void 0!==this.buttonsRow)return this.buttonsRow.render(this.uid+this.rows.length)},e.prototype.onSubmit=function(e){return ce(this,void 0,void 0,function(){var t;return ue(this,function(i){switch(i.label){case 0:return e.preventDefault(),this.isOk()?(t=this.readValues(),[4,this.props.onSubmit(t)]):[2];case 1:return i.sent(),[2]}})})},le([s.d],e.prototype,"hasError",null),le([s.d],e.prototype,"nothing",null),e}(),de=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),pe=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};var me=function(e){function t(t){var i=e.call(this,t)||this;return i.formView=new he(i.props),i}return de(t,e),t.prototype.componentWillMount=function(){this.formView.setInitValues(this.props.initValues)},t.prototype.debug=function(){},t.prototype.render=function(){var e=this.props,t=e.className,i=e.children;e.initValues;return n.createElement("div",{className:t},void 0===i?this.formView.render():n.createElement("form",{onSubmit:this.formView.onSubmit},i))},t=pe([K.a],t)}(n.Component),fe=i(46),ve=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ge=(function(e){function t(t){var i=e.call(this,t)||this;return i.toggle=function(){i.setState({dropdownOpen:!i.state.dropdownOpen})},i.state={dropdownOpen:!1},i}ve(t,e),t.prototype.render=function(){var e=this.props,t=e.icon,i=e.actions,r=e.isRight;void 0===r&&(r=!0);var s=i.some(function(e){return void 0!==e.icon});return n.createElement(fe.d,{isOpen:this.state.dropdownOpen,toggle:this.toggle},n.createElement(fe.c,{caret:!0,size:"sm",className:"cursor-pointer"},n.createElement("i",{className:p("fa","fa-"+(t||"ellipsis-v"))})),n.createElement(fe.b,{right:r},i.map(function(e,t){var i,r=e.icon,o=e.caption,a=e.action;return void 0===r&&void 0===o?n.createElement("div",{className:"dropdown-divider"}):(!0===s&&(void 0!==r&&(r="fa-"+r),i=n.createElement(n.Fragment,null,n.createElement("i",{className:p("fa",r,"fa-fw"),"aria-hidden":!0}),"\xa0 ")),void 0===a?n.createElement("h6",{className:"dropdown-header"},i," ",o):n.createElement(fe.a,{key:t,onClick:a},i," ",o))})))}}(n.Component),function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}()),ye=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ge(t,e),t.prototype.render=function(){var e=this.props.date;if(!e)return null;var t="string"===typeof e?new Date(Date.parse(e)):e,i=new Date,r=i.getTime()-t.getTime(),n=i.getDate(),s=t.getDate(),o=t.getHours(),a=t.getMinutes(),l=t.getMonth()+1,c=o+(a<10?":0":":")+a;return r<-864e5?t.getFullYear()+"\u5e74"+l+"\u6708"+s+"\u65e5 "+c:r<864e5?s!==n?(r<0?"\u660e\u5929 ":"\u6628\u5929 ")+c:c:r<31536e6?l+"\u6708"+s+"\u65e5 ":t.getFullYear()+"\u5e74"+l+"\u6708"+s+"\u65e5"},t}(n.Component),be=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),we=function(){function e(){}return e.prototype.setValues=function(e){},e}(),Ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return be(t,e),t.prototype.render=function(e){return n.createElement("div",{key:"_b_"+e,className:""},n.createElement("div",{className:"col-sm-12"},n.createElement("div",{style:{borderTop:"1px solid #f0f0f0"}})))},t}(we),Ce=function(e){function t(t){var i=e.call(this)||this;return i.param=t,i}return be(t,e),t.prototype.render=function(e){var t;switch(this.param){default:t="py-2";break;case"=":t="py-1";break;case"-":t="pb-1"}var i=p(t);return n.createElement("div",{key:"_g_"+e,className:i,style:{backgroundColor:"#f0f0f0"}})},t}(we),ke=function(e){function t(t,i){var r=e.call(this)||this;return r.gridProps=t,r.prop=i,r}return be(t,e),t.prototype.render=function(e){var t=this.prop,i=t.onClick,r=t.bk,s=p({"cursor-pointer":void 0!==i,"bg-white":void 0===r,row:!0});return n.createElement("div",{key:e,className:s,onClick:i},this.renderLabel(),this.renderProp())},t.prototype.renderLabel=function(){var e=this.prop.label;return void 0===e?null:n.createElement("label",{className:"col-sm-2 col-form-label"},e)},t.prototype.renderProp=function(){var e,t,i=this.prop,r=i.label,s=i.full;switch(this.gridProps.alignValue){case"left":e="justify-content-start";break;case"center":e="justify-content-center";break;case"right":e="justify-content-end"}switch(this.prop.vAlign){case"top":t="align-items-start";break;default:case"center":t="align-items-center";break;case"bottom":t="align-items-end";break;case"stretch":t="align-items-stretch"}var o=p(e,t,!0!==s?void 0===r?"col-sm-12":"col-sm-10":"w-100","d-flex");return n.createElement("div",{className:o},this.renderPropBody())},t.prototype.renderPropBody=function(){return n.createElement("div",{className:"form-control-plaintext"},this.renderPropContent())},t.prototype.renderPropContent=function(){return this.content},t}(we),Ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return be(t,e),t.prototype.setValues=function(e){this.content=void 0===e?void 0:e[this.prop.name]},t}(ke),xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return be(t,e),t.prototype.setValues=function(e){this.content=void 0===e?void 0:e[this.prop.name]},t}(ke),Se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return be(t,e),t.prototype.setValues=function(e){if(void 0===e)this.content=void 0;else{var t=this.prop.list;this.content="string"===typeof t?e[t]:void 0}},t.prototype.renderPropBody=function(){var e=this.prop,t=e.list,i=e.row,r="string"===typeof t?this.content:t;return void 0===r?n.createElement("div",null):n.createElement("div",{className:"w-100"},r.map(function(e,t){return n.createElement(n.Fragment,{key:t},0===t?null:n.createElement("div",{style:{width:"100%",borderBottom:"1px solid #f0f0f0"}}),n.createElement(i,e))}))},t}(ke),Pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return be(t,e),t.prototype.renderPropBody=function(){return this.prop.component},t}(ke),Oe=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}be(t,e),t.prototype.render=function(e){return n.createElement("div",{className:"bg-white"},n.createElement("label",{className:"col-sm-2 col-form-label"},"AAABBBCCC"),n.createElement("div",{className:"col-sm-10"},n.createElement("div",{className:"form-control-plaintext"},"dsfasfa sdf asdf a")))}}(we),function(){function e(e,t){this.gridProps=e,this.props=t,this.buildRows()}return e.prototype.buildRows=function(){this.rows=[];for(var e=!0,t=0,i=this.props;t<i.length;t++){var r=i[t];if("string"===typeof r)this.rows.push(new Ce(r)),e=!0;else{e||this.rows.push(new Ee);var n=void 0;switch(r.type){default:continue;case"string":n=new Ne(this.gridProps,r);break;case"number":n=new xe(this.gridProps,r);break;case"list":n=new Se(this.gridProps,r);break;case"component":n=new Pe(this.gridProps,r)}this.rows.push(n),e=!1}}},e.prototype.setValues=function(e){for(var t=0,i=this.rows;t<i.length;t++){i[t].setValues(e)}},e.prototype.render=function(){return this.rows.map(function(e,t){return e.render(String(t))})},e}()),Fe=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Ve=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},Ae=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Fe(t,e),t.prototype.render=function(){var e=this.props,t=e.className,i=e.rows,r=e.values,s=new Oe(this.props,i);s.setValues(r);var o=p("container-fluid",t);return n.createElement("div",{className:o},s.render())},t=Ve([K.a],t)}(n.Component),Ie=(i(122),function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}()),Te=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},qe=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Ie(t,e),t.prototype.render=function(){var e,t=this.props,i=t.className,r=t.badge,s=t.size,o=t.color,a=t.badgeAlign,l=t.badgeVertical,c=t.children,u=p(i,"va-badge",s&&"va-badge-"+s,"va-badge-"+(o||"secondary"),a&&"va-badg-"+a,l&&"va-badg-"+l);return r&&(e=n.createElement("b",null,r)),n.createElement("div",{className:u},c,e)},t=Te([K.a],t)}(n.Component),i(124),function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}()),je=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},Re=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qe(t,e),t.prototype.render=function(){var e,t,i,r=this.props,s=r.className,o=r.left,a=r.children,l=r.right,c=r.onClick;return void 0!==o&&(e=n.createElement("header",null,o)),void 0!==l&&(t=n.createElement("footer",null,l)),void 0!==c&&(i="cursor-pointer"),n.createElement("div",{className:p("va-lmr",s,i),onClick:c},e,n.createElement("div",null,a),t)},t=je([K.a],t)}(n.Component),De=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return De(t,e),t.prototype.render=function(){var e=this.props,t=e.name,i=e.className,r=e.size,s=e.spin,o=e.fixWidth,a=e.border,l=e.pull,c=e.pulse,u=e.rotate,h=e.flip,d=e.inverse,m=p(i,"fa",t&&"fa-"+t,r&&"fa-"+r,o&&"fa-fw",a&&"fa-border",l&&"fa-pull-"+l,s&&"fa-spin",c&&"fa-pulse",u&&"fa-rotate-"+u,h&&"fa-flip-"+h,d&&"fa-inverse");return n.createElement("i",{className:m})},t}(n.Component),Le=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}De(t,e),t.prototype.render=function(){var e=this.props,t=e.className,i=e.size,r=e.children,s=p("fa-stack",t,i&&"fa-"+i);return n.createElement("span",{className:s},r)}}(n.Component),function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}()),Me=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Le(t,e),t.prototype.render=function(){var e=this.props,t=e.icon,i=e.iconClass,r=e.text,s=e.textClass;return n.createElement("div",{className:"py-2"},n.createElement(Ue,{className:i,name:t,fixWidth:!0}),n.createElement("span",{className:s},r))},t}(n.Component),_e=function(e){return n.createElement("small",{className:p("text-muted",e.className),style:e.style},e.children)},Be=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),He={width:"4rem",height:"4rem"},Ke=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Be(t,e),t.prototype.render=function(){var e,t=this.props,i=t.icon,r=t.main,s=t.discription,o=t.px,a=t.py;e="string"===typeof s?n.createElement("div",null,s):s;var l=i;"string"===typeof i&&(l=n.createElement("img",{className:"d-flex mr-3",src:i,alt:"img",style:He}));var c=p("media",void 0===o?"px-0":"px-"+o,void 0===a?"py-2":"py-"+a);return n.createElement("div",{className:c},l,n.createElement("div",{className:"media-body"},n.createElement("h5",{className:"mt-0"},r),e))},t}(n.Component),We=(i(126),function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}()),Qe=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},Je=function(e){function t(t){var i=e.call(this,t)||this;return i.state={pressed:!1},i}return We(t,e),t.prototype.render=function(){var e,t,i,r,s,o,a=this.props,l=(a.date,a.main),c=a.vice,u=a.middle,h=a.midSize,d=a.icon,m=a.unread,f=a.right,v=a.onClick;if(void 0!==m){var g=void 0;(g="number"===typeof m?m:m.get())>0?i=n.createElement("b",null,g):g<0&&(i=n.createElement("b",{className:"dot"}))}switch(typeof d){case"object":e=n.createElement("header",null,d,i),t=!1;break;case"string":e=n.createElement("header",{className:"icon"},n.createElement("img",{src:d}),i),t=!0}if(void 0!==u)switch(typeof u){case"string":r=n.createElement("div",{style:{flex:h}},u);break;default:r=u}void 0!==f&&(s="string"===typeof f?n.createElement("footer",null,n.createElement("small",{className:"text-muted"},f)):n.createElement("footer",null,f)),void 0!==c&&(o=n.createElement("span",null,c));var y=p("va-row",{icon:t,pressed:this.state.pressed},{"va-action":void 0!==v});return n.createElement("li",{className:y,onClick:v},e,n.createElement("div",null,n.createElement("div",null,l),o),r,s)},t=Qe([K.a],t)}(n.Component),ze=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Xe=function(){return(Xe=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Ze=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},Ge=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}ze(t,e),t.prototype.render=function(){var e,t,i=this,r=this.props,s=r.header,o=r.items,a=r.beforeLoad,l=r.none,c=r.renderRow,u=r.className,h=r.footer,d=r.itemClick,m=r.converter,f=p(u,"va-list");return e=void 0===o?null===a?null:n.createElement("li",{className:"empty"},a||"..."):0===o.length?n.createElement("li",{className:"empty"},l||"[none]"):void 0!==c?o.map(function(e,t){return c(e,t,i.props.ex)}):o.map(function(e,t){var i,r=e.onClick;if(void 0===r&&void 0!==d&&(r=function(){return d(e)}),void 0!==m){if(void 0===(i=m(e)))return null}else i=Xe({},e);return void 0===i.key&&(i.key=i.main),n.createElement(Je,Xe({onClick:r},i))}),void 0!==s&&(t="string"===typeof s?n.createElement("div",{className:"va-list-header"},s):s),n.createElement("div",{className:f},t,n.createElement("ul",null,e),h)},t=Ze([K.a],t)}(n.Component),function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}()),Ye=function(e,t,i,r){return new(i||(i=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(t){s(t)}}function a(e){try{l(r.throw(e))}catch(t){s(t)}}function l(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(o,a)}l((r=r.apply(e,t||[])).next())})},$e=function(e,t){var i,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(a){s=[6,a],r=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},et=function(e){function t(t){var i=e.call(this,t)||this;return i.onChange=function(e){i.key=e.target.value,void 0!==i.key&&(i.key=i.key.trim()),i.setState({disabled:!i.key})},i.ref=function(e){i.input=e,i.key=i.props.initKey||"",null!==e&&(e.value=i.key)},i.onSubmit=function(e){return Ye(i,void 0,void 0,function(){return $e(this,function(t){switch(t.label){case 0:return e.preventDefault(),this.key?(this.input&&(this.input.disabled=!0),[4,this.props.onSearch(this.key)]):[2];case 1:return t.sent(),this.input&&(this.input.disabled=!1),[2]}})})},i.state={disabled:!1},i}return Ge(t,e),t.prototype.render=function(){var e,t,i=this.props,r=i.className,s=i.label,o=i.placeholder,a=i.buttonText,l=i.maxLength;switch(i.size){default:case"sm":e="input-group-sm";break;case"md":e="input-group-md";break;case"lg":e="input-group-lg"}return void 0!==s&&(t=n.createElement("label",{className:"input-group-addon"},s)),n.createElement("form",{className:r,onSubmit:this.onSubmit},n.createElement("div",{className:p("input-group",e)},t,n.createElement("input",{onChange:this.onChange,type:"text",name:"key",ref:this.ref,className:"form-control",placeholder:o,maxLength:l}),n.createElement("div",{className:"input-group-append"},n.createElement("button",{className:"btn btn-primary",type:"submit",disabled:this.state.disabled},n.createElement("i",{className:"fa fa-search"}),n.createElement("i",{className:"fa"}),a))))},t}(n.Component),tt=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),it=function(){return(it=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},rt=(function(e){function t(t){var i=e.call(this,t)||this;return i.values={},i.stepViews=[],i.state={topView:void 0,stepViews:[]},i.onPrev=i.onPrev.bind(i),i.onNext=i.onNext.bind(i),i}tt(t,e),t.prototype.setStep=function(e){var t=this.props.steps[e];if(void 0!==t){var i,r;void 0!==this.topView&&this.stepViews.push(this.topView),this.stepViews.length>0&&(i=n.createElement(rt,{prefix:"undo",text:"\u4e0a\u4e00\u6b65"}),r=this.onPrev);var s=this.props,o=(s.header,s.footer,void 0===t.next?{prefix:"cloud-upload",text:this.props.submitButton||"\u63d0\u4ea4"}:{suffix:"arrow-right",text:"\u4e0b\u4e00\u6b65"}),a={formRows:t.formRows,submitButton:n.createElement(rt,it({},o)),onSubmit:this.onNext,otherButton:i,onOther:r};this.stepViews.length;this.topView={stepName:e,step:t,props:a},this.setState({topView:this.topView,stepViews:this.stepViews})}},t.prototype.componentWillMount=function(){this.setStep(this.props.first)},t.prototype.onPrev=function(e){d.assign(this.values,e),this.topView=this.stepViews.pop(),this.setState({topView:this.topView,stepViews:this.stepViews})},t.prototype.onNext=function(e){d.assign(this.values,e);var t,i=this.topView.step.next;if(void 0===i)return this.props.onSubmit(this.values);t="string"===typeof i?i:i(this.values),this.setStep(t)},t.prototype.render=function(){var e=this.props,t=e.className,i=e.header,r=e.footer,s=this.state,o=s.topView,a=s.stepViews,l=o.stepName,c=o.step,u=a.length+1;return n.createElement("div",{className:t},n.createElement("div",null,i&&i(c,u),n.createElement(me,it({key:l,initValues:this.values},o.props)),r&&r(c,u)))}}(n.Component),function(e){var t,i,r=e.prefix,s=(e.text,e.suffix);return void 0!==r&&(t=n.createElement("i",{className:p("fa","fa-"+r)})),void 0!==s&&(i=n.createElement("i",{className:p("fa","fa-"+s)})),n.createElement(n.Fragment,null,t," ",e.text," ",i)}),nt=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},st=function(){function e(e){this.list=e}return Object.defineProperty(e.prototype,"isPaged",{get:function(){var e=this.list.props.items;return null!==e&&void 0!==e&&!1===Array.isArray(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){var e=this.list.props.items;return null===e?null:void 0!==e?!0===Array.isArray(e)?e:e.items:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loading",{get:function(){var e=this.list.props.items;if(null===e)return!1;if(void 0===e)return!0;var t=e;return void 0!==t.items&&t.loading},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedItems",{get:function(){},enumerable:!0,configurable:!0}),e.prototype.updateProps=function(e){},e.prototype.renderContent=function(e,t){var i=this.list.props.item.render;return void 0===i?n.createElement("div",{className:"px-3 py-2"},JSON.stringify(e)):i(e,t)},nt([s.d],e.prototype,"loading",null),e}(),ot=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),at=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ot(t,e),t.prototype.render=function(e,t){var i=this.list.props.item,r=i.className,s=i.key,o=i.onClick;return n.createElement("li",{key:void 0===s?t:s(e),className:p("va-row-clickable",r),onClick:function(){return o(e)}},this.renderContent(e,t))},t}(st),lt=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ct=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return lt(t,e),t.prototype.render=function(e,t){var i=this.list.props.item,r=i.className,s=i.key;i.render;if("string"===typeof e){var o=p("va-list-gap","px-3","pt-1");return n.createElement("li",{key:ae(),className:o},e)}return n.createElement("li",{key:void 0===s?t:s(e),className:p(r)},this.renderContent(e,t))},t}(st),ut=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ht=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},dt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ut(t,e),t.prototype.buildItems=function(){console.log("buildItems in selectable.tsx");var e,t=this.list.props,i=t.items,r=t.selectedItems,n=t.compare;return void 0===i?this._items=void 0:null===i?this._items=null:(e=!0===Array.isArray(i)?i:i.items,this._selectedItems=r,this._items=void 0===r?e.map(function(e){return{selected:!1,item:e,labelId:ae()}}):void 0===n?e.map(function(e){return{selected:void 0!==r.find(function(t){return t===e}),item:e,labelId:ae()}}):e.map(function(e){return{selected:void 0!==r.find(function(t){return n(e,t)}),item:e,labelId:ae()}}))},Object.defineProperty(t.prototype,"items",{get:function(){return this.buildItems(),this._items},enumerable:!0,configurable:!0}),t.prototype.updateProps=function(e){e.selectedItems!==this._selectedItems&&this.buildItems()},t.prototype.onSelect=function(e,t){e.selected=t;var i=this._items.some(function(e){return e.selected});this.list.props.item.onSelect(e.item,t,i)},Object.defineProperty(t.prototype,"selectedItems",{get:function(){return this._items.filter(function(e){return!0===e.selected}).map(function(e){return e.item})},enumerable:!0,configurable:!0}),t.prototype.render=function(e,t){var i=this,r=this.list.props.item,s=r.className,o=r.key,a=(r.render,r.onSelect,e.labelId),l=e.selected;return n.createElement("li",{key:void 0===o?t:o(e),className:p(s)},n.createElement("div",{className:"d-flex align-items-center px-3"},n.createElement("input",{ref:function(e){e&&(i.input=e,e.checked=l)},className:"",type:"checkbox",value:"",id:a,defaultChecked:l,onChange:function(t){i.onSelect(e,t.target.checked)}}),n.createElement("label",{className:"",style:{flex:1,marginBottom:0},htmlFor:a},this.renderContent(e.item,t))))},ht([s.d],t.prototype,"items",null),t}(st),pt=(i(128),function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}()),mt=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},ft=function(e){function t(t){var i=e.call(this,t)||this;i._$scroll=function(e){console.log("############### items scroll to "+e)};var r=i.props.item,n=r.onClick,s=r.onSelect;return i.listBase=void 0!==s?new dt(i):void 0!==n?new at(i):new ct(i),i}return pt(t,e),t.prototype.componentWillUpdate=function(e,t,i){this.listBase.updateProps(e)},Object.defineProperty(t.prototype,"selectedItems",{get:function(){return this.listBase.selectedItems},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this,t=this.props,i=t.className,r=t.header,s=t.footer,o=t.before,a=t.loading,l=t.none;t.item,t.selectedItems;void 0===o&&(o="before"),void 0===a&&(a="loading"),void 0===l&&(l="none");var c,u=this.listBase,h=(u.isPaged,u.items);u.loading;function d(e,t){if(e)switch(typeof e){default:case"string":return n.createElement("li",{className:"va-list-"+t},e);case"function":return n.createElement("li",{className:"va-list-"+t},e());case"object":return n.createElement("li",null,e)}}return c=null===h?d(o,"before"):void 0===h?d(a,"loading"):0===h.length?d(l,"none"):h.map(function(t,i){return e.listBase.render(t,i)}),n.createElement("ul",{className:m()("va-list",i)},d(r,"header"),c,d(s,"footer"))},t=mt([K.a],t)}(n.Component);i.d(t,"a",function(){return ye}),i.d(t,"h",function(){return Ae}),i.d(t,"d",function(){return Re}),i.d(t,"b",function(){return Ue}),i.d(t,"c",function(){return Me}),i.d(t,"g",function(){return _e}),i.d(t,"f",function(){return Ke}),i.d(t,"i",function(){return et}),i.d(t,"e",function(){return ft})},,function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"b",function(){return c});var r=i(2),n=i(4),s=i(34),o=i(50),a=i(51);class l extends a.a{constructor(e,t,i,r){super(e,r),Object.setPrototypeOf(this.x,e.x);let{name:n,typeName:s}=t;this.entity=t,this.ui=i,this.label=this.res.label||n,this.icon=o.a[s]}beforeStart(){const e=Object.create(null,{beforeStart:{get:()=>super.beforeStart}});return r.a(this,void 0,void 0,function*(){return!1!==(yield e.beforeStart.call(this))&&(yield this.entity.loadSchema(),!0)})}createForm(e,t,i){let r=this.buildFormOptions(i),n=new s.b(r,e);return n.setValues(t),n}buildFormOptions(e){let t,i,r,n,o,{fields:a,arrFields:l}=this.entity;void 0!==this.res&&(t=this.res.none,i=this.res.submit,r=this.res.arrNew,n=this.res.arrEdit,o=this.res.arrTitleNewButton),void 0===t&&(t=this.cUsq.res.none||"none"),void 0===i&&(i=this.cUsq.res.submit||"Submit"),void 0===r&&(r=this.cUsq.res.arrNew||"New"),void 0===n&&(n=this.cUsq.res.arrEdit||"Edit"),void 0===o&&(o=this.cUsq.res.arrTitleNewButton),void 0===e&&(e=s.a.new);let c=this.ui.form;return{fields:a,arrs:l,ui:c,res:this.res||{},inputs:this.buildInputs(c),none:t,submitCaption:i,arrNewCaption:r,arrEditCaption:n,arrTitleNewButton:o,mode:e}}buildInputs(e){let{fields:t,arrFields:i}=this.entity,r={};if(this.buildFieldsInputs(r,t,void 0,e),void 0!==i)for(let n of i){let{name:t,fields:i}=n,s=e&&e.items;this.buildFieldsInputs(r,i,t,s&&s[t])}return r}buildFieldsInputs(e,t,i,r){if(void 0!==i){let t=e[i];void 0===t&&(e[i]=t={},e=t)}for(let n of t){let{name:t,_tuid:s}=n;if(void 0===s)continue;let o=r&&r.items&&r.items[t];e[t]={select:this.buildSelect(n,i,o),content:this.buildContent(n,i),placeHolder:this.cUsq.getTuidPlaceHolder(s)}}}buildSelect(e,t,i){return(e,t,n)=>r.a(this,void 0,void 0,function*(){let{_tuid:r,_ownerField:n}=t,s=yield r.cSelectFrom(),o=void 0;void 0!==n&&(o=e.getValue(n.name)),i&&!0===i.autoList&&(console.log("select search set param=empty string"),o="");let a=yield s.call(o);if(s.removeCeased(),void 0===a)return;let l=s.idFromItem(a);return r.useId(l),l})}buildContent(e,t){}cQuerySelect(e){return this.cUsq.cQuerySelect(e)}}class c extends n.VPage{constructor(e){super(e),this.entity=e.entity,this.ui=e.ui}get label(){return this.controller.label}createForm(e,t,i){return this.controller.createForm(e,t,i)}}},,,,,function(e,t,i){"use strict";(function(e){i.d(t,"b",function(){return v}),i.d(t,"a",function(){return w}),i.d(t,"c",function(){return C});var r=i(2),n=i(0),s=i(7),o=i(33),a=i(37),l=i(64),c=i(85),u=i(22),h=i(86),d=i(19),p=(i(70),i(92),i(105),i(107),i(25)),m=i(38),f=i(48);const v=new RegExp("Android|webOS|iPhone|iPad|BlackBerry|Windows Phone|Opera Mini|IEMobile|Mobile","i").test(navigator.userAgent)?{minHeight:"3em"}:void 0;i(93);let g;const y=[];let b=1;class w extends n.Component{constructor(e){super(e),this.waitCount=0,this.isHistoryBack=!1,this.clearError=(()=>{this.setState({fetchError:void 0})}),this.back=this.back.bind(this),this.navBack=this.navBack.bind(this),this.stack=[],this.state={stack:this.stack,wait:0,fetchError:void 0}}componentWillMount(){return r.a(this,void 0,void 0,function*(){window.addEventListener("popstate",this.navBack)})}componentDidMount(){return r.a(this,void 0,void 0,function*(){C.set(this),yield C.start()})}get level(){return this.stack.length}startWait(){0===this.waitCount&&(this.setState({wait:1}),this.waitTimeHandler=e.setTimeout(()=>{this.waitTimeHandler=void 0,this.setState({wait:2})},1e3)),++this.waitCount,this.setState({fetchError:void 0})}endWait(){setTimeout(()=>{--this.waitCount,0===this.waitCount&&(void 0!==this.waitTimeHandler&&(clearTimeout(this.waitTimeHandler),this.waitTimeHandler=void 0),this.setState({wait:0}))},100)}onError(e){return r.a(this,void 0,void 0,function*(){let t=e.error;void 0===t||!0!==t.unauthorized?this.setState({fetchError:e}):yield C.showLogin()})}show(e,t){return this.clear(),this.push(e,t)}push(e,t){this.removeCeased(),this.stack.length>0&&window.history.pushState("forward",null,null);let i=b++;return this.stack.push({key:i,view:e,ceased:!1,disposer:t}),this.refresh(),i}replace(e,t){let i=void 0,r=this.stack;r.length>0&&(i=r.pop());let n=b++;return this.stack.push({key:n,view:e,ceased:!1,disposer:t}),void 0!==i&&this.dispose(i.disposer),this.refresh(),n}ceaseTop(e=1){let t=this.stack.length-1;for(let i=0;i<e&&!(t<0);i++,t--){this.stack[t].ceased=!0}}pop(e=1){let t=this.stack,i=t.length;if(e<=0||i<=1)return;i<e&&(e=i);let r=0;for(let n=0;n<e&&0!==t.length;n++)this.popAndDispose(),++r;r>=i&&r--,this.refresh(),this.isHistoryBack}popTo(e){throw new Error("to be designed")}removeCeased(){for(;;){let e=this.stack.length-1;if(e<0)break;if(!1===this.stack[e].ceased)break;let t=this.stack.pop(),{disposer:i}=t;this.dispose(i)}this.refresh()}popAndDispose(){this.removeCeased();let e=this.stack.pop();if(void 0===e)return;let{disposer:t}=e;return this.dispose(t),this.removeCeased(),e}dispose(e){if(void 0===e)return;void 0===this.stack.find(t=>t.disposer===e)&&e()}clear(){this.stack.length;for(;this.stack.length>0;)this.popAndDispose();this.refresh()}regConfirmClose(e){let t=this.stack,i=t.length;0!==i&&(t[i-1].confirmClose=e)}navBack(){C.log("backbutton pressed - nav level: "+this.stack.length),this.isHistoryBack=!0,this.back(!0),this.isHistoryBack=!1}back(e=!0){return r.a(this,void 0,void 0,function*(){let t=this.stack,i=t.length;if(0===i)return;if(1===i)return void(self!=window.top&&window.top.postMessage({type:"pop-app"},"*"));let r=t[i-1];!0===e&&r.confirmClose?!0===(yield r.confirmClose())&&this.pop():this.pop()})}confirmBox(e){return window.confirm(e)}render(){const{wait:e,fetchError:t}=this.state;let i=this.state.stack,r=i.length-1,s=null,o=null;switch(e){case 1:s=n.createElement("li",{className:"va-wait va-wait1"});break;case 2:s=n.createElement("li",{className:"va-wait va-wait2"},n.createElement("i",{className:"fa fa-spinner fa-spin fa-3x fa-fw"}),n.createElement("span",{className:"sr-only"},"Loading..."))}return t&&(o=n.createElement(c.a,Object.assign({clearError:this.clearError},t))),n.createElement("ul",{className:"va"},i.map((e,t)=>{let{key:i,view:s}=e;return n.createElement("li",{key:i,style:t<r?{visibility:"hidden"}:void 0},s)}),s,o)}refresh(){this.setState({stack:this.stack})}}class E{constructor(){this.local=new h.a,this.user=void 0;let{lang:e,district:t}=m.b;this.language=e,this.culture=t}get guest(){let e=this.local.guest;if(void 0===e)return 0;let t=e.get();return void 0===t?0:t.guest}set(e){this.nav=e}registerReceiveHandler(e){if(void 0!==this.ws)return this.ws.onWsReceiveAny(e)}unregisterReceiveHandler(e){void 0!==this.ws&&void 0!==e&&this.ws.endWsReceive(e)}onReceive(e){return r.a(this,void 0,void 0,function*(){void 0!==this.ws&&(yield this.ws.receive(e))})}getUnitName(){return r.a(this,void 0,void 0,function*(){try{let t=yield fetch("unit.json",{});return(yield t.json()).unit}catch(e){return void this.local.unit.clear()}})}loadUnit(){return r.a(this,void 0,void 0,function*(){let e,t=this.local.unit.get();if(void 0!==t){if(!0!==d.g)return t.id;if(void 0===(e=yield this.getUnitName()))return;if(t.name===e)return t.id}else if(void 0===(e=yield this.getUnitName()))return;let i=yield d.e.unitFromName(e);return void 0!==i&&this.local.unit.set({id:i,name:e}),i})}start(){return r.a(this,void 0,void 0,function*(){C.push(n.createElement(a.a,{header:!1},n.createElement(f.a,null))),yield d.f.start();let{url:e,ws:t}=d.f;this.centerHost=e,this.wsHost=t,Object(d.n)(e);let i=yield this.loadUnit();d.j.unit=i;let r=this.local.guest.get();void 0===r&&(r=yield d.e.guest()),C.setGuest(r);let s=document.location.hash;if(console.log("url=%s hash=%s",document.location.origin,s),this.isInFrame=void 0!==s&&""!==s&&s.startsWith("#tv"),!0===this.isInFrame){let e=Object(u.h)(s);if(void 0!==e)return this.ws=p.d,console.log("this.ws = wsBridge in sub frame"),void(self!==window.parent&&window.parent.postMessage({type:"sub-frame-started",hash:e.hash},"*"))}let o=this.local.user.get();if(void 0!==o)yield C.logined(o);else{let{notLogined:e}=this.nav.props;void 0!==e?yield e():yield C.showLogin()}})}showAppView(){return r.a(this,void 0,void 0,function*(){let{onLogined:e}=this.nav.props;void 0!==e?(C.clear(),yield e(),console.log("logined: AppView shown")):C.push(n.createElement("div",null,"NavView has no prop onLogined"))})}setGuest(e){this.local.guest.set(e),l.a.set(e.token)}logined(e){return r.a(this,void 0,void 0,function*(){(this.ws=new d.d(this.wsHost,e.token)).connect(),console.log("logined: %s",JSON.stringify(e)),this.local.user.set(e),l.a.set(e.token),this.user=new o.a(e),console.log("ws.connect() in app main frame"),yield this.showAppView()})}showLogin(e){return r.a(this,void 0,void 0,function*(){let t=yield i.e(1).then(i.bind(null,139)),r=n.createElement(t.default,{withBack:e});!0!==e&&(this.nav.clear(),this.pop()),this.nav.push(r)})}logout(e){return r.a(this,void 0,void 0,function*(){this.local.logoutClear(),this.user=void 0,Object(d.i)(),Object(u.f)();let t=this.local.guest.get();Object(d.m)(t&&t.token),this.ws=void 0,!0!==e&&(yield C.start())})}get level(){return this.nav.level}startWait(){this.nav.startWait()}endWait(){this.nav.endWait()}onError(e){return r.a(this,void 0,void 0,function*(){yield this.nav.onError(e)})}show(e,t){this.nav.show(e,t)}push(e,t){this.nav.push(e,t)}replace(e,t){this.nav.replace(e,t)}pop(e=1){this.nav.pop(e)}clear(){this.nav.clear()}navBack(){this.nav.navBack()}ceaseTop(e){this.nav.ceaseTop(e)}removeCeased(){this.nav.removeCeased()}back(e=!0){return r.a(this,void 0,void 0,function*(){yield this.nav.back(e)})}regConfirmClose(e){this.nav.regConfirmClose(e)}confirmBox(e){return this.nav.confirmBox(e)}navToApp(e,t,i,r,s){let o=!0===this.centerHost.includes("http://localhost:")?"sheet_debug":"sheet",a=void 0===s?Object(u.a)(e,t):Object(u.a)(e,t,o,[i,r,s]);console.log("navToApp: %s",JSON.stringify(a)),C.push(n.createElement("article",{className:"app-container"},n.createElement("span",{id:a.hash,onClick:()=>this.back(),style:v},n.createElement("i",{className:"fa fa-arrow-left"})),n.createElement("iframe",{src:a.url})))}navToSite(e){window.open(e)}get logs(){return y}log(e){y.push(e)}logMark(){let e=new Date;g=e.getTime(),y.push("log-mark: "+e.toTimeString())}logStep(e){y.push(e+": "+((new Date).getTime()-g))}}r.b([s.l],E.prototype,"user",void 0);const C=new E}).call(this,i(27))},,function(e,t,i){"use strict";i.d(t,"startApp",function(){return a});var r=i(2),n=i(0),s=i(39);i(40);i.o(s,"CApp")&&i.d(t,"CApp",function(){return s.CApp}),i.o(s,"tv")&&i.d(t,"tv",function(){return s.tv});i(52);var o=i(18);function a(e,t){return r.a(this,void 0,void 0,function*(){!function e(t){for(let i in t){let r=t[i];if(t[i.toLowerCase()]=r,"object"===typeof r&&!n.isValidElement(r))if(!0===Array.isArray(r))for(let t of r)e(t);else e(r)}}(t);let i=new(t&&t.CApp||s.CApp)(e,t||{usqs:{}});yield i.start()})}i.d(t,"tv",function(){return o.b})},function(e,t,i){"use strict";i.d(t,"c",function(){return c}),i.d(t,"b",function(){return u}),i.d(t,"a",function(){return h});var r=i(2),n=i(0),s=i(7),o=i(9);class a{constructor(e,t,i,r,s){if(this.widgets={},this.errors=[],this.errorWidgets=[],this.renderErrors=Object(o.a)(()=>{let{errors:e}=this;return 0===e.length?null:n.createElement(n.Fragment,null,e.map(e=>n.createElement("span",{key:e,className:"text-danger inline-block my-1 ml-3"},n.createElement("i",{className:"fa fa-exclamation-circle"})," \xa0",e)))}),this.form=e,this.uiSchema=t,this.initData=i,this.inNode=r,this.isRow=s,void 0!==t){let{rules:e}=t;void 0!==e&&(this.rules=[],!1===Array.isArray(e)?this.rules.push(e):this.rules.push(...e))}}getArrRowContexts(e){void 0===this.subContexts&&(this.subContexts={});let t=this.subContexts[name];return void 0===t&&(this.subContexts[name]=t={}),t}get arrName(){}getValue(e){return this.initData[e]}setValue(e,t){this.initData[e]=t;let i=this.widgets[e];void 0!==i&&i.setValue(t)}getDisabled(e){let t=this.widgets[e];if(void 0!==t)return t.getDisabled()}setDisabled(e,t){let i=this.widgets[e];void 0!==i&&i.setDisabled(t)}getReadOnly(e){let t=this.widgets[e];void 0!==t&&t.getReadOnly()}setReadOnly(e,t){let i=this.widgets[e];void 0!==i&&i.setReadOnly(t)}getVisible(e){let t=this.widgets[e];void 0!==t&&t.getVisible()}setVisible(e,t){let i=this.widgets[e];void 0!==i&&i.setVisible(t)}checkFieldRules(){for(let e in this.widgets)this.widgets[e].checkRules();if(void 0!==this.subContexts)for(let e in this.subContexts){let t=this.subContexts[e];for(let e in t)t[e].checkFieldRules()}}checkContextRules(){if(void 0!==this.rules){this.clearContextErrors();for(let e of this.rules){let t=e(this);if(void 0!==t)if(!0===Array.isArray(t))this.errors.push(...t);else if("string"===typeof t)this.errors.push(t);else for(let e in t)this.setError(e,t[e])}if(void 0!==this.subContexts)for(let e in this.subContexts){let t=this.subContexts[e];for(let e in t){let i=t[e];i.removeErrors(),i.checkContextRules()}}}}setError(e,t){let i=this.widgets[e];void 0!==i&&(i.setContextError(t),this.addErrorWidget(i))}clearContextErrors(){for(let e in this.widgets)this.widgets[e].clearContextError()}checkRules(){this.checkFieldRules(),this.checkContextRules()}addErrorWidget(e){this.errorWidgets.findIndex(t=>t===e)<0&&this.errorWidgets.push(e)}removeErrorWidget(e){let t=this.errorWidgets.findIndex(t=>t===e);t>=0&&this.errorWidgets.splice(t,1)}checkHasError(){if(!0===this.errorWidgets.length+this.errors.length>0)return!0;if(void 0===this.subContexts)return!1;for(let e in this.subContexts){let t=this.subContexts[e];for(let e in t)if(!0===t[e].hasError)return!0}return!1}get hasError(){return this.checkHasError()}removeErrors(){this.errors.splice(0),this.errorWidgets.splice(0);for(let e in this.widgets){let t=this.widgets[e];void 0!==t&&t.clearContextError()}}}r.b([s.l],a.prototype,"errors",void 0),r.b([s.l],a.prototype,"errorWidgets",void 0),r.b([s.e],a.prototype,"hasError",null);let l=1;class c extends a{constructor(e,t,i,r){let n,{uiSchema:s}=e;if(void 0!==s){let{items:e}=s;void 0!==e&&(n=e[t.name])}super(e.form,n,i,r,!0),this.parentContext=e,this.arrSchema=t,this.rowKey=l++,this.data=i}getItemSchema(e){return this.arrSchema.itemSchemas[e]}getUiItem(e){if(void 0===this.uiSchema)return;let{items:t}=this.uiSchema;return void 0!==t?t[e]:void 0}get arrName(){return this.arrSchema.name}removeErrors(){super.removeErrors(),this.parentContext.removeErrors()}}class u extends a{constructor(e,t){super(e,e.uiSchema,e.data,t,!1)}getItemSchema(e){return this.form.itemSchemas[e]}getUiItem(e){let{uiSchema:t}=this.form;if(void 0===t)return;let{items:i}=t;return void 0!==i?i[e]:void 0}}const h=n.createContext({})},function(e,t,i){"use strict";i.d(t,"d",function(){return o}),i.d(t,"b",function(){return a}),i.d(t,"a",function(){return l}),i.d(t,"c",function(){return c});var r=i(0),n=i(9),s=i(18);class o{render(e){return void 0===this.view?r.createElement("div",null,"??? viewModel \u5fc5\u987b\u5b9a\u4e49 view ???"):r.createElement(this.view,{vm:this,className:e})}}const a=(e,t)=>r.createElement(r.Fragment,null,"content: ",Object(s.a)(e)),l=Object(n.a)(a),c=e=>r.createElement("div",{className:"px-3 py-2"},Object(s.a)(e))},function(e,t,i){"use strict";function r(e,t){switch(e.substr(0,1)){default:return t;case"$":case"_":return}}function n(e){return JSON.stringify(e,r," ")}var s=i(0),o=i(9),a=i(39);const l=Object(o.a)(({tuidValue:e,ui:t,x:i,nullUI:r})=>{let n=typeof e;switch(n){default:return void 0===t?s.createElement(s.Fragment,null,n,"-",e):t(e,i);case"undefined":return void 0===r?s.createElement(s.Fragment,null,"null"):r();case"object":return null===e?void 0===r?s.createElement(s.Fragment,null,"null"):r():function(e,t,i){if("number"===typeof e)return s.createElement(s.Fragment,null,e);let{id:r,_$tuid:n,_$com:o}=e,l=n;if(void 0===l)return void 0!==t?t(e,i):Object(a.PureJSONContent)(e,i);let c=t||o;void 0===c&&(c=e._$com=l.getTuidContent());let u=l.valueFromId(r);return"number"===typeof u?s.createElement(s.Fragment,null,r):void 0!==t?t(u,i):s.createElement(c,u)}(e,t,i);case"number":return s.createElement(s.Fragment,null,"id...",e)}}),c=(e,t,i,r)=>s.createElement(l,{tuidValue:e,ui:t,x:i,nullUI:r});i.d(t,"a",function(){return n}),i.d(t,"b",function(){return c})},function(e,t,i){"use strict";var r=i(25),n=i(43),s=i(2),o=i(33),a=i(23);const l=new class extends a.a{guest(){return s.a(this,void 0,void 0,function*(){let e=yield this.get("",{});switch(typeof e){default:return;case"string":return Object(o.b)(e);case"object":return Object(o.b)(e.token)}})}unitFromName(e){return s.a(this,void 0,void 0,function*(){let t=yield this.get(e);return t&&t.unit})}}("tv/guest/",void 0);var c=i(22),u=i(28);i(35);i.d(t,"d",function(){return r.a}),i.d(t,"k",function(){return r.b}),i.d(t,"l",function(){return n.b}),i.d(t,"e",function(){return l}),i.d(t,"i",function(){return a.g}),i.d(t,"c",function(){return a.d}),i.d(t,"b",function(){return a.c}),i.d(t,"n",function(){return a.i}),i.d(t,"m",function(){return a.h}),i.d(t,"a",function(){return a.a}),i.d(t,"j",function(){return c.g}),i.d(t,"h",function(){return c.e}),i.d(t,"g",function(){return u.b}),i.d(t,"f",function(){return u.a})},,,function(e,t,i){"use strict";i.d(t,"f",function(){return d}),i.d(t,"g",function(){return m}),i.d(t,"d",function(){return f}),i.d(t,"h",function(){return v}),i.d(t,"a",function(){return g}),i.d(t,"e",function(){return y}),i.d(t,"b",function(){return b}),i.d(t,"c",function(){return E});var r=i(2),n=i(14),s=i.n(n),o=i(30),a=i(31),l=i(23),c=i(25),u=i(28);const h={};function d(){for(let e in h)h[e]=void 0}const p={};let m=new class{get unit(){return this._unit}set unit(e){this._unit=e}};function f(){return self!==window.parent}function v(e){let t=e.split("-"),i=t.length;return m.hash=t[0].substr(3),i>0&&(m.unit=Number(t[1])),i>1&&(m.page=t[2]),i>2&&(m.param=t.slice(3)),m}function g(e,t,i,r){let n;for(;;){if(n=Object(a.a)(),void 0===p[n]){p[n]={hash:n,unit:t};break}}if(e+="#tv"+n+"-"+t,void 0!==i&&(e+="-"+i,void 0!==r))for(let s=0;s<r.length;s++)e+="-"+r[s];return{url:e,hash:n}}function y(e,t){return r.a(this,void 0,void 0,function*(){let i=new l.b("tv/",void 0),r=m.unit;return yield i.usqs(r,e,t)})}function b(e,t,i){return r.a(this,void 0,void 0,function*(){let n=h[e];if(void 0!==n)return n;if(!f()){if(void 0===(n=yield l.j.usq({unit:m.unit,usqOwner:t,usqName:i}))){throw"unauthorized call: usqTokenApi center return undefined!"}void 0===n.token&&(n.token=l.f);let{url:r,urlDebug:s}=n,o=u.a.getUrlOrDebug(r,s);return console.log("realUrl: %s",o),n.url=o,h[e]=n,n}return console.log("appApi parent send: %s",m.hash),n={name:e,url:void 0,urlDebug:void 0,token:void 0,resolve:void 0,reject:void 0},h[e]=n,new Promise((t,i)=>{n.resolve=(e=>r.a(this,void 0,void 0,function*(){let i=yield e;console.log("return from parent window: %s",JSON.stringify(i)),n.url=i.url,n.urlDebug=i.urlDebug,n.token=i.token,t(n)})),n.reject=i,(window.opener||window.parent).postMessage({type:"app-api",apiName:e,hash:m.hash},"*")})})}window.addEventListener("message",function(e){return r.a(this,void 0,void 0,function*(){var t=e.data;switch(t.type){case"sub-frame-started":!function(e){var t=e.data;let i=e.source;Object(c.c)(i),function(e){let t=document.getElementById(e);void 0!==t&&(t.hidden=!0)}(t.hash);let r=s.a.clone(o.nav.user);r.type="init-sub-win",i.postMessage(r,"*")}(e);break;case"ws":yield o.nav.onReceive(t.msg);break;case"init-sub-win":yield function(e){return r.a(this,void 0,void 0,function*(){console.log("initSubWin: set nav.user",e),o.nav.user=e,yield o.nav.showAppView()})}(t);break;case"pop-app":o.nav.navBack();break;case"center-api":yield function(e,t){return r.a(this,void 0,void 0,function*(){let{callId:i,url:r,method:n,body:s}=t,o=yield l.e.directCall(r,n,s);e.postMessage({type:"center-api-return",callId:i,result:o},"*")})}(e.source,t);break;case"center-api-return":!function(e){let{callId:t,result:i}=e,r=w[t];if(void 0===r)return;w[t]=void 0,r.resolve(i)}(t);break;case"app-api":console.log("receive PostMessage: %s",JSON.stringify(t));let i=yield function(e,t){return r.a(this,void 0,void 0,function*(){let i=p[e];if(void 0===i)return{name:t,url:void 0,urlDebug:void 0,token:void 0};let{unit:r}=i,n=t.split("/"),s=yield l.j.usq({unit:r,usqOwner:n[0],usqName:n[1]});if(void 0===s)throw console.log("apiTokenApi.api return undefined. api=%s, unit=%s",t,r),"api not found";return{name:t,url:s.url,urlDebug:s.urlDebug,token:s.token}})}(t.hash,t.apiName);console.log("onReceiveAppApiMessage: %s",JSON.stringify(i)),e.source.postMessage({type:"app-api-return",apiName:t.apiName,url:i.url,urlDebug:i.urlDebug,token:i.token},"*");break;case"app-api-return":console.log("app-api-return: %s",JSON.stringify(t)),console.log("await onAppApiReturn(message);"),yield function(e){return r.a(this,void 0,void 0,function*(){let{apiName:t,url:i,urlDebug:r,token:n}=e,s=h[t];if(void 0===s)throw"error app api return";let o=u.a.getUrlOrDebug(i,r);console.log("onAppApiReturn(message:any): url="+i+", debug="+r+", real="+o),s.url=o,s.token=n,s.resolve(s)})}(t);break;default:this.console.log("message: %s",JSON.stringify(t))}})});const w={};function E(e,t,i){return r.a(this,void 0,void 0,function*(){return console.log("bridgeCenterApi: url=%s, method=%s",e,t),yield new Promise((n,s)=>r.a(this,void 0,void 0,function*(){let r;for(;;){if(r=Object(a.a)(),void 0===w[r]){w[r]={id:r,resolve:n,reject:s};break}}(window.opener||window.parent).postMessage({type:"center-api",callId:r,url:e,method:t,body:i},"*")}))})}},function(e,t,i){"use strict";var r=i(2),n=i(14),s=i.n(n),o=i(35),a=i(13);class l{startWait(){a.c.startWait()}endWait(){a.c.endWait()}showError(e){return r.a(this,void 0,void 0,function*(){a.c.endWait(),yield a.c.onError(e)})}}var c=i(22),u=i(43),h=i(28);i.d(t,"g",function(){return m}),i.d(t,"d",function(){return f}),i.d(t,"c",function(){return y}),i.d(t,"i",function(){return b}),i.d(t,"f",function(){return C}),i.d(t,"h",function(){return k}),i.d(t,"a",function(){return N}),i.d(t,"j",function(){return x}),i.d(t,"e",function(){return S}),i.d(t,"b",function(){return P});let d={},p={};function m(){d={},p={},g={}}class f extends u.a{constructor(e,t,i,r,n){super(e,n),i&&(this.usqOwner=t,this.usqName=i,this.usq=t+"/"+i),this.access=r,this.showWaiting=n}getHttpChannel(){return r.a(this,void 0,void 0,function*(){let e,t;!0===this.showWaiting||void 0===this.showWaiting?(e=d,t=new l):e=p;let i=e[this.usq];if(void 0!==i)return i;let r=yield Object(c.b)(this.usq,this.usqOwner,this.usqName);return this.token=r.token,i=new o.a(!1,r.url,r.token,t),e[this.usq]=i})}update(){return r.a(this,void 0,void 0,function*(){return yield this.get("update")})}loadAccess(){return r.a(this,void 0,void 0,function*(){let e=void 0===this.access?"":this.access.join("|");return yield this.get("access",{acc:e})})}loadEntities(){return r.a(this,void 0,void 0,function*(){return yield this.get("entities")})}schema(e){return r.a(this,void 0,void 0,function*(){return yield this.get("schema/"+e)})}schemas(e){return r.a(this,void 0,void 0,function*(){return yield this.post("schema",e)})}tuidGet(e,t){return r.a(this,void 0,void 0,function*(){return yield this.get("tuid/"+e+"/"+t)})}tuidGetAll(e){return r.a(this,void 0,void 0,function*(){return yield this.get("tuid-all/"+e+"/")})}tuidSave(e,t){return r.a(this,void 0,void 0,function*(){return yield this.post("tuid/"+e,t)})}tuidSearch(e,t,i,n,s,o){return r.a(this,void 0,void 0,function*(){return yield this.post("tuids/"+e,{arr:t,owner:i,key:n,pageStart:s,pageSize:o})})}tuidArrGet(e,t,i,n){return r.a(this,void 0,void 0,function*(){return yield this.get("tuid-arr/"+e+"/"+i+"/"+t+"/"+n)})}tuidArrGetAll(e,t,i){return r.a(this,void 0,void 0,function*(){return yield this.get("tuid-arr-all/"+e+"/"+i+"/"+t+"/")})}tuidArrSave(e,t,i,n){return r.a(this,void 0,void 0,function*(){return yield this.post("tuid-arr/"+e+"/"+i+"/"+t+"/",n)})}tuidArrPos(e,t,i,n,s){return r.a(this,void 0,void 0,function*(){return yield this.post("tuid-arr-pos/"+e+"/"+i+"/"+t+"/",{id:n,$order:s})})}tuidIds(e,t,i){return r.a(this,void 0,void 0,function*(){try{let n="tuidids/"+e+"/";return n+=void 0!==t?t:"$",yield this.post(n,i)}catch(r){console.error(r)}})}proxied(e,t,i){return r.a(this,void 0,void 0,function*(){try{let n="tuid-proxy/"+e+"/"+t+"/"+i;return yield this.get(n)}catch(r){console.error(r)}})}sheetSave(e,t){return r.a(this,void 0,void 0,function*(){return yield this.post("sheet/"+e,t)})}sheetAction(e,t){return r.a(this,void 0,void 0,function*(){return yield this.put("sheet/"+e,t)})}stateSheets(e,t){return r.a(this,void 0,void 0,function*(){return yield this.post("sheet/"+e+"/states",t)})}stateSheetCount(e){return r.a(this,void 0,void 0,function*(){return yield this.get("sheet/"+e+"/statecount")})}getSheet(e,t){return r.a(this,void 0,void 0,function*(){return yield this.get("sheet/"+e+"/get/"+t)})}sheetArchives(e,t){return r.a(this,void 0,void 0,function*(){return yield this.post("sheet/"+e+"/archives",t)})}sheetArchive(e,t){return r.a(this,void 0,void 0,function*(){return yield this.get("sheet/"+e+"/archive/"+t)})}action(e,t){return r.a(this,void 0,void 0,function*(){return yield this.post("action/"+e,t)})}page(e,t,i,n){return r.a(this,void 0,void 0,function*(){let r;switch(typeof n){case"undefined":r={key:""};break;default:r=s.a.clone(n)}return r.$pageStart=t,r.$pageSize=i,yield this.post("query-page/"+e,r)})}query(e,t){return r.a(this,void 0,void 0,function*(){return yield this.post("query/"+e,t)})}user(){return r.a(this,void 0,void 0,function*(){return yield this.get("user")})}}let v,g={};class y extends f{constructor(e){super("tv/",void 0,void 0,void 0,!0),this.unitId=e}getHttpChannel(){return r.a(this,void 0,void 0,function*(){let e=g[this.unitId];return void 0!==e?e:g[this.unitId]=yield this.buildChannel()})}buildChannel(){return r.a(this,void 0,void 0,function*(){let e=new l,t=new P("tv/",void 0),i=yield t.unitxUsq(this.unitId),{token:r,url:n,urlDebug:s}=i,a=h.a.getUrlOrDebug(n,s);return this.token=r,new o.a(!1,a,r,e)})}}function b(e){console.log("setCenterUrl %s",e),v=e,C=void 0,E=void 0,w=void 0}let w,E,C=void 0;function k(e){C=e,console.log("setCenterToken %s",e),E=void 0,w=void 0}class N extends u.a{constructor(e,t){super(e,t)}getHttpChannel(){return r.a(this,void 0,void 0,function*(){return!0===this.showWaiting||void 0===this.showWaiting?void 0!==w?w:w=new o.a(!0,v,C,new l):void 0!==E?E:E=new o.a(!0,v,C)})}}const x=new class extends N{usq(e){return r.a(this,void 0,void 0,function*(){return yield this.get("app-usq",e)})}}("tv/tie/",void 0);const S=new class extends N{directCall(e,t,i){return this.call(e,t,i)}}("",void 0);console.log("CenterApi"),console.log(N);class P extends N{usqs(e,t,i){return r.a(this,void 0,void 0,function*(){return yield this.get("tie/app-usqs",{unit:e,appOwner:t,appName:i})})}unitxUsq(e){return r.a(this,void 0,void 0,function*(){return yield this.get("tie/unitx-usq",{unit:e})})}}},function(e,t,i){"use strict";var r=i(2),n=i(0),s=i(10),o=i.n(s);class a{}class l extends a{constructor(e){super(),this.onClick=(()=>r.a(this,void 0,void 0,function*(){yield this.controller.start()})),this.view=(e=>n.createElement("div",{className:o()("px-3","py-2","align-items-center","cursor-pointer",e),onClick:this.onClick},this.icon," \xa0 ",this.label)),this.controller=e,this.icon=e.icon,this.label=e.label}render(e){return n.createElement(this.view,e)}}i.d(t,"a",function(){return l})},function(e,t,i){"use strict";i.d(t,"c",function(){return s}),i.d(t,"b",function(){return o}),i.d(t,"d",function(){return c}),i.d(t,"a",function(){return u});var r=i(2);let n;function s(e){n=e}function o(e){window.top.postMessage({type:"ws",msg:e},"*")}class a{constructor(){this.handlerSeed=1,this.anyHandlers={},this.msgHandlers={}}onWsReceiveAny(e){let t=this.handlerSeed++;return this.anyHandlers[t]=e,t}onWsReceive(e,t){let i=this.handlerSeed++;return this.msgHandlers[i]={type:e,handler:t},i}endWsReceive(e){delete this.anyHandlers[e],delete this.msgHandlers[e]}receive(e){return r.a(this,void 0,void 0,function*(){let{$type:t}=e;for(let i in this.anyHandlers)yield this.anyHandlers[i](e);for(let i in this.msgHandlers){let{type:r,handler:n}=this.msgHandlers[i];r===t&&(yield n(e))}})}}let l=1;const c=new class extends a{constructor(){super(...arguments),this.wsBaseId="WsBridge seed "+l++}};class u extends a{constructor(e,t){super(),this.wsBaseId="WSChannel seed "+l++,this.wsHost=e,this.token=t}static setCenterToken(e){u.centerToken=e}connect(){if(void 0!==this.ws)return;let e=this;return new Promise((t,i)=>{let n=new WebSocket(this.wsHost,this.token||u.centerToken);console.log("connect webSocket %s",this.wsHost),n.onopen=(i=>{console.log("webSocket connected %s",this.wsHost),e.ws=n,t()}),n.onerror=(e=>{i("webSocket can't open!")}),n.onmessage=(t=>r.a(this,void 0,void 0,function*(){return yield e.wsMessage(t)})),n.onclose=(t=>{e.ws=void 0,console.log("webSocket closed!")})})}close(){void 0!==this.ws&&(this.ws.close(),this.ws=void 0)}wsMessage(e){return r.a(this,void 0,void 0,function*(){try{console.log("websocket message: %s",e.data);let i=JSON.parse(e.data);!function(e){void 0!==n&&n.postMessage({type:"ws",msg:e},"*")}(i),yield this.receive(i)}catch(t){console.log("ws msg error: ",t)}})}sendWs(e){let t=this;this.connect().then(()=>{t.ws.send(e)})}}},,,function(e,t,i){"use strict";i.d(t,"b",function(){return n}),i.d(t,"a",function(){return a});var r=i(2);const n=!1,s="localhost:3000",o={centerhost:{value:s,env:"REACT_APP_CENTER_DEBUG_HOST",local:!1},usqhost:{value:"localhost:3015",env:"REACT_APP_USQ_DEBUG_HOST",local:!1},unitxhost:{value:"localhost:3015",env:"REACT_APP_USQ_DEBUG_HOST",local:!1},"usql-server":{value:"localhost:3009",env:"REACT_APP_DEBUG_USQL_SERVER",local:!1}};const a=new class{start(){return r.a(this,void 0,void 0,function*(){yield this.tryLocal();let e=this.getCenterHost();this.url=function(e){return`http://${e}/`}(e),this.ws=function(e){return`ws://${e}/tv/`}(e)})}debugHostUrl(e){return`http://${e}/hello`}tryLocal(){return r.a(this,void 0,void 0,function*(){let e=[];for(let r in o){let t=o[r],{value:i,env:n}=t,s=Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56"})[n]||i,a=this.debugHostUrl(s),l={method:"GET",mode:"no-cors",headers:{"Content-Type":"text/plain"}};e.push(c(a,l))}let t=yield Promise.all(e),i=0;for(let r in o)o[r][i]=t[r],++i})}getCenterHost(){let e=Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56"}).REACT_APP_CENTER_DEBUG_HOST||s;return!0===document.location.hash.includes("sheet_debug")?e:"101.200.46.56"}getUrlOrDebug(e,t){if(!0!==n)return e;if(!t)return e;for(let i in o){let e=o[i],{env:r,value:n,local:s}=e,a=`://${i}/`;if(t.indexOf(a)>0){if(!1===s)break;return t=t.replace(a,`://${Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56"})[r]||n}/`)}}return e}},l=100;function c(e,t){return r.a(this,void 0,void 0,function*(){try{return yield function(e,t){return new Promise((i,r)=>{fetch(e,t).then(e=>{e.text().then(i).catch(r)}).catch(r);const n=new Error("Connection timed out");setTimeout(r,l,n)})}(e,t),!0}catch(i){return!1}})}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});const r={usqOrder:"\u767e\u7075\u5a01\u7cfb\u7edf\u5de5\u7a0b\u90e8/order",usqProduct:"\u767e\u7075\u5a01\u7cfb\u7edf\u5de5\u7a0b\u90e8/product",usqCommon:"\u767e\u7075\u5a01\u7cfb\u7edf\u5de5\u7a0b\u90e8/common",usqWebUser:"\u767e\u7075\u5a01\u7cfb\u7edf\u5de5\u7a0b\u90e8/webuser",usqCustomer:"\u767e\u7075\u5a01\u7cfb\u7edf\u5de5\u7a0b\u90e8/customer",usqCustomerDiscount:"\u767e\u7075\u5a01\u7cfb\u7edf\u5de5\u7a0b\u90e8/customerDiscount",usqWarehouse:"\u767e\u7075\u5a01\u7cfb\u7edf\u5de5\u7a0b\u90e8/warehouse",usqMember:"\u767e\u7075\u5a01\u7cfb\u7edf\u5de5\u7a0b\u90e8/member",appIcon:"http://101.200.46.56/imgs/Bear-icon.png"}},function(e,t,i){"use strict";var r=i(13);i.d(t,"NavView",function(){return r.a}),i.d(t,"nav",function(){return r.c});i(44);var n=i(37);i.d(t,"Page",function(){return n.a});i(71),i(72);var s=i(73);i.d(t,"Controller",function(){return s.a}),i.d(t,"VPage",function(){return s.b}),i.d(t,"View",function(){return s.c});var o=i(74);i.o(o,"Field")&&i.d(t,"Field",function(){return o.Field}),i.o(o,"Form")&&i.d(t,"Form",function(){return o.Form}),i.o(o,"Loading")&&i.d(t,"Loading",function(){return o.Loading}),i.o(o,"TabCaptionComponent")&&i.d(t,"TabCaptionComponent",function(){return o.TabCaptionComponent}),i.o(o,"Tabs")&&i.d(t,"Tabs",function(){return o.Tabs}),i.o(o,"resLang")&&i.d(t,"resLang",function(){return o.resLang});var a=i(38);i.d(t,"resLang",function(){return a.a});var l=i(84);i.d(t,"TabCaptionComponent",function(){return l.a}),i.d(t,"Tabs",function(){return l.b});var c=i(48);i.d(t,"Loading",function(){return c.a})},function(e,t,i){"use strict";i.d(t,"a",function(){return s});const r="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",n=8;function s(){let e=r.length,t="";for(let i=0;i<n;i++)t+=r.charAt(Math.floor(Math.random()*e));return t}},function(e,t,i){"use strict";var r=i(2),n=i(14),s=i.n(n),o=i(8),a=i(0),l=i.n(a),c=i(6),u=i(142),h=i(4);class d extends o.b{constructor(){super(...arguments),this.onNew=(()=>this.event("new")),this.onList=(()=>this.event("list")),this.onSearch=(e=>r.a(this,void 0,void 0,function*(){return this.event("list",e)}))}showEntry(e){return r.a(this,void 0,void 0,function*(){this.openPage(this.view)})}entityRender(e,t){return e.render()}entityClick(e){return r.a(this,void 0,void 0,function*(){yield e.onClick()})}get view(){let e,{label:t,proxyLinks:i,isFrom:r}=this.controller;return!1===r&&(e=a.createElement(u.a,{className:"ml-3",color:"primary",onClick:this.onNew},"\u65b0\u589e")),()=>a.createElement(h.Page,{header:t},void 0===i?a.createElement(a.Fragment,null,a.createElement(c.i,{className:"w-100",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+t}),a.createElement("div",{className:"my-3"},e,a.createElement(u.a,{className:"ml-3",color:"primary",onClick:this.onList},"\u5217\u8868"))):a.createElement(c.e,{className:"my-2",header:a.createElement(c.g,null,t," \u4ee3\u7406\u4e0b\u5217Tuid"),items:i,item:{render:this.entityRender,onClick:this.entityClick}}))}}class p extends o.b{constructor(){super(...arguments),this.next=(()=>r.a(this,void 0,void 0,function*(){this.vForm.reset(),this.closePage()})),this.finish=(()=>{this.closePage(2),this.event("edit-end")}),this.onSubmit=(()=>r.a(this,void 0,void 0,function*(){let e=this.vForm.getValues(),t=yield this.controller.entity.save(this.id,e),{id:i}=t;if(i<0){let{unique:e}=this.controller.entity;if(void 0!==e)for(let t of e)this.vForm.setError(t,"\u4e0d\u80fd\u91cd\u590d")}else{if(this.controller.isCalling)return this.returnCall(i),void this.closePage();this.openPageElement(a.createElement(h.Page,{header:this.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},a.createElement("div",{className:"m-3"},a.createElement("span",{className:"text-success"},a.createElement(c.b,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),a.createElement("div",{className:"mt-5"},a.createElement(u.a,{className:"mr-3",color:"primary",onClick:this.next},"\u7ee7\u7eed\u5f55\u5165"),a.createElement(u.a,{color:"primary",outline:!0,onClick:this.finish},"\u4e0d\u7ee7\u7eed"))))),this.event("item-changed",{id:this.id,values:e})}}))}showEntry(e){return r.a(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e),void 0!==e&&(this.id=e.id),this.openPage(this.editView)})}get editView(){return()=>a.createElement(h.Page,{header:(void 0===this.id?"\u65b0\u589e":"\u7f16\u8f91")+" - "+this.label},this.vForm.render("py-3"))}resetForm(){this.vForm.reset()}}var m=i(17),f=i(9);class v extends o.b{constructor(){super(...arguments),this.mainView=Object(f.a)(()=>{let e=l.a.createElement(c.i,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearchMain,placeholder:"\u641c\u7d22"+this.label});return l.a.createElement(h.Page,{header:e,back:"close"},l.a.createElement(c.e,{items:this.controller.PageItems.items,item:{render:this.renderMainRow,onClick:this.clickMainRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))}),this.onSearchMain=(e=>r.a(this,void 0,void 0,function*(){yield this.controller.searchMain(e)})),this.renderMainRow=((e,t)=>l.a.createElement(this.mainRowContent,Object.assign({},e))),this.clickMainRow=(e=>r.a(this,void 0,void 0,function*(){this.ceasePage(),void 0!==this.controller.entity.owner?yield this.showDiv(this.entity.getIdFromObj(e)):this.returnCall(e)})),this.divView=(e=>l.a.createElement(h.Page,{header:"\u9009\u62e9Div"},l.a.createElement(c.e,{items:e.items,item:{render:this.renderDivRow,onClick:this.clickDivRow}}))),this.renderDivRow=((e,t)=>l.a.createElement(this.divRowContent,Object.assign({},e))),this.clickDivRow=(e=>{this.ceasePage(),this.returnCall(e)})}showEntry(e){return r.a(this,void 0,void 0,function*(){void 0===e?yield this.showMain(e):yield this.showDiv(e)})}showMain(e){return r.a(this,void 0,void 0,function*(){this.mainRowContent=this.ui.rowContent||m.c,yield this.controller.searchMain(e),this.openPage(this.mainView)})}showDiv(e){return r.a(this,void 0,void 0,function*(){let{divs:t}=this.ui;void 0!==t&&(this.divRowContent=t[this.entity.name].rowContent),void 0===this.divRowContent&&(this.divRowContent=m.c);let i=yield this.controller.getDivItems(e);this.openPage(this.divView,{items:i})})}}var g=i(18);class y extends o.b{constructor(){super(...arguments),this.next=(()=>r.a(this,void 0,void 0,function*(){this.vForm.reset(),this.closePage()})),this.finish=(()=>{this.closePage(2)}),this.onSubmit=(()=>r.a(this,void 0,void 0,function*(){let e=this.vForm.getValues(),t=yield this.entity.save(this.id,e);t&&alert("\u8fd9\u91cc\u8fd8\u8981\u5224\u65ad\u8fd4\u56de\u503c\uff0c\u5148\u4e0d\u5904\u7406\u4e86 \n"+Object(g.a)(t)),this.openPage(()=>a.createElement(h.Page,{header:this.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},a.createElement("div",{className:"m-3"},a.createElement("span",{className:"text-success"},a.createElement(c.b,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),a.createElement("div",{className:"mt-5"},a.createElement(u.a,{className:"mr-3",color:"primary",onClick:this.next},"\u7ee7\u7eed\u5f55\u5165"),a.createElement(u.a,{color:"primary",outline:!0,onClick:this.finish},"\u4e0d\u7ee7\u7eed")))))})),this.view=(()=>a.createElement(h.Page,{header:this.label},this.vForm.render("py-3")))}buildForm(e){this.vForm=this.createForm(void 0,e)}showEntry(e){return r.a(this,void 0,void 0,function*(){this.buildForm(e),this.openPage(this.view)})}render(e){return this.buildForm(e),this.vForm.render()}loadId(e){return r.a(this,void 0,void 0,function*(){this.id=e})}resetForm(){this.vForm.reset()}}class b extends y{}class w extends h.PageItems{constructor(e){super(!0),this.tuid=e}load(e,t,i){return r.a(this,void 0,void 0,function*(){return yield this.tuid.search(e,t,i)})}setPageStart(e){this.pageStart=void 0===e?0:e.id}}class E extends o.b{constructor(){super(...arguments),this.onSearch=(e=>r.a(this,void 0,void 0,function*(){yield this.controller.searchMain(e)})),this.renderRow=((e,t)=>a.createElement(this.rowContent,Object.assign({},e))),this.clickRow=(e=>{this.callOnSelected(e)}),this.rowKey=(e=>{let{id:t}=e;return t}),this.view=Object(f.a)(()=>{let e,t=a.createElement(c.i,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+this.label}),{owner:i}=this.entity;if(void 0!==i){let t=i.valueFromId(this.ownerId);e=a.createElement("div",null,"owner: ",Object(g.a)(t))}return a.createElement(h.Page,{header:t},e,a.createElement(c.e,{items:this.controller.PageItems.items,item:{render:this.renderRow,onClick:this.clickRow,key:this.rowKey},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))})}showEntry(e){return r.a(this,void 0,void 0,function*(){this.rowContent=this.ui.rowContent||m.c,void 0!==this.entity.owner&&(this.ownerId=Number(e)),yield this.controller.searchMain(""),this.openPage(this.view)})}callOnSelected(e){void 0!==this.onSelected?this.onSelected(e):alert("onSelect is undefined")}}class C extends E{onSelected(e){return r.a(this,void 0,void 0,function*(){!1===this.controller.isFrom?this.event("edit",e.id):this.event("info",e.id)})}}class k extends o.a{buildPageItems(){return new w(this.entity.owner||this.entity)}searchMain(e){return r.a(this,void 0,void 0,function*(){void 0===this.PageItems&&(this.PageItems=this.buildPageItems()),void 0!==e&&(yield this.PageItems.first(e))})}getDivItems(e){return r.a(this,void 0,void 0,function*(){return yield this.entity.searchArr(e,void 0,0,1e3)})}}class N extends k{constructor(e,t,i,r){super(e,t,i,r);let n=this.entity;if(this.proxies=n.proxies,void 0!==this.proxies){this.proxyLinks=[];for(let e in this.proxies){let t=this.cUsq.linkFromName("tuid",e);this.proxyLinks.push(t)}}}from(){return r.a(this,void 0,void 0,function*(){let e=yield this.entity.cFrom();return void 0===e?this:e})}cUsqFrom(){return r.a(this,void 0,void 0,function*(){return yield this.entity.cUsqFrom()})}cEditFrom(){return r.a(this,void 0,void 0,function*(){let e=yield this.entity.cUsqFrom();return yield e.cTuidEditFromName(this.entity.name)})}cInfoFrom(){return r.a(this,void 0,void 0,function*(){let e=yield this.entity.cUsqFrom();return yield e.cTuidInfoFromName(this.entity.name)})}cSelectFrom(){return r.a(this,void 0,void 0,function*(){let e=yield this.entity.cUsqFrom();return yield e.cTuidSelectFromName(this.entity.name)})}getLable(e){if(e===this.entity)return this.label;let{name:t}=e,{arrs:i}=this.res;if(void 0!==i){let e=i[t];if(void 0!==e){let t=e.label;if(void 0!==t)return t}}return t}get VTuidMain(){return d}get VTuidEdit(){return p}get VTuidList(){return C}internalStart(e){return r.a(this,void 0,void 0,function*(){this.isFrom=void 0!==this.entity.schemaFrom,yield this.showVPage(this.VTuidMain)})}onEvent(e,t){return r.a(this,void 0,void 0,function*(){let i;switch(e){default:return;case"new":i=this.VTuidEdit;break;case"list":i=this.VTuidList;break;case"edit":return void(yield this.edit(t));case"item-changed":return void this.itemChanged(t);case"info":let r=new O(this.cUsq,this.entity,this.ui,this.res);return void(yield r.start(t))}yield this.showVPage(i,t)})}edit(e){return r.a(this,void 0,void 0,function*(){let t=void 0;void 0!==e&&(t=yield this.entity.load(e));let i=this.VTuidEdit;yield this.showVPage(i,t)})}itemChanged({id:e,values:t}){if(void 0===this.PageItems)return;let i=this.PageItems.items.find(t=>t.id===e);void 0!==i&&s.a.merge(i,t)}}class x extends N{internalStart(e){return r.a(this,void 0,void 0,function*(){yield this.edit(e)})}}class S extends N{internalStart(e){return r.a(this,void 0,void 0,function*(){yield this.showVPage(this.VTuidList)})}}class P extends k{internalStart(e){return r.a(this,void 0,void 0,function*(){yield this.showVPage(this.VTuidSelect,e)})}beforeStart(){const e=Object.create(null,{beforeStart:{get:()=>super.beforeStart}});return r.a(this,void 0,void 0,function*(){return!1!==(yield e.beforeStart.call(this))&&(void 0!==this.PageItems&&this.PageItems.reset(),!0)})}get VTuidSelect(){return v}idFromItem(e){return e.id}}class O extends k{internalStart(e){return r.a(this,void 0,void 0,function*(){let t=yield this.entity.load(e);yield this.showVPage(this.VTuidInfo,t)})}get VTuidInfo(){return b}}i.d(t,"d",function(){return N}),i.d(t,"a",function(){return x}),i.d(t,"c",function(){return S}),i.d(t,"e",function(){return P}),i.d(t,"b",function(){return O})},function(e,t,i){"use strict";i.d(t,"a",function(){return s}),i.d(t,"c",function(){return o}),i.d(t,"b",function(){return a});var r=i(63),n=i.n(r);class s{constructor(e){this.user=e}get id(){return this.user.id}get name(){return this.user.name}get nick(){return this.user.nick}get icon(){return this.user.icon||"http://101.200.46.56/imgs/Bear-icon.png"}get guest(){return this.user.guest}get token(){return this.user.token}}function o(e){let t=n()(e);return{id:t.id,name:t.name,guest:t.guest,token:e}}function a(e){return{id:0,guest:n()(e).guest,token:e}}},function(e,t,i){"use strict";var r=i(2),n=i(0),s=i.n(n),o=i(9);class a{constructor(e){this.view=(()=>n.createElement("div",null)),this.label=e}render(){return n.createElement("div",{key:this.key,className:"px-3"},n.createElement("div",{className:"form-group row"},n.createElement("label",{className:"col-sm-2 col-form-label"},this.label),n.createElement("div",{className:"col-sm-10"},this.renderContent())))}setAddRow(e){}get key(){return this.label}getVFields(){}getVArr(){}getVSubmit(){}renderContent(){return n.createElement("div",{className:"form-control form-control-plaintext bg-white border border-info rounded "},"content")}}class l extends a{constructor(e,t){super(e),this.vField=t}get key(){return this.vField.name}getVFields(){return[this.vField]}renderContent(){return this.vField.render()}}class c extends a{constructor(e,t){super(e),this.vArr=t}setAddRow(e){this.vArr.setAddRow(e)}get key(){return this.vArr.name}getVArr(){return this.vArr}render(){return n.createElement(n.Fragment,{key:this.key},this.vArr&&this.vArr.render())}}class u extends a{constructor(e){super(void 0),this.vSubmit=e}get key(){return"$submit"}getVSubmit(){return this.vSubmit}render(){return n.createElement("div",{key:"$submit",className:"px-3"},n.createElement("div",{className:"form-group row"},n.createElement("div",{className:"offset-sm-2 col-sm-10"},this.vSubmit.render())))}}var h=i(17),d=i(7);class p extends h.d{constructor(e){super(),this.onClickSubmit=(()=>r.a(this,void 0,void 0,function*(){this.vForm.submit()})),this.view=Object(o.a)(()=>{let{isOk:e}=this.vForm;return n.createElement("button",{type:"button",onClick:this.onClickSubmit,className:this.className,disabled:!1===e},this.caption)}),this.vForm=e,this.caption=this.vForm.submitCaption,this.className="btn btn-primary w-25"}}r.b([d.l],p.prototype,"caption",void 0),r.b([d.l],p.prototype,"className",void 0);var m=i(10),f=i.n(m),v=i(6);class g{}class y extends g{check(e,t){switch(typeof t){default:case"boolean":return;case"object":if(null!==t)return;break;case"string":if(t.trim().length>0)return;break;case"number":if(NaN!==t)return;break;case"undefined":}e.push("\u4e0d\u80fd\u4e3a\u7a7a")}}class b extends g{check(e,t){if(void 0===t||null===t)return;NaN===Number(t)&&e.push("\u5fc5\u987b\u662f\u6570\u5b57")}}class w extends g{check(e,t){if(void 0===t||null===t)return;let i=Number(t);!0!==Number.isNaN(i)&&!1!==Number.isInteger(i)||e.push("\u5fc5\u987b\u662f\u6574\u6570")}}class E extends b{constructor(e){super(),this.min=e}check(e,t){super.check(e,t),Number(t)<this.min&&e.push("\u4e0d\u80fd\u5c0f\u4e8e"+this.min)}}class C extends b{constructor(e){super(),this.max=e}check(e,t){super.check(e,t),Number(t)>this.max&&e.push("\u4e0d\u80fd\u5c0f\u4e8e"+this.max)}}class k extends h.d{constructor(e,t,i,r){super(),this.form=e,this.field=t,this.name=t.name,this.fieldUI=i||{},this.fieldRes=r||{},this.init()}init(){this.buildRules()}buildRules(){this.rules=[];let{required:e}=this.fieldUI;(!0===e||void 0!==this.field&&!1===this.field.null)&&this.rules.push(new y)}get checkRules(){let e=[];for(let t of this.rules)t.check(e,this.value);return e}get isOk(){if(0===this.rules.length)return!0;return 0===this.checkRules.length}get value(){return this.form.values[this.name]}setValue(e){this.form.values[this.name]=e}get error(){return this.form.errors[this.name]}set error(e){this.form.errors[this.name]=e}parse(e){return e}get readonly(){let{mode:e}=this.form;return e===H.readonly||e===H.edit&&!1===this.fieldUI.editable}}r.b([d.e],k.prototype,"checkRules",null),r.b([d.e],k.prototype,"isOk",null),r.b([d.e],k.prototype,"value",null);class N extends k{constructor(){super(...arguments),this.renderError=(e=>{let{errors:t}=this.form,i=t[this.name];if(void 0!==i)return n.createElement("div",{className:e},n.createElement(v.b,{name:"exclamation-circle"})," ",i)}),this.ref=(e=>{this.input=e,this.setInputValue()}),this.onFocus=(()=>{this.error=void 0}),this.onBlur=(()=>{let e=this.checkRules;e.length>0&&(this.error=e[0]),this.form.computeFields()}),this.onChange=(e=>{let t=this.parse(e.currentTarget.value);null!==t&&this.setValue(t)}),this.view=Object(o.a)(()=>{let e,t,i,{required:r}=this.fieldUI,{placeHolder:s,suffix:o}=this.fieldRes,a=["form-control","form-control-input"];return!0===this.readonly?t=n.createElement("input",{className:f()(a,"bg-light"),ref:this.ref,type:this.inputType,readOnly:!0}):(t=n.createElement("input",{className:f()(a),ref:this.ref,type:this.inputType,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onChange,placeholder:s,readOnly:!1,maxLength:this.maxLength,onKeyPress:this.onKeyPress}),!0!==r&&!1!==this.field.null||(e=n.createElement(x,null))),i=void 0===o?t:n.createElement("div",{className:"input-group"},t,n.createElement("div",{className:"input-group-append"},n.createElement("span",{className:"input-group-text"},o))),n.createElement(n.Fragment,null,e,i,this.renderError("text-danger small mt-1 mx-2"))})}get maxLength(){}setValue(e){super.setValue(e),this.setInputValue()}setInputValue(){if(!this.input)return;let e=this.value;this.input.value=null===e||void 0===e?"":e}}const x=()=>n.createElement("b",{style:{color:"red",position:"absolute",left:"0.1em",top:"0.5em"}},"*");class S extends N{constructor(){super(...arguments),this.inputType="text"}get maxLength(){return this.field.size}}const P=45,O=46;class F extends N{constructor(){super(...arguments),this.inputType="number",this.onKeyPress=(e=>{let t=e.charCode;if(!(8===t||0===t||13===t||t>=48&&t<=57))if(void 0!==this.extraChars&&this.extraChars.indexOf(t)>=0)switch(t){case O:this.onKeyDot();break;case P:this.onKeyNeg(),e.preventDefault()}else e.preventDefault()})}init(){if(super.init(),this.extraChars=[],void 0!==this.fieldUI){let{min:e,max:t}=this.fieldUI;void 0!==e?e<0&&this.extraChars.push(P):this.extraChars.push(P)}switch(this.field.type){case"dec":case"bigint":case"int":case"smallint":case"tinyint":this.extraChars.push(O)}}buildRules(){super.buildRules(),this.rules.push(new b);let{min:e,max:t}=this.fieldUI;void 0!==e&&this.rules.push(new E(e)),void 0!==t&&this.rules.push(new C(t))}parse(e){try{if(0===e.trim().length)return;let i=Number(e);return NaN===i?null:i}catch(t){return null}}setInputValue(){if(!this.input)return;let e=this.value;this.parse(this.input.value)!=e&&(this.input.value=null===e||void 0===e?"":e)}onKeyDot(){let e=this.input.value;e.indexOf(".")>=0&&(this.input.value=e.replace(".",""))}onKeyNeg(){let e=this.input.value,t=e.indexOf("-");e=t>=0?e.replace("-",""):"-"+e,this.input.value=e}}class V extends F{buildRules(){super.buildRules(),this.rules.push(new w)}}class A extends F{}class I extends S{}class T extends S{}class q extends k{constructor(e,t,i){super(e,t,void 0,i),this.view=Object(o.a)(()=>{let e=this.form.values[this.field.name],{placeHolder:t,suffix:i}=this.fieldRes;null===e&&(e="");let r,n=s.a.createElement("input",{className:"form-control form-control-input bg-light",type:"text",placeholder:t,readOnly:!0,value:e});return r=void 0===i?n:s.a.createElement("div",{className:"input-group"},n,s.a.createElement("div",{className:"input-group-append"},s.a.createElement("span",{className:"input-group-text"},i)))})}}var j=i(14),R=i.n(j),D=i(4);class U extends h.d{constructor(e,t,i){super(),this.rowPage=(()=>n.createElement(D.Page,{header:this.label,back:"close"},this.vForm.render("py-3"))),this.onSubmit=(()=>r.a(this,void 0,void 0,function*(){let{valueBoxs:e}=this.vForm;yield this.onRowChanged(e)})),this.onRowChanged=(e=>r.a(this,void 0,void 0,function*(){void 0===this.rowValues?(e.$owner=this.ownerForm.values,this.list.push(e),void 0===this.onEditRow?this.vForm.reset():yield this.onEditRow(void 0,this.onRowChanged)):(R.a.merge(this.rowValues,e),void 0===this.onEditRow&&D.nav.pop())})),this.renderItem=((e,t)=>void 0===this.rowContent?n.createElement("div",{className:"px-3 py-2"},n.createElement(h.a,Object.assign({},e))):n.createElement(this.rowContent,Object.assign({},e))),this.showRow=(e=>r.a(this,void 0,void 0,function*(){void 0===this.onEditRow?(this.vForm.reset(),void 0!==e&&this.vForm.setValues(e),D.nav.push(n.createElement(this.rowPage,null))):yield this.onEditRow(e,this.onRowChanged)})),this.editRow=(e=>r.a(this,void 0,void 0,function*(){this.rowValues=e;let{vSubmit:t}=this.vForm;void 0!==t&&(t.caption=this.editSubmitCaption,t.className="btn btn-outline-success"),this.vForm.mode=this.ownerForm.mode,yield this.showRow(e)})),this.internalAddRow=(()=>r.a(this,void 0,void 0,function*(){this.rowValues=void 0;let{vSubmit:e}=this.vForm;e.caption=this.newSubmitCaption,e.className="btn btn-outline-success",this.vForm.reset(),this.vForm.mode=H.new,yield this.showRow(void 0)})),this.view=(()=>{let e;void 0===this.addRow&&this.mode===H.readonly||(e=n.createElement("button",{onClick:this.addRow||this.internalAddRow,type:"button",className:"btn btn-link p-0"},this.ownerForm.arrTitleNewButton));let t=this.header||n.createElement("div",{className:"px-3 bg-light small",style:{paddingTop:"1px",paddingBottom:"1px"}},n.createElement("div",{className:"flex-fill align-self-center"},this.label),e);return n.createElement(v.e,{className:"pb-3",header:t,none:n.createElement(v.g,{className:"px-3 py-2"},this.none),items:this.list,item:{render:this.renderItem,onClick:this.editRow}})}),this.ownerForm=e;let{name:s,fields:o}=t;this.name=s;let{ui:a,res:l,mode:c,inputs:u,values:d}=e,p=l.arrs,m=void 0!==p?p[s]:{},{label:f,none:g,newSubmit:y,editSubmit:b}=m;this.none=g||e.none,this.newSubmitCaption=y||e.arrNewCaption,this.editSubmitCaption=b||e.arrEditCaption,this.label=f||s;let w=a&&a.items[s]||{};this.rowContent=w.rowContent,this.mode=c,void 0===this.onEditRow?this.vForm=new K({fields:o,arrs:void 0,ui:w,res:m,inputs:u[s],none:e.none,submitCaption:"submit",arrNewCaption:void 0,arrEditCaption:void 0,arrTitleNewButton:void 0,mode:c},c===H.readonly?void 0:this.onSubmit):this.onEditRow=i,this.list=d[s]}reset(){this.vForm.reset(),this.list.clear()}setAddRow(e){this.addRow=e}}var L=i(18);const M={textAlign:"left",paddingLeft:"0.75rem",paddingRight:"0.75rem",overflow:"hidden"};class _ extends k{constructor(e,t,i,s){super(e,t,i,s),this.onClick=(()=>r.a(this,void 0,void 0,function*(){if(!0===this.readonly){if(!this.value)return;return void(yield this.tuid.showInfo(this.value.id))}let e;void 0!==this.input?e=yield this.input.select(this.vForm,this.field,this.vForm.getValues()):(alert("call undefined"),e=0),this.setValue(this.tuid.boxId(e))})),this.view=Object(o.a)(()=>{let e,t,{placeHolder:i}=this.fieldRes,r=!1,{_ownerField:s}=this.field;if(void 0!==s){let{name:e,arr:t}=s;r=null===this.vForm.getValue(e)}if(null===this.value)e=n.createElement(n.Fragment,null,i||this.input.placeHolder);else if("object"===typeof this.value)e=Object(L.b)(this.value);else{let t=this.tuid.boxId(this.value);e=Object(L.b)(t)}if(!0===this.readonly)return n.createElement("div",{className:"form-control form-control-plaintext border border-info rounded bg-light cursor-pointer",onClick:this.onClick},e);let{required:o}=this.fieldUI;return!0!==o&&!1!==this.field.null||(t=n.createElement(x,null)),n.createElement(n.Fragment,null,t,n.createElement("button",{className:"form-control btn btn-outline-info",type:"button",disabled:r,style:M,onClick:this.onClick},e))}),this.tuid=t._tuid,this.vForm=e,this.input=e.inputs[t.name]}}class B{constructor(e,t,i){this.vForm=e,this.onSubmit=i;let{fields:r,arrs:n,ui:s,res:o}=t;if(this.fields=r,this.arrs=n,void 0!==s){let{items:e,layout:t}=s;this.formItems=e,this.layout=t}this.res=o}build(){return void 0===this.layout?this.bandsOnFly():this.bandsFromLayout()}resFromName(e,t){if(void 0===t)return;let{fields:i}=t;return void 0!==i?i[e]||e:void 0}bandsOnFly(){let e=[];if(this.bandsFromFields(e,this.fields,this.res),void 0!==this.arrs)for(let t of this.arrs)e.push(this.bandFromArr(t));return void 0!==this.onSubmit&&e.push(new u(new p(this.vForm))),e}bandsFromFields(e,t,i){if(void 0!==t)for(let r of t)e.push(this.bandFromField(r,i))}bandsFromLayout(){return[]}bandFromField(e,t){let i,r,n,s,{name:o}=e,a=this.resFromName(o,t);return"object"===typeof a?(r=a.label,i=a):(r=a,i=void 0),void 0!==this.formItems&&(s=this.formItems[o]),void 0===(n="function"===typeof s?new q(this.vForm,e,i):function(e,t,i,r){let n;switch(t.type){default:return;case"tinyint":case"smallint":case"int":n=V;break;case"bigint":let{_tuid:e}=t;if(void 0!==e)return;n=V;break;case"dec":n=A;break;case"char":n=S;break;case"text":n=I;break;case"datetime":n=T}return new n(e,t,i,r)}(this.vForm,e,s,i))&&(n=new _(this.vForm,e,s,i)),new l(r||o,n)}bandFromArr(e){let{name:t,fields:i}=e,r=new U(this.vForm,e);return new c(t,r)}}var H;!function(e){e[e.new=0]="new",e[e.edit=1]="edit",e[e.readonly=2]="readonly"}(H||(H={}));class K{constructor(e,t){this.vFields={},this.vArrs={},this.onFormSubmit=(e=>(e.preventDefault(),!1)),this.view=Object(o.a)(({className:e})=>n.createElement("form",{className:e,onSubmit:this.onFormSubmit},this.bands.map(e=>e.render())));let{fields:i,arrs:r,ui:s,res:a,inputs:l,none:c,submitCaption:u,arrNewCaption:h,arrEditCaption:d,arrTitleNewButton:p,mode:m}=e;this.fields=i,this.arrs=r,this.ui=s,void 0!==this.ui&&(this.formItems=this.ui.items),this.res=a,this.inputs=l,this.none=c,this.submitCaption=u,this.arrNewCaption=h,this.arrEditCaption=d,this.arrTitleNewButton=p||n.createElement("small",null,n.createElement(v.b,{name:"plus"})," \u65b0\u589e"),this.mode=void 0===t?H.readonly:m,this.buildFormValues(),this.buildBands(e,t),this.onSubmit=t}buildBands(e,t){this.bandColl={};let i=new B(this,e,t);this.bands=i.build();for(let r of this.bands){this.bandColl[r.key]=r;let e=r.getVFields();if(void 0!==e)for(let r of e)this.vFields[r.name]=r;let t=r.getVArr();void 0!==t&&(this.vArrs[t.name]=t);let i=r.getVSubmit();void 0!==i&&(this.vSubmit=i)}}getBand(e){return this.bandColl[e]}computeFields(){if(void 0===this.formItems)return;let e=this.values;for(let t in this.formItems){let i=this.formItems[t];"function"===typeof i&&(e[t]=i.call(e))}}submit(){return r.a(this,void 0,void 0,function*(){void 0!==this.onSubmit&&(yield this.onSubmit())})}getValues(){let e={},t=this.values;for(let i of this.fields){let{name:r}=i,n=t[r];e[r]=null!==n&&"object"===typeof n?n.id:n}if(void 0!==this.arrs)for(let i of this.arrs){let{name:t,fields:r,id:n,order:s}=i,o=e[t]=[],a=this.vArrs[t].list;for(let e of a){let t={};void 0!==n&&(t[n]=e[n]),void 0!==s&&(t[s]=e[s]);for(let i of r){let{name:r}=i,n=e[r];t[r]=null!==n&&"object"===typeof n?n.id:n}o.push(t)}}return e}get valueBoxs(){let e={},t=this.values;for(let i of this.fields){let{name:r,_tuid:n}=i,s=t[r];e[r]=void 0===n||"object"===typeof s?s:n.boxId(s)}if(void 0===this.arrs)return e;for(let i of this.arrs){let{name:t,fields:r,id:n,order:s}=i,o=e[t]=this.vArrs[t].list.slice();for(let e of o)for(let t of r){let{name:i,_tuid:r}=t,n=e[i];e[i]=void 0===r||"object"===typeof n?n:r.boxId(n)}}return e}setValues(e){if(void 0===e)return void this.reset();let t=this.values,i=this.errors;for(let r of this.fields){let n=r.name;i[n]=void 0;let s=e[n];t[n]=s}for(let r in this.vArrs){let i=e[r];if(void 0===i)continue;let n=t[r];n.clear(),n.push(...i)}}get isOk(){for(let e in this.vFields)if(!1===this.vFields[e].isOk)return!1;return!0}reset(){let e=this.values,t=this.errors;for(let i of this.fields){let r=i.name;e[r]=null,t[r]=void 0}for(let i in this.vFields){let e=this.vFields[i];void 0!==e.name&&e.setValue(null)}for(let i in this.vArrs){this.vArrs[i].reset()}}getValue(e){return this.values[e]}setValue(e,t){this.values[e]=t}setError(e,t){this.errors[e]=t}buildFieldValues(e){let t={valueFromFieldName:function(e){return this[e]}};for(let i of e){t[i.name]=null}return t}buildObservableValues(){let e=this.buildFieldValues(this.fields);if(void 0!==this.arrs)for(let t of this.arrs)e[t.name]=d.l.array([],{deep:!0});return Object(d.l)(e)}buildFormValues(){this.values=this.buildObservableValues(),this.errors=Object(d.l)(this.buildFieldValues(this.fields))}render(e="py-3"){return n.createElement(this.view,{className:e})}}r.b([d.e],K.prototype,"isOk",null),i.d(t,"a",function(){return H}),i.d(t,"b",function(){return K})},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var r=i(2),n=i(22),s=i(13),o=i(28);class a{constructor(e,t,i,n){this.startWait=(()=>{void 0!==this.ui&&this.ui.startWait()}),this.endWait=((e,t)=>{void 0!==this.ui&&this.ui.endWait(),void 0!==t&&t("\u8bbf\u95eewebapi\u8d85\u65f6 "+e)}),this.showError=(e=>r.a(this,void 0,void 0,function*(){void 0!==this.ui&&(yield this.ui.showError(e))})),this.isCenter=e,this.hostUrl=t,this.apiToken=i,this.ui=n,this.timeout=!0===o.b?5e5:5e3}used(){this.post("",{})}get(e,t){return r.a(this,void 0,void 0,function*(){if(t){let i=Object.keys(t);if(i.length>0){let r="?";for(let n of i){void 0!==t[n]&&(e+=r+n+"="+t[n],r="&")}}}let i=this.buildOptions();return i.method="GET",yield this.innerFetch(e,i)})}post(e,t){return r.a(this,void 0,void 0,function*(){let i=this.buildOptions();return i.method="POST",i.body=JSON.stringify(t),yield this.innerFetch(e,i)})}put(e,t){return r.a(this,void 0,void 0,function*(){let i=this.buildOptions();return i.method="PUT",i.body=JSON.stringify(t),yield this.innerFetch(e,i)})}delete(e,t){return r.a(this,void 0,void 0,function*(){let i=this.buildOptions();return i.method="DELETE",i.body=JSON.stringify(t),yield this.innerFetch(e,i)})}fetch(e,t,i,n){return r.a(this,void 0,void 0,function*(){let o=this;this.startWait();let a=e;function l(e){return{channel:o,url:a,options:t,resolve:i,reject:n,error:e}}try{console.log("%s %s",t.method,a);let u=setTimeout(()=>o.endWait(e,n),this.timeout),h=yield fetch(encodeURI(a),t);if(!1===h.ok)throw clearTimeout(u),o.endWait(),console.log("call error %s",h.statusText),h.statusText;let d=h.headers.get("content-type");if(d&&d.indexOf("json")>=0)return h.json().then(e=>r.a(this,void 0,void 0,function*(){if(clearTimeout(u),o.endWait(),!0===e.ok)return i(e.res);void 0===e.error?yield o.showError(l("not valid tonva json")):(yield o.showError(l(e.error)),n(e.error))})).catch(e=>r.a(this,void 0,void 0,function*(){yield o.showError(l(e.message))}));{let e=yield h.text();clearTimeout(u),o.endWait(),i(e)}}catch(c){if("string"===typeof c&&!0===c.toLowerCase().startsWith("unauthorized"))return void s.c.logout();yield this.showError(l(c.message))}})}innerFetch(e,t){return r.a(this,void 0,void 0,function*(){let i=this.hostUrl+e;return!0===this.isCenter&&void 0===this.apiToken&&Object(n.d)()?yield Object(n.c)(i,t.method,t.body):yield new Promise((e,n)=>r.a(this,void 0,void 0,function*(){yield this.fetch(i,t,e,n)}))})}callFetch(e,t,i){return r.a(this,void 0,void 0,function*(){let n=this.buildOptions();return n.method=t,n.body=i,yield new Promise((t,i)=>r.a(this,void 0,void 0,function*(){yield this.fetch(e,n,t,i)}))})}buildOptions(){let{language:e,culture:t}=s.c,i=new Headers;i.append("Content-Type","application/json;charset=UTF-8");let r=e;return t&&(r+="-"+t),i.append("Accept-Language",r),this.apiToken&&i.append("Authorization",this.apiToken),{headers:i}}}},,function(e,t,i){"use strict";i.d(t,"a",function(){return p});var r=i(2),n=i(0),s=i(9),o=i(10),a=i.n(o),l=i(14),c=i.n(l),u=i(44);const h=100;class d extends n.Component{constructor(){super(...arguments),this.bottomTime=0,this.topTime=0,this.onScroll=(e=>r.a(this,void 0,void 0,function*(){let{onScroll:t,onScrollTop:i,onScrollBottom:r}=this.props;t&&this.props.onScroll(e);let n=e.target;if(n.scrollTop<30&&void 0!==i){let e=(new Date).getTime();e-this.topTime>h&&(this.topTime=e,i())}if(n.scrollTop+n.offsetHeight>n.scrollHeight-30&&void 0!==r){let e=(new Date).getTime();e-this.bottomTime>h&&(this.bottomTime=e,r())}}))}eachChild(e,t){let{props:i}=e;if(void 0===i)return;let{children:r}=i;void 0!==r&&n.Children.forEach(r,(e,i)=>{let{_$scroll:r}=e;r&&r(t),console.log(e.toString()),this.eachChild(e,t)})}render(){return n.createElement("main",{className:this.props.className,onScroll:this.onScroll},this.props.children)}}let p=class extends n.Component{constructor(e){super(e);let t,{tabs:i}=e;if(void 0===i||0===i.length)return;this.tabs=i;let r=[];for(let n of i){let e=c.a.clone(n);void 0===t&&!0===e.isSelected?t=e:e.isSelected=!1,e.isMounted=!1,r.push(e)}this.state={cur:t,tabs:r}}componentDidMount(){return r.a(this,void 0,void 0,function*(){if(void 0===this.tabs)return;let e=this.state.tabs[0];void 0!==e&&(yield this.onTabClick(e))})}onTabClick(e){return r.a(this,void 0,void 0,function*(){if(!0===e.isSelected)return;let t,i=this.state.tabs;for(let r of i)r===e?(r.isSelected=!0,t=r):r.isSelected=!1;if(!0!==t.isMounted){let{load:e}=t;void 0!==e&&(yield e())}this.setState({cur:t,tabs:i})})}onTouchStart(e){}renderTabs(e){const{header:t,back:i,right:r,keepHeader:s}=this.props;let o,l=this.state.cur,c=n.createElement("div",null,this.state.tabs.map((e,t)=>{const{icon:i,isSelected:r,title:s,redDot:o}=e;let l,c,u;if(void 0!==i&&(l=n.createElement("img",{src:i})),void 0!==o){let e=o.get();e<0?(u=a()("red-dot"),c=n.createElement("u",null)):e>0&&(u=a()("red-dot","num"),c=n.createElement("u",null,e))}return n.createElement("div",{key:t,className:a()("va-tab",{cur:r}),onClick:()=>this.onTabClick(e)},l,n.createElement("div",{className:u},s,c))}));return!1!==t&&(o=n.createElement(u.a,{back:i,center:!0===s?t:l&&(l.header||l.title),right:r})),n.createElement("article",{className:"page-container"},o,n.createElement("section",null,this.state.tabs.map((e,t)=>{let{isSelected:i,isMounted:r,content:s}=e;if(!0===i||!0===r)return e.isMounted=!0,n.createElement(d,{key:t,className:a()({invisible:!1===i}),onScroll:e.onScroll,onScrollTop:e.onScrollTop,onScrollBottom:e.onScrollBottom},"function"===typeof s?s():s)})),c,e)}renderSingle(e){const{back:t,header:i,right:r,onScroll:s,onScrollTop:o,onScrollBottom:a,children:l}=this.props;let c;return!1!==i&&(c=n.createElement(u.a,{back:t,center:i,right:r,logout:this.props.logout})),n.createElement("article",{className:"page-container",onTouchStart:this.onTouchStart},c,n.createElement("section",null,n.createElement(d,{onScroll:s,onScrollTop:o,onScrollBottom:a},l)),e)}render(){const{footer:e}=this.props;let t;return void 0!==e&&(t=n.createElement("footer",null,e)),void 0!==this.tabs?this.renderTabs(t):this.renderSingle(t)}};p=r.b([s.a],p)},function(e,t,i){"use strict";i.d(t,"b",function(){return s}),i.d(t,"a",function(){return o});var r=i(14),n=i.n(r);const s={lang:void 0,district:void 0};function o(e){let{lang:t,district:i}=s,r={};if(void 0===e)return r;n.a.merge(r,e._);let o=e[t];if(void 0===o)return r;n.a.merge(r,o._);let a=o[i];if(void 0===a)return r;n.a.merge(r,a);let{entity:l}=r;if(void 0!==l)for(let n in l)l[n.toLowerCase()]=l[n];return r}!function(){let e,t,i=navigator.languages&&navigator.languages[0]||navigator.language;if(i){let r=i.split("-");e=r[0],r.length>1&&(t=r[1])}else e="zh",t="CN";!function(e,t){s.lang=e,s.district=t}(e,t)}()},function(e,t,i){"use strict";var r=i(49);i.d(t,"CApp",function(){return r.a});i(81),i(54),i(56),i(32),i(53),i(45),i(55),i(58),i(57);var n=i(17);i.d(t,"PureJSONContent",function(){return n.b});i(34);var s=i(82);i.o(s,"tv")&&i.d(t,"tv",function(){return s.tv});i(51),i(8),i(24),i(50)},function(e,t,i){"use strict";var r=i(2),n=i(7),s=i(14),o=i.n(s);const a="\t",l="\n";class c{constructor(e,t,i){this.fieldMaps={},this.entities=e,this.name=t,this.typeId=i,this.sys=this.name.indexOf("$")>=0}get sName(){return this.jName||this.name}get tvApi(){return this.entities.usqApi}getApiFrom(){return r.a(this,void 0,void 0,function*(){return this.entities.usqApi})}fieldMap(e){void 0===e&&(e="$");let t=this.fieldMaps[e];if(void 0===t){let i;if("$"===e)i=this.fields;else if(void 0!==this.arrFields){let t=this.arrFields.find(t=>t.name===e);void 0!==t&&(i=t.fields)}else if(void 0!==this.returns){let t=this.returns.find(t=>t.name===e);void 0!==t&&(i=t.fields)}if(void 0===i)return{};t={};for(let e of i)t[e.name]=e;this.fieldMaps[e]=t}return t}loadSchema(){return r.a(this,void 0,void 0,function*(){if(void 0!==this.schema)return;let e=yield this.entities.usqApi.schema(this.name);this.setSchema(e)})}setSchema(e){if(void 0===e)return;if(void 0!==this.schema)return;this.schema=e;let{name:t,fields:i,arrs:r,returns:n}=e;t!==this.name&&(this.jName=t),this.entities.buildFieldTuid(this.fields=i),this.entities.buildArrFieldsTuid(this.arrFields=r,i),this.entities.buildArrFieldsTuid(this.returns=n,i)}schemaStringify(){return JSON.stringify(this.schema,(e,t)=>{if("_tuid"!==e)return t},4)}tuidFromField(e){let{_tuid:t,tuid:i}=e;if(void 0!==i)return void 0!==t?t:e._tuid=this.entities.getTuid(i,void 0)}tuidFromName(e,t){if(void 0===this.schema)return;let{fields:i,arrs:r}=this.schema,n=this.entities;function s(e,t){if(void 0===t)return;let i=t.find(t=>t.name===e);return void 0!==i?n.getTuid(i.tuid,void 0):void 0}let o=e.toLowerCase();if(void 0===t)return s(o,i);if(void 0===r)return;let a=t.toLowerCase(),l=r.find(e=>e.name===a);return void 0!==l?s(o,l.fields):void 0}pack(e){let t=[],i=this.fields;void 0!==i&&this.packRow(t,i,e);let r=this.arrFields;if(void 0!==r)for(let n of r)this.packArr(t,n.fields,e[n.name]);return t.join("")}escape(e,t){let i=e[t.name];switch(typeof i){default:return i;case"object":let e=t._tuid;return void 0===e?i.id:e.getIdFromObj(i);case"string":let r=i.length,n="",s=0;for(let t=0;t<r;t++){switch(i.charCodeAt(t)){case 9:n+=i.substring(s,t)+"\\t",s=t+1;break;case 10:n+=i.substring(s,t)+"\\n",s=t+1}}return n+i.substring(s);case"undefined":return""}}packRow(e,t,i){let r=t.length;if(0===r)return;let n="";n+=this.escape(i,t[0]);for(let s=1;s<r;s++){let e=t[s];n+=a+this.escape(i,e)}e.push(n+l)}packArr(e,t,i){if(void 0!==i)for(let r of i)this.packRow(e,t,r);e.push(l)}unpackSheet(e){let t={},i=this.fields,r=0;void 0!==i&&(r=this.unpackRow(t,i,e,r));let n=this.arrFields;if(void 0!==n)for(let s of n)r=this.unpackArr(t,s,e,r);return t}unpackReturns(e){let t={},i=0,r=this.returns;if(void 0!==r)for(let n of r)i=this.unpackArr(t,n,e,i);return t}unpackRow(e,t,i,r){let n=0,s=0,o=r,a=0,l=i.length,c=t.length;for(;r<l;r++)if(n=s,9===(s=i.charCodeAt(r))){let s=t[a];if(8!==n){if(r>o){let t=i.substring(o,r);e[s.name]=this.to(e,t,s)}}else e[s.name]=null;if(o=r+1,++a>=c)break}else if(10===s){let s=t[a];if(8!==n){if(r>o){let t=i.substring(o,r);e[s.name]=this.to(e,t,s)}}else e[s.name]=null;++r,++a;break}return r}to(e,t,i){switch(i.type){default:return t;case"datetime":case"date":case"time":return new Date(Number(t));case"tinyint":case"smallint":case"int":case"dec":return Number(t);case"bigint":let e=Number(t),{_tuid:r}=i;return void 0===r?e:(console.log(this.name,"bigint",t,"tuid",r.name),r.useId(e,!0),r.boxId(e))}}unpackArr(e,t,i,r){let n=[],s=i.length,{name:o,fields:a}=t;for(;r<s;){if(10===i.charCodeAt(r)){++r;break}let e={};n.push(e),r=this.unpackRow(e,a,i,r)}return e[o]=n,r}}var u=i(88);const h=1e3;class d extends c{constructor(e,t,i){super(e,t,i),this.queue=[],this.waitingIds=[],this.cache=n.l.map({},{deep:!1}),this.buildIdBoxer()}get typeName(){return"tuid"}buildIdBoxer(){this.BoxId=function(){};let e=this.BoxId.prototype;Object.defineProperty(e,"_$tuid",{value:this,writable:!1,enumerable:!1}),Object.defineProperty(e,"obj",{enumerable:!1,get:function(){if(!(void 0===this.id||this.id<=0))return this._$tuid.valueFromId(this.id)}}),e.valueFromFieldName=function(e){return this._$tuid.valueFromFieldName(e,this.obj)},e.toJSON=function(){return this.id}}boxId(e){this.useId(e);let t=new this.BoxId;return t.id=e,t}getTuidContent(){return this.entities.cUsq.getTuidContent(this)}getIdFromObj(e){return e[this.idName]}setSchema(e){super.setSchema(e);let{id:t,unique:i}=e;this.idName=t,this.unique=i,this.schemaFrom=this.schema.from}moveToHead(e){let t=this.queue.findIndex(t=>t===e);this.queue.splice(t,1),this.queue.push(e)}valueFromId(e){let t;switch(typeof e){case"object":t=e.id;break;case"number":t=e;break;default:return}let i=this.cache.get(t);return void 0!==this.owner&&"object"===typeof i&&(i.$owner=this.owner.boxId(i.owner)),i}valueFromFieldName(e,t){if(void 0===t)return;let i=this.fields.find(t=>t.name===e);if(void 0===i)return;let r=t[e],{_tuid:n}=i;return void 0===n?r:n.valueFromId(r)}resetCache(e){this.cache.delete(e);let t=this.queue.findIndex(t=>t===e);this.queue.splice(t,1),this.useId(e)}useId(e,t){if(void 0!==e&&0!==e&&!1!==Object(u.isNumber)(e))if(!0!==this.cache.has(e))if(this.entities.cacheTuids(!0===t?70:20),this.cache.set(e,e),this.waitingIds.findIndex(t=>t===e)>=0)this.moveToHead(e);else{if(console.log("// \u5982\u679c\u6ca1\u6709\u7f13\u51b2, \u6216\u8005\u6ca1\u6709waiting"),this.queue.length>=h){let t=this.queue.shift();if(t===e)return void this.queue.push(t);if(!0===this.cache.has(t))this.cache.delete(t);else{let e=this.waitingIds.findIndex(e=>e===t);this.waitingIds.splice(e,1)}}console.log("this.waitingIds.push(id)",e),this.waitingIds.push(e),this.queue.push(e)}else this.moveToHead(e)}proxied(e,t){return r.a(this,void 0,void 0,function*(){this.entities.getTuid(e,void 0).useId(t);let i=yield this.tvApi.proxied(this.name,e,t);return this.cacheValue(i),i})}cacheValue(e){if(void 0===e)return!1;let t=this.getIdFromObj(e);if(void 0===t)return!1;let i=this.waitingIds.findIndex(e=>e===t);return i>=0&&this.waitingIds.splice(i,1),this.cache.set(t,e),!0}afterCacheId(e){for(let t of this.fields){let{_tuid:i}=t;void 0!==i&&i.useId(e[t.name])}}cacheIds(){return r.a(this,void 0,void 0,function*(){if(0===this.waitingIds.length)return;let e,t;void 0===this.owner?e=this.name:(e=this.owner.name,t=this.name);let i=yield this.getApiFrom(),r=yield i.tuidIds(e,t,this.waitingIds);for(let n of r)!1!==this.cacheValue(n)&&(this.cacheTuidFieldValues(n),this.afterCacheId(n))})}load(e){return r.a(this,void 0,void 0,function*(){if(void 0===e||0===e)return;let t=yield this.getApiFrom(),i=yield t.tuidGet(this.name,e);return void 0!==i?(i._$tuid=this,this.cacheValue(i),this.cacheTuidFieldValues(i),i):void 0})}getDiv(e){}cacheTuidFieldValues(e){let{fields:t,arrs:i}=this.schema;if(this.cacheFieldsInValue(e,t),void 0!==i)for(let r of i){let{name:t,fields:i}=r,n=e[t];if(void 0===n)continue;let s=this.getDiv(t);for(let e of n)e._$tuid=s,e.$owner=this.boxId(e.owner),this.cacheFieldsInValue(e,i)}}cacheFieldsInValue(e,t){for(let i of t){let{name:t,_tuid:r}=i;if(void 0===r)continue;let n=e[t];e[t]=r.boxId(n)}}save(e,t){return r.a(this,void 0,void 0,function*(){let i=o.a.clone(t);i.$id=e;let r=yield this.tvApi.tuidSave(this.name,i),{id:n,inId:s}=r;return void 0===n?(i.id=e,this.cacheValue(i)):n>0&&(i.id=n,this.cacheValue(i)),r})}search(e,t,i){return r.a(this,void 0,void 0,function*(){return yield this.searchArr(void 0,e,t,i)})}searchArr(e,t,i,n){return r.a(this,void 0,void 0,function*(){let r,s,{fields:o}=this.schema;void 0!==this.owner?(r=this.owner.name,s=this.name):(r=this.name,s=void 0);let a=yield this.getApiFrom(),l=yield a.tuidSearch(r,s,e,t,i,n);for(let e of l)this.cacheFieldsInValue(e,o),void 0!==this.owner&&(e.$owner=this.owner.boxId(e.owner));return l})}loadArr(e,t,i){return r.a(this,void 0,void 0,function*(){if(void 0===i||0===i)return;let r=yield this.getApiFrom();return yield r.tuidArrGet(this.name,e,t,i)})}saveArr(e,t,i,n){return r.a(this,void 0,void 0,function*(){let r=o.a.clone(n);return r.$id=i,yield this.tvApi.tuidArrSave(this.name,e,t,r)})}posArr(e,t,i,n){return r.a(this,void 0,void 0,function*(){return yield this.tvApi.tuidArrPos(this.name,e,t,i,n)})}showInfo(e){return r.a(this,void 0,void 0,function*(){yield this.entities.cUsq.showTuid(this,e)})}}class p extends d{get Main(){return this}get usqApi(){return this.entities.usqApi}setSchema(e){super.setSchema(e);let{arrs:t}=e;if(void 0!==t){this.divs={};for(let e of t){let{name:t}=e,i=new m(this.entities,t,this.typeId);i.owner=this,this.divs[t]=i,i.setSchema(e)}}}getDiv(e){return this.divs[e]}cacheIds(){const e=Object.create(null,{cacheIds:{get:()=>super.cacheIds}});return r.a(this,void 0,void 0,function*(){if(yield e.cacheIds.call(this),void 0!==this.divs)for(let e in this.divs)yield this.divs[e].cacheIds()})}cUsqFrom(){return r.a(this,void 0,void 0,function*(){if(void 0===this.schemaFrom)return this.entities.cUsq;let{owner:e,usq:t}=this.schemaFrom,i=yield this.entities.cUsq,r=i.cApp;if(void 0===r)return i;let n=yield r.getImportUsq(e,t);if(void 0===n)return console.error(`${e}/${t} \u4e0d\u5b58\u5728`),i;let s=yield n.loadSchema();return void 0!==s?(console.error("cUsq.loadSchema: "+s),i):n})}getApiFrom(){return r.a(this,void 0,void 0,function*(){let e=yield this.from();return void 0!==e?e.entities.usqApi:this.entities.usqApi})}from(){return r.a(this,void 0,void 0,function*(){return(yield this.cUsqFrom()).tuid(this.name)})}cFrom(){return r.a(this,void 0,void 0,function*(){return(yield this.cUsqFrom()).cTuidMainFromName(this.name)})}cEditFrom(){return r.a(this,void 0,void 0,function*(){return(yield this.cUsqFrom()).cTuidEditFromName(this.name)})}cInfoFrom(){return r.a(this,void 0,void 0,function*(){return(yield this.cUsqFrom()).cTuidInfoFromName(this.name)})}cSelectFrom(){return r.a(this,void 0,void 0,function*(){let e=yield this.cUsqFrom();if(void 0!==e)return e.cTuidSelectFromName(this.name)})}afterCacheId(e){if(super.afterCacheId(e),void 0===this.proxies)return;let{type:t,$proxy:i}=e;this.proxies[t].useId(i)}}class m extends d{get Main(){return this.owner}getApiFrom(){return r.a(this,void 0,void 0,function*(){return yield this.owner.getApiFrom()})}}class f extends c{get typeName(){return"action"}submit(e){return r.a(this,void 0,void 0,function*(){yield this.loadSchema();let t=this.pack(e);return yield this.tvApi.action(this.name,{data:t})})}}var v=i(4);class g extends c{get typeName(){return"sheet"}setSchema(e){super.setSchema(e),this.states=e.states}build(e){this.states=[];for(let t of e.ops)this.states.push({name:t,actions:void 0})}createSheetState(e,t){let i={name:e,actions:[]},r=i.actions;for(let n in t){let e={name:n};r.push(e)}return i}save(e,t){return r.a(this,void 0,void 0,function*(){let{appId:i}=this.entities,r=this.pack(t);return yield this.tvApi.sheetSave(this.name,{app:i,discription:e,data:r})})}action(e,t,i,n){return r.a(this,void 0,void 0,function*(){return yield this.tvApi.sheetAction(this.name,{id:e,flow:t,state:i,action:n})})}unpack(e){return r.a(this,void 0,void 0,function*(){let t=e[0][0];return{brief:t,data:this.unpackSheet(t.data),flows:e[1]}})}getSheet(e){return r.a(this,void 0,void 0,function*(){let t=yield this.tvApi.getSheet(this.name,e);return 0===t[0].length?yield this.getArchive(e):yield this.unpack(t)})}getArchive(e){return r.a(this,void 0,void 0,function*(){let t=yield this.tvApi.sheetArchive(this.name,e);return yield this.unpack(t)})}getArchives(e,t){return r.a(this,void 0,void 0,function*(){return yield this.tvApi.sheetArchives(this.name,{pageStart:e,pageSize:t})})}getStateSheets(e,t,i){return r.a(this,void 0,void 0,function*(){return yield this.tvApi.stateSheets(this.name,{state:e,pageStart:t,pageSize:i})})}createPageStateItems(){return new y(this)}stateSheetCount(){return r.a(this,void 0,void 0,function*(){let e=yield this.tvApi.stateSheetCount(this.name);return this.states.map(t=>{let i=t.name,r=0,n=e.find(e=>e.state===i);return void 0!==n&&(r=n.count),{state:i,count:r}})})}}class y extends v.PageItems{constructor(e){super(!0),this.sheet=e,this.pageSize=10}load(e,t,i){return r.a(this,void 0,void 0,function*(){return yield this.sheet.getStateSheets(e,t,i)})}setPageStart(e){this.pageStart=void 0===e?0:e.id}}class b extends c{get typeName(){return"query"}setSchema(e){super.setSchema(e);let{returns:t}=e;this.returns=t,this.isPaged=void 0!==t.find(e=>"$page"===e.name)}resetPage(e,t){this.pageStart=void 0,this.pageSize=e,this.params=t,this.more=!1,this.list=void 0}get hasMore(){return this.more}loadPage(){return r.a(this,void 0,void 0,function*(){if(void 0===this.pageSize)throw"call resetPage(size:number, params:any) first";let e;if(void 0!==this.pageStart)switch(this.startField.type){default:e=this.pageStart;break;case"date":case"time":case"datetime":e=this.pageStart.getTime()}yield this.loadSchema();let t=yield this.tvApi.page(this.name,e,this.pageSize+1,this.params),i=yield this.unpackReturns(t);this.list=n.l.array([],{deep:!1});let r=i.$page;if(void 0!==r){if(r.length>this.pageSize){this.more=!0,r.pop();let e=this.returns.find(e=>"$page"===e.name);this.startField=e.fields[0],this.pageStart=r[r.length-1][this.startField.name]}else this.more=!1;this.list.push(...r)}})}page(e,t,i){return r.a(this,void 0,void 0,function*(){yield this.loadSchema();let r=yield this.tvApi.page(this.name,t,i+1,e);return(yield this.unpackReturns(r)).$page})}query(e){return r.a(this,void 0,void 0,function*(){yield this.loadSchema();let t=yield this.tvApi.query(this.name,e);return yield this.unpackReturns(t)})}table(e){return r.a(this,void 0,void 0,function*(){let t=yield this.query(e);for(let e in t)return t[e]})}obj(e){return r.a(this,void 0,void 0,function*(){let t=yield this.table(e);if(t.length>0)return t[0]})}scalar(e){return r.a(this,void 0,void 0,function*(){let t=yield this.obj(e);for(let e in t)return t[e]})}}r.b([n.l],b.prototype,"list",void 0);class w extends b{constructor(){super(...arguments),this.queryApiName="book"}get typeName(){return"book"}}class E extends b{constructor(){super(...arguments),this.queryApiName="history"}get typeName(){return"history"}}class C extends c{constructor(){super(...arguments),this.actions={},this.queries={}}get typeName(){return"map"}setSchema(e){super.setSchema(e),this.schemaFrom=this.schema.from;let{actions:t,queries:i,keys:r}=e;this.entities.buildFieldTuid(this.keys=r);for(let n in t){let e=t[n],{name:i}=e,r=this.entities.newAction(i,void 0);r.setSchema(e),this.actions[n]=r}for(let n in i){let e=i[n],{name:t}=e,r=this.entities.newQuery(t,void 0);r.setSchema(e),this.queries[n]=r}}add(e){return r.a(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.actions.add.submit(e)})}del(e){return r.a(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.actions.del.submit(e)})}all(){return r.a(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.queries.all.query({})})}page(e,t,i){return r.a(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.queries.page.page(e,t,i)})}query(e){return r.a(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.queries.query.query(e)})}table(e){return r.a(this,void 0,void 0,function*(){let t=yield this.query(e);for(let e in t)return t[e]})}obj(e){return r.a(this,void 0,void 0,function*(){let t=yield this.table(e);if(t.length>0)return t[0]})}scalar(e){return r.a(this,void 0,void 0,function*(){let t=yield this.obj(e);for(let e in t)return t[e]})}}class k extends b{constructor(){super(...arguments),this.queryApiName="pending"}get typeName(){return"pending"}}function N(e){switch(e){case"tinyint":case"smallint":case"int":case"bigint":case"dec":return 0;case"char":case"text":return"";case"datetime":case"date":return"2000-1-1";case"time":return"0:00"}}class x{constructor(e,t,i){this.tuids={},this.actions={},this.sheets={},this.queries={},this.books={},this.maps={},this.histories={},this.pendings={},this.tuidArr=[],this.actionArr=[],this.sheetArr=[],this.queryArr=[],this.bookArr=[],this.mapArr=[],this.historyArr=[],this.pendingArr=[],this.loadIds=(()=>{this.clearCacheTimer();for(let e in this.tuids){this.tuids[e].cacheIds()}}),this.cUsq=e,this.usqApi=t,this.appId=i}tuid(e){return this.tuids[e.toLowerCase()]}action(e){return this.actions[e.toLowerCase()]}sheet(e){return this.sheets[e.toLowerCase()]}query(e){return this.queries[e.toLowerCase()]}book(e){return this.books[e.toLowerCase()]}map(e){return this.maps[e.toLowerCase()]}history(e){return this.histories[e.toLowerCase()]}pending(e){return this.pendings[e.toLowerCase()]}sheetFromTypeId(e){for(let t in this.sheets){let i=this.sheets[t];if(i.typeId===e)return i}}loadAccess(){return r.a(this,void 0,void 0,function*(){let e=yield this.usqApi.loadAccess();this.buildEntities(e)})}loadEntities(){return r.a(this,void 0,void 0,function*(){let e=yield this.usqApi.loadEntities();this.buildEntities(e)})}buildEntities(e){let{access:t,tuids:i}=e;this.buildTuids(i),this.buildAccess(t)}getTuid(e,t,i){let r=this.tuids[e];if(void 0!==r)return void 0===t?r:r.divs[t]}cacheTuids(e){this.clearCacheTimer(),this.cacheTimer=setTimeout(this.loadIds,e)}clearCacheTimer(){void 0!==this.cacheTimer&&(clearTimeout(this.cacheTimer),this.cacheTimer=void 0)}buildTuids(e){let t={};for(let i in e){let r=e[i],{name:n,typeId:s,proxies:o}=r;this.newTuid(i,s).sys=!0,void 0!==o&&(t[i]=o)}for(let i in e){let t=e[i],{name:r}=t;this.getTuid(i).setSchema(t)}for(let i in t){let e=t[i],r=this.tuids[i];r.proxies={};for(let t of e)r.proxies[t]=this.tuids[t]}}buildAccess(e){for(let t in e){let i=e[t];switch(typeof i){case"string":this.fromType(t,i);break;case"object":this.fromObj(t,i)}}}newAction(e,t){let i=this.actions[e];return void 0!==i?i:(i=this.actions[e]=new f(this,e,t),this.actionArr.push(i),i)}newTuid(e,t){let i=this.tuids[e];return void 0!==i?i:(i=this.tuids[e]=new p(this,e,t),this.tuidArr.push(i),i)}newQuery(e,t){let i=this.queries[e];return void 0!==i?i:(i=this.queries[e]=new b(this,e,t),this.queryArr.push(i),i)}newBook(e,t){let i=this.books[e];return void 0!==i?i:(i=this.books[e]=new w(this,e,t),this.bookArr.push(i),i)}newMap(e,t){let i=this.maps[e];return void 0!==i?i:(i=this.maps[e]=new C(this,e,t),this.mapArr.push(i),i)}newHistory(e,t){let i=this.histories[e];if(void 0===i)return i=this.histories[e]=new E(this,e,t),this.historyArr.push(i),i}newPending(e,t){let i=this.pendings[e];if(void 0===i)return i=this.pendings[e]=new k(this,e,t),this.pendingArr.push(i),i}newSheet(e,t){let i=this.sheets[e];return void 0!==i?i:(i=this.sheets[e]=new g(this,e,t),this.sheetArr.push(i),i)}fromType(e,t){let i=t.split("|");t=i[0];let r=Number(i[1]);switch(t){case"usq":this.usqId=r;break;case"tuid":this.newTuid(e,r).sys=!1;break;case"action":this.newAction(e,r);break;case"query":this.newQuery(e,r);break;case"book":this.newBook(e,r);break;case"map":this.newMap(e,r);break;case"history":this.newHistory(e,r);break;case"sheet":this.newSheet(e,r);break;case"pending":this.newPending(e,r)}}fromObj(e,t){switch(t.$){case"sheet":this.buildSheet(e,t)}}buildSheet(e,t){let i=this.sheets[e];void 0===i&&(i=this.newSheet(e,t.id)),i.build(t)}buildFieldTuid(e,t){if(void 0!==e){for(let t of e){let{tuid:e,arr:i,url:r}=t;void 0!==e&&(t._tuid=this.getTuid(e,i,r))}for(let i of e){let{owner:r}=i;if(void 0===r)continue;let n=e.find(e=>e.name===r);if(void 0===n&&(void 0!==t&&(n=t.find(e=>e.name===r)),void 0===n))throw`owner field ${r} is undefined`;i._ownerField=n;let{arr:s,url:o}=i;if(i._tuid=this.getTuid(n._tuid.name,s,o),void 0===i._tuid)throw"owner field ${owner} is not tuid"}}}buildArrFieldsTuid(e,t){if(void 0!==e)for(let i of e){let{fields:e}=i;void 0!==e&&this.buildFieldTuid(e,t)}}}i.d(t,"b",function(){return N}),i.d(t,"a",function(){return x})},function(e,t,i){"use strict";var r=i(0),n=i(9),s=i(10),o=i.n(s),a=i(2),l=i(14),c=i.n(l);class u{}class h extends u{constructor(e){super(),this.func=e}check(e,t){let i=this.func(t);if(void 0!==i)switch(typeof i){case"undefined":return;case"string":return void e.push(i);default:return void e.push(...i)}}}class d extends u{constructor(e){super(),this.res=e}}class p extends d{check(e,t){switch(typeof t){default:case"boolean":return;case"object":if(null!==t)return;break;case"string":if(t.trim().length>0)return;break;case"number":if(NaN!==t)return;break;case"undefined":}e.push(this.res.required)}}class m extends d{constructor(e,t,i){super(e),this.minMsg=c.a.template(e.min),this.maxMsg=c.a.template(e.max),this.min=t,this.max=i}check(e,t){if(void 0===t||null===t)return;let i=Number(t);NaN===i?e.push(this.res.number):this.checkMore(e,i)}checkMore(e,t){void 0!==this.min&&Number(t)<this.min&&e.push(this.minMsg({min:this.min})),void 0!==this.max&&Number(t)>this.max&&e.push(this.maxMsg({max:this.max}))}}class f extends m{checkMore(e,t){super.checkMore(e,t),!1===Number.isInteger(t)&&e.push(this.res.integer)}}var v=i(7);class g{constructor(e,t,i,r){this.errors=[],this.contextErrors=[],this.onInputChange=(e=>{this.changeValue(e.target.value,!0)}),this.context=e;let{name:n}=t;if(this.name=n,this.itemSchema=t,this.fieldProps=i,this.children=r,this.ui=e.getUiItem(n),void 0===this.ui)this.readOnly=!1,this.disabled=!1,this.visible=!0;else{let{readOnly:e,disabled:t,visible:i}=this.ui;this.readOnly=!0===e,this.disabled=!0===t,this.visible=!(!1===i)}this.value=this.defaultValue=e.getValue(n),this.init()}get hasError(){return this.errors.length+this.contextErrors.length>0}init(){if(this.rules=[],!0===this.itemSchema.required&&this.rules.push(new p(this.context.form.res)),this.buildRules(),void 0===this.ui)return;let{rules:e}=this.ui;if(void 0!==e)if(!1!==Array.isArray(e))for(let t of e)this.rules.push(new h(t));else this.rules.push(new h(e))}buildRules(){}checkRules(){let e=[];for(let t of this.rules)t.check(e,this.value);0===e.length?this.context.removeErrorWidget(this):(this.context.addErrorWidget(this),this.errors.push(...e))}get isOk(){return 0===this.errors.length}setError(e){void 0!==e&&("string"===typeof e?this.errors.push(e):this.errors.push(...e))}setContextError(e){void 0!==e&&("string"===typeof e?this.contextErrors.push(e):this.contextErrors.push(...e))}clearError(){this.errors.splice(0)}clearContextError(){this.contextErrors.splice(0)}parse(e){return e}setElementValue(e){}setDataValue(e){!0!==this.isChanging&&(this.context.initData[this.name]=this.value=this.parse(e))}setValue(e){!0!==this.isChanging&&this.changeValue(e,!1)}getValue(){return this.context.getValue(this.name)}getReadOnly(){return this.readOnly}getDisabled(){return this.disabled}getVisible(){return this.visible}setReadOnly(e){this.readOnly=e}setDisabled(e){this.disabled=e}setVisible(e){this.visible=e}changeValue(e,t){let i,r,n=this.value;void 0!==this.ui&&(i=this.ui.onChanging,r=this.ui.onChanged);let s=!0;void 0!==i&&(this.isChanging=!0,s=i(this.context,this.value,n),this.isChanging=!1),!0===s&&(this.setDataValue(e),!0!==t&&this.setElementValue(e),void 0!==r&&(this.isChanging=!0,r(this.context,this.value,n),this.isChanging=!1))}get className(){let e;return!1===this.context.inNode&&(e="form-control"),o()(e,this.context.form.FieldClass,this.ui&&this.ui.className)}renderContainer(){if(!1===this.visible)return null;let e,{form:t,inNode:i}=this.context;if(!0===i)return this.render();if(void 0===this.ui)e=this.name;else{let t=this.ui.label;null===t&&(e=null),e=t||this.name}return!0===this.itemSchema.required&&!1!==t.props.requiredFlag&&null!==e&&(e=r.createElement(r.Fragment,null,e,"\xa0",r.createElement("span",{className:"text-danger"},"*"))),t.FieldContainer(e,this.render())}renderTemplet(){if(void 0!==this.children)return r.createElement(r.Fragment,null,this.children);if(void 0===this.ui)return;let{Templet:e}=this.ui;return"function"===typeof e?e(this.value):e}renderErrors(){let e=[...this.errors,...this.contextErrors];if(0===e.length)return null;let{inNode:t}=this.context,i=!0===t?"span":"div";return e.map(e=>r.createElement(i,{key:e,className:"text-danger d-inline-block my-2 ml-3"},r.createElement(r.Fragment,null,r.createElement("i",{className:"fa fa-exclamation-circle"})," \xa0",e)))}}a.b([v.l],g.prototype,"errors",void 0),a.b([v.l],g.prototype,"contextErrors",void 0),a.b([v.e],g.prototype,"hasError",null),a.b([v.l],g.prototype,"visible",void 0),a.b([v.e],g.prototype,"isOk",null);class y extends g{constructor(){super(...arguments),this.inputType="text"}setElementValue(e){null!==this.input&&(this.input.value=e)}get placeholder(){return this.ui&&this.ui.placeholder||this.name}onBlur(){this.checkRules(),this.context.checkContextRules()}onFocus(){this.clearError(),this.context.removeErrorWidget(this),this.context.removeErrors()}setReadOnly(e){null!==this.input&&(this.input.readOnly=this.readOnly=e)}setDisabled(e){null!==this.input&&(this.input.disabled=this.disabled=e)}render(){let e=this.renderTemplet();if(void 0!==e)return e;let t={};return!0===this.hasError?t["is-invalid"]=!0:t["required-item"]=!0===this.itemSchema.required,r.createElement(r.Fragment,null,r.createElement("input",{ref:e=>this.input=e,className:o()(this.className,t),type:this.inputType,defaultValue:this.value,onChange:this.onInputChange,placeholder:this.placeholder,readOnly:this.readOnly,disabled:this.disabled,onKeyDown:this.onKeyDown,onFocus:()=>this.onFocus(),onBlur:()=>this.onBlur(),maxLength:this.itemSchema.maxLength}),this.renderErrors())}}class b extends y{constructor(){super(...arguments),this.inputType="number"}buildRules(){super.buildRules();let e=this.context.form.res,{min:t,max:i}=this.itemSchema;this.rules.push("integer"===this.itemSchema.type?new m(e,t,i):new f(e,t,i))}parse(e){if(void 0!==e&&null!==e)return Number(e)}}class w extends b{constructor(){super(...arguments),this.inputType="number",this.onKeyDown=(e=>{let t=e.keyCode;event.returnValue=this.isValidKey(t)})}isValidKey(e){return 46===e||8===e||37===e||39===e||e>=48&&e<=57||e>=96&&e<=105||109===e||189===e}}class E extends y{constructor(){super(...arguments),this.inputType="date"}}class C extends g{constructor(){super(...arguments),this.onInputChange=(e=>{this.setDataValue(!0===e.target.checked?this.trueValue:this.falseValue)}),this.onClick=(()=>{this.context.removeErrors()})}init(){if(super.init(),void 0!==this.ui){let{trueValue:e,falseValue:t}=this.ui;this.trueValue=void 0===e||e,this.falseValue=void 0!==t&&t}else this.trueValue=!0,this.falseValue=!1}setElementValue(e){this.input.checked=e===this.trueValue}setReadOnly(e){this.input.readOnly=this.readOnly=e}setDisabled(e){this.input.disabled=this.disabled=e}render(){let e=o()(this.className,"form-check-inline"),t=r.createElement("input",{ref:e=>this.input=e,className:"align-self-center",type:"checkbox",defaultChecked:this.defaultValue,onChange:this.onInputChange,onClick:this.onClick});return this.context.inNode?r.createElement("label",{className:e},t," ",this.ui&&this.ui.label||this.name):r.createElement("div",{className:e},t)}}class k extends g{constructor(){super(...arguments),this.onInputChange=(e=>{this.setDataValue(e.target.value)})}setElementValue(e){this.select.value=e}setReadOnly(e){this.select.disabled=this.readOnly=!e}setDisabled(e){this.select.disabled=this.disabled=e}render(){if(!0===this.readOnly){let e=this.ui.list.find(e=>e.value===this.value),t=void 0===e?"(???)":e.title;return r.createElement("span",{className:"form-control w-min-6c"},t)}return r.createElement("select",{ref:e=>this.select=e,className:o()(this.className,"form-control"),defaultValue:this.defaultValue,onChange:this.onInputChange},this.ui.list.map((e,t)=>{let{title:i,value:n}=e;return r.createElement("option",{className:void 0,key:t,value:n},i||n)}))}}a.b([v.l],k.prototype,"readOnly",void 0);class N extends g{constructor(){super(...arguments),this.onClick=(()=>a.a(this,void 0,void 0,function*(){let e=this.ui&&this.ui.pickId;if(void 0===e)return void alert("no pickId defined!");let t=yield e(this.context,this.name,this.value);this.setDataValue(t),this.clearError(),this.clearContextError(),this.checkRules()}))}setReadOnly(e){this.readOnly=e}setDisabled(e){this.disabled=e}render(){let e,t;void 0!==this.ui&&(e=this.ui.placeholder,t=this.ui.Templet);let i,n={"form-control":!0,"required-item":!0===this.itemSchema.required,"cursor-pointer":!0,"is-invalid":this.hasError};return void 0===this.value||null===this.value?(i=e||"placeholder",n["text-muted"]=!0):i=void 0===t?r.createElement(r.Fragment,null,this.value):"function"===typeof t?t(this.value):t,r.createElement(r.Fragment,null,r.createElement("div",{className:o()(n),onClick:this.onClick},i),this.renderErrors())}}a.b([v.l],N.prototype,"value",void 0);const x=(e,t,i)=>r.createElement("span",{className:"text-danger"},"!!data type ",e," only support ",(i||[]).join(", "),", can't use ui ",t,"!!");class S extends g{constructor(){super(...arguments),this.onClick=(()=>a.a(this,void 0,void 0,function*(){this.clearError(),this.clearContextError();let{name:e,type:t}=this.itemSchema;if("submit"===t&&(this.context.checkRules(),!0===this.context.hasError))return;let{onButtonClick:i}=this.context.form.props;if(void 0===i)return void alert(`button ${e} clicked. you should define form onButtonClick`);let r=yield i(e,this.context);void 0!==r&&this.context.setError(e,r)})),this.observerRender=Object(n.a)(()=>{let e,t,i,{name:n,type:s}=this.itemSchema;if(void 0!==this.ui){let{widget:r}=this.ui;if("button"!==r)return x(s,r,["button"]);e=this.ui.Templet,t=this.ui.className,i=this.ui.label}let o,{form:a,hasError:l}=this.context,c=this.context,u="submit"===s&&l;o=void 0!==this.children?this.children:"function"===typeof e?e():void 0!==e?e:i;let h=r.createElement("button",{className:t,type:"button",disabled:u,onClick:this.onClick},o||n);return!0===c.inNode?r.createElement(r.Fragment,null,h,this.renderErrors()):r.createElement("div",{className:a.ButtonClass},r.createElement("div",null,this.renderErrors()),h)})}render(){return r.createElement(this.observerRender,null)}renderContainer(){if(!1===this.visible)return null;let{form:e,inNode:t}=this.context;return!0===t?this.render():e.FieldContainer(null,this.render())}}var P=i(16);const O=Object(n.a)(({parentContext:e,arrSchema:t,children:i})=>{let s,a,l,c,{name:u,arr:h}=t,d=e.initData[u],{form:p}=e,m=e.getArrRowContexts(u),f=e.getUiItem(u),v=u,{ArrContainer:g,RowContainer:y,RowSeperator:b,uiSchema:w}=p;if(void 0!==w){let{selectable:e,deletable:t,restorable:i}=w;!0!==a&&(a=e),!0!==l&&(l=t),!0!==c&&(c=i)}if(void 0!==f){let{widget:e,label:i,selectable:r,deletable:n,restorable:o,ArrContainer:u,RowContainer:h,RowSeperator:d}=f;if(void 0!==r&&(a=r),void 0!==n&&(l=n),void 0!==o&&(c=o),void 0!==u&&(g=u),void 0!==h&&(y=h),void 0!==d&&(b=d),s=f.Templet,"arr"!==e)return x(t.type,e,["arr"]);v=i||v}let E=!0;return g(v,r.createElement(r.Fragment,null,d.map((u,p)=>{let f,v,g=void 0;if(!1===E?g=b:E=!1,void 0!==i)f=new P.c(e,t,u,!0),v=r.createElement(r.Fragment,null,i);else{let i=typeof s;"function"===i?(f=new P.c(e,t,u,!0),v=r.createElement(Object(n.a)(s),u)):"object"===i?(f=new P.c(e,t,u,!0),v=s):(f=new P.c(e,t,u,!1),v=r.createElement(r.Fragment,null,h.map((e,t)=>r.createElement(r.Fragment,{key:e.name},V(f,e,void 0)))))}let w,C,{rowKey:k}=f;if(m[k]=f,!0===a){let e=e=>{u.$isSelected=e.target.checked,f.removeErrors()};w=r.createElement("div",{className:"form-row-checkbox"},r.createElement("input",{type:"checkbox",onClick:e}))}let N=!(void 0===u.$isDeleted||!1===u.$isDeleted);if(!0===l){let e=N?"fa-undo":"fa-trash",t=()=>{if(!0===c)u.$isDeleted=!N;else{let e=d.indexOf(u);e>=0&&d.splice(e,1)}f.removeErrors()};C=r.createElement("div",{className:"form-row-edit align-self-start text-info cursor-pointer",onClick:t},r.createElement("i",{className:o()("fa",e,"fa-fw")}))}let x=!0===a||!0===l?e=>r.createElement("fieldset",{disabled:N},r.createElement("div",{className:o()("d-flex",{deleted:N,"row-selected":u.$isSelected})},w,r.createElement("div",{className:"flex-grow-1"},e),C)):e=>e;return r.createElement(P.a.Provider,{key:k,value:f},g,y(x(r.createElement(r.Fragment,null,r.createElement(f.renderErrors,null),v))))})))}),F={id:{dataTypes:["id"],widget:N},text:{dataTypes:["integer","number","string"],widget:y},textarea:{dataTypes:["string"],widget:class extends g{constructor(){super(...arguments),this.onInputChange=(e=>{this.setValue(e.currentTarget.value)})}setElementValue(e){this.input.value=e}setReadOnly(e){this.input.readOnly=this.readOnly=e}setDisabled(e){this.input.disabled=this.disabled=e}render(){return r.createElement("textarea",{ref:e=>this.input=e,rows:this.ui&&this.ui.rows,maxLength:this.itemSchema.maxLength,defaultValue:this.defaultValue,onChange:this.onInputChange})}}},password:{dataTypes:["string"],widget:class extends y{constructor(){super(...arguments),this.inputType="password"}}},date:{dataTypes:["date"],widget:E},datetime:{dataTypes:["date"],widget:class extends y{constructor(){super(...arguments),this.inputType="datetime"}}},time:{dataTypes:["date"],widget:class extends y{constructor(){super(...arguments),this.inputType="time"}}},month:{dataTypes:["date"],widget:class extends y{constructor(){super(...arguments),this.inputType="month"}}},select:{dataTypes:["integer","number","string","date","boolean"],widget:k},url:{dataTypes:["string"],widget:class extends y{constructor(){super(...arguments),this.inputType="url"}}},email:{dataTypes:["string"],widget:class extends y{constructor(){super(...arguments),this.inputType="email"}}},number:{dataTypes:["integer","number"],widget:b},updown:{dataTypes:["integer","number"],widget:w},color:{},checkbox:{dataTypes:["boolean","integer","number"],widget:C},checkboxes:{},radio:{dataTypes:["integer","number","string","date","boolean"],widget:class extends g{constructor(){super(...arguments),this.inputs={}}setElementValue(e){for(let t in this.inputs){let i=this.inputs[t];i.checked=e===i.value}}setReadOnly(e){this.readOnly=e;for(let t in this.inputs)this.inputs[t].readOnly=e}setDisabled(e){this.disabled=e;for(let t in this.inputs)this.inputs[t].disabled=e}render(){let e,{defaultValue:t,list:i}=this.ui,{isRow:n,inNode:s}=this.context;!0===n&&(e=this.context.rowKey);let a=o()(this.className,"form-radio-inline");return r.createElement("span",{className:a},i.map((i,n)=>{let{value:s,title:o}=i,a=this.name;return void 0!==e&&(a+="-"+e),r.createElement("label",{key:n,className:"form-radio-inline"},r.createElement("input",{ref:e=>this.inputs[n]=e,type:"radio",name:a,value:s,defaultChecked:(this.defaultValue||t)===s}),o||s)}))}}},range:{dataTypes:["integer"],widget:class extends g{constructor(){super(...arguments),this.inputType="range"}setReadOnly(e){this.input.readOnly=this.readOnly=e}setDisabled(e){this.input.disabled=this.disabled=e}render(){let{min:e,max:t,step:i}=this.ui;return r.createElement(r.Fragment,null,r.createElement("input",{ref:e=>this.input=e,className:o()(this.className,"form-control","w-min-6c"),type:this.inputType,defaultValue:this.defaultValue,onChange:this.onInputChange,max:t,min:e,step:i}))}}},button:{dataTypes:["button","submit"],widget:S}};function V(e,t,i,s){if(void 0===e)return null;if(void 0===t)return;let o,{name:a,type:l}=t;switch(l){case"arr":let t=e.getItemSchema(a);return r.createElement(O,{parentContext:e,arrSchema:t,children:i})}let c=e.getUiItem(a);function u(e){switch(e){default:return y;case"id":return N;case"integer":return w;case"number":return b;case"string":return y;case"date":return E;case"boolean":return C;case"button":case"submit":return S}}if(void 0===c)o=u(l);else{let{widget:e}=c;switch(e){default:if(void 0!==e){o=F[e].widget}void 0===o&&(o=u(l));break;case"custom":o=c.WidgetClass;break;case"group":return r.createElement("span",null,"impletment group")}}let{isRow:h,widgets:d}=e,p=new o(e,t,s,i);if(d[a]=p,!1===h){let e=Object(n.a)(()=>p.renderContainer());return r.createElement(e,null)}return p.renderContainer()}i.d(t,"b",function(){return V}),i.d(t,"a",function(){return w})},,function(e,t,i){"use strict";i.d(t,"b",function(){return n}),i.d(t,"a",function(){return s});var r=i(2);function n(e,t,i,n,s){return r.a(this,void 0,void 0,function*(){yield e.fetch(t,i,n,s)})}class s{constructor(e,t){this.path=e||"",this.showWaiting=t}call(e,t,i){return r.a(this,void 0,void 0,function*(){let r=yield this.getHttpChannel();return yield r.callFetch(e,t,i)})}get(e,t){return r.a(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.get(this.path+e,t)})}post(e,t){return r.a(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.post(this.path+e,t)})}put(e,t){return r.a(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.put(this.path+e,t)})}delete(e,t){return r.a(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.delete(this.path+e,t)})}}},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var r=i(2),n=i(0),s=i(13);class o extends n.Component{constructor(e){super(e),this.logoutClick=(()=>{if(!1===confirm("Really want to logout?"))return;let{logout:e}=this.props;"function"===typeof e&&e(),s.c.logout()}),this.navChange=this.navChange.bind(this),this.state={hasBack:!1}}navChange(){this.setState({hasBack:s.c.level>1})}componentWillMount(){this.navChange()}componentWillUnmount(){}back(){return r.a(this,void 0,void 0,function*(){yield s.c.back()})}openWindow(){window.open(document.location.href)}render(){let e,t,i,r,o=this.state.hasBack||self!=top,{right:a,center:l,logout:c}=this.props;if(void 0!==c&&self===top&&("boolean"===typeof c&&!0===c||"function"===typeof c)){let{nick:e,name:t}=s.c.user;i=n.createElement("div",{className:"d-flex align-items-center"},n.createElement("small",{className:"text-light"},e||t),n.createElement("a",{className:"dropdown-toggle btn btn-secondary btn-sm ml-2",role:"button",onClick:this.logoutClick},n.createElement("i",{className:"fa fa-sign-out"})))}if(o)switch(this.props.back){case"none":e=void 0;break;default:case"back":e=n.createElement("nav",{onClick:this.back},n.createElement("i",{className:"fa fa-arrow-left"}));break;case"close":e=n.createElement("nav",{onClick:this.back},n.createElement("i",{className:"fa fa-close"}))}return self!=top&&(console.log(document.location.href),t=n.createElement("header",{onClick:this.openWindow})),(a||i)&&(r=n.createElement("aside",null,a," ",i)),n.createElement("header",{style:s.b},t,e,n.createElement("div",null,l),r)}}},function(e,t,i){"use strict";var r=i(2),n=i(8),s=i(0),o=i.n(s),a=i(9),l=i(6),c=i(4),u=i(18);const h=e=>o.a.createElement("div",{className:"px-3 py-2"},Object(u.a)(e));class d extends n.b{constructor(){super(...arguments),this.onSubmit=(()=>r.a(this,void 0,void 0,function*(){let e=this.vForm.getValues();if(!0===this.entity.isPaged)yield this.entity.resetPage(30,e),yield this.entity.loadPage(),this.replacePage(this.pageResult);else{let t=yield this.entity.query(e);this.replacePage(this.queryResult,t)}})),this.again=(()=>{this.vForm.reset(),this.replacePage(this.view)}),this.renderRow=((e,t)=>s.createElement(this.row,Object.assign({},e))),this.view=(()=>s.createElement(c.Page,{header:this.label},this.vForm.render("mx-3 my-2"),this.renderExtra())),this.pageResult=(()=>{let{name:e,list:t}=this.entity,i=s.createElement("button",{className:"btn btn-outline-success",onClick:this.again},s.createElement(l.b,{name:"search"})," \u518d\u67e5\u8be2");return s.createElement(c.Page,{header:this.label,right:i},s.createElement(l.e,{items:t,item:{render:this.renderRow}}))}),this.queryResult=Object(a.a)(e=>{let t=s.createElement("button",{className:"btn btn-outline-success",onClick:this.again},s.createElement(l.b,{name:"search"})," \u518d\u67e5\u8be2");return s.createElement(c.Page,{header:this.label,right:t},s.createElement("pre",null,JSON.stringify(e,void 0,"\t")))})}showEntry(e){return r.a(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e);let{row:t,queryRow:i}=this.ui;this.row=i||t||h,this.openPage(this.view)})}renderExtra(){}}class p extends n.b{constructor(){super(...arguments),this.onSearch=(e=>r.a(this,void 0,void 0,function*(){yield this.PageItems.first(e)})),this.renderRow=((e,t)=>s.createElement(this.row,Object.assign({},e))),this.clickRow=(e=>{this.callOnSelected(e)}),this.view=(()=>{let e=s.createElement(l.i,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+this.label});return s.createElement(c.Page,{header:e},s.createElement(l.e,{items:this.PageItems.items,item:{render:this.renderRow,onClick:this.clickRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))})}showEntry(e){return r.a(this,void 0,void 0,function*(){let{row:t,selectRow:i}=this.ui;this.row=i||t||h,this.PageItems=new m(this.entity),yield this.onSearch(e),this.openPage(this.view)})}callOnSelected(e){this.closePage(),this.returnCall(e)}}class m extends c.PageItems{constructor(e){super(),this.query=e}load(){return r.a(this,void 0,void 0,function*(){let e;if(yield this.query.loadSchema(),!0===this.query.isPaged)e=yield this.query.page(this.param,this.pageStart,this.pageSize);else{e=(yield this.query.query(this.param))[this.query.returns[0].name]}return e})}setPageStart(e){void 0===e&&(this.pageStart=0)}}class f extends n.a{}class v extends f{internalStart(){return r.a(this,void 0,void 0,function*(){yield this.showVPage(this.VQueryMain)})}get VQueryMain(){return this.ui&&this.ui.main||d}}class g extends f{internalStart(e){return r.a(this,void 0,void 0,function*(){yield this.showVPage(this.VQuerySelect,e)})}get VQuerySelect(){return p}}i.d(t,"a",function(){return v}),i.d(t,"b",function(){return g})},,,function(e,t,i){"use strict";i.d(t,"a",function(){return n});var r=i(0);function n(){return r.createElement("div",{style:{height:"100%"},className:"d-flex flex-fill align-items-center justify-content-center"},r.createElement("div",{className:"d-flex align-items-center justify-content-center slide text-info",style:{width:"5em",height:"2em"}},"\u52a0\u8f7d\u4e2d..."))}},function(e,t,i){"use strict";i.d(t,"a",function(){return c});var r=i(2),n=i(0),s=i(4),o=i(6),a=i(54),l=i(52);class c extends s.Controller{constructor(e,t){super(Object(s.resLang)(t&&t.res)),this.cImportUsqs={},this.cUsqCollection={},this.renderRow=((e,t)=>{let{id:i,nick:r,name:s}=e;return n.createElement(o.d,{className:"px-3 py-2",right:"id: "+i},n.createElement("div",null,r||s))}),this.onRowClick=(e=>r.a(this,void 0,void 0,function*(){s.meInFrame.unit=e.id,yield this.start()})),this.selectUnitPage=(()=>n.createElement(s.Page,{header:"\u9009\u62e9\u5c0f\u53f7",logout:!0},n.createElement(o.e,{items:this.appUnits,item:{render:this.renderRow,onClick:this.onRowClick}})));let i=e.split("/");if(2!==i.length)throw"tonvaApp name must be / separated, owner/app";this.appOwner=i[0],this.appName=i[1],this.ui=t||{usqs:{}},this.caption=this.res.caption||"Tonva"}startDebug(){return r.a(this,void 0,void 0,function*(){let e=this.appOwner+"/"+this.appName,t=new c(e,{usqs:{}});yield t.start(!0)})}loadUsqs(){return r.a(this,void 0,void 0,function*(){let e=[],t=(s.meInFrame.unit,yield Object(s.loadAppUsqs)(this.appOwner,this.appName)),{id:i,usqs:r}=t;this.id=i;let n=[];for(let s of r){let{id:e,usqOwner:t,usqName:i,url:r,urlDebug:o,ws:a,access:l,token:c}=s,u=t+"/"+i,h=this.ui&&this.ui.usqs&&this.ui.usqs[u],d=this.newCUsq(u,e,l,h||{});this.cUsqCollection[u]=d,n.push(d.loadSchema())}let o=yield Promise.all(n);for(let s of o){let t=s;void 0===t||e.push(t)}if(0!==e.length)return e})}getImportUsq(e,t){return r.a(this,void 0,void 0,function*(){let i=e+"/"+t,r=this.cImportUsqs[i];if(void 0!==r)return r;let n=this.ui&&this.ui.usqs&&this.ui.usqs[i];this.cImportUsqs[i]=r=this.newCUsq(i,-1,void 0,n||{});let s=yield r.loadSchema();if(void 0===s)return r;console.error(s)})}newCUsq(e,t,i,r){let n=new(this.ui.CUsq||a.a)(this,e,this.id,t,i,r);return Object.setPrototypeOf(n.x,this.x),n}get cUsqArr(){let e=[];for(let t in this.cUsqCollection)e.push(this.cUsqCollection[t]);return e}getCUsq(e){return this.cUsqCollection[e]}get VAppMain(){return this.ui&&this.ui.main||u}beforeStart(){const e=Object.create(null,{beforeStart:{get:()=>super.beforeStart}});return r.a(this,void 0,void 0,function*(){if(!1===(yield e.beforeStart.call(this)))return!1;try{let e=document.location.hash;e.startsWith("#tvdebug")?this.isProduction=!1:this.isProduction=e.startsWith("#tv");let{unit:i}=s.meInFrame;if(!1===this.isProduction&&(void 0===i||i<=0)){let e=yield Object(s.loadAppUsqs)(this.appOwner,this.appName),{id:t}=e;switch(this.id=t,yield this.loadAppUnits(),this.appUnits.length){case 0:return this.showUnsupport(),!1;case 1:if(void 0===(i=this.appUnits[0].id)||i<0)return this.showUnsupport(),!1;s.meInFrame.unit=i;break;default:return s.nav.push(n.createElement(this.selectUnitPage,null)),!1}}let r=yield this.loadUsqs();return void 0===r||(this.openPage(n.createElement(s.Page,{header:"ERROR"},n.createElement("div",{className:"m-3"},n.createElement("div",null,"Load Usqs \u53d1\u751f\u9519\u8bef\uff1a"),r.map((e,t)=>n.createElement("div",{key:t},e))))),!1)}catch(t){return s.nav.push(n.createElement(s.Page,{header:"App start error!"},n.createElement("pre",null,"string"===typeof t?t:t.message))),!1}})}internalStart(e){return r.a(this,void 0,void 0,function*(){!0!==e&&this.clearPrevPages(),yield this.showMainPage()})}load(){return r.a(this,void 0,void 0,function*(){yield this.beforeStart()})}render(){return this.renderView(this.VAppMain)}clearPrevPages(){s.nav.clear()}showUnsupport(){this.clearPrevPages(),this.openPage(n.createElement(s.Page,{header:"APP\u65e0\u6cd5\u8fd0\u884c",logout:!0},n.createElement("div",{className:"m-3 text-danger container"},n.createElement("div",{className:"form-group row"},n.createElement("div",{className:"col-2"},n.createElement(o.b,{name:"exclamation-triangle"})),n.createElement("div",{className:"col"},"\u7528\u6237\u4e0d\u652f\u6301APP")),n.createElement("div",{className:"form-group row"},n.createElement("div",{className:"col-2"},"\u7528\u6237: "),n.createElement("div",{className:"col"},`${s.nav.user.name}`)),n.createElement("div",{className:"form-group row"},n.createElement("div",{className:"col-2"},"App:"),n.createElement("div",{className:"col"},`${this.appOwner}/${this.appName}`)))))}showMainPage(){return r.a(this,void 0,void 0,function*(){let e=document.location.hash.split("-");if(e.length>2){let t=e[2];if("sheet"===t||"sheet_debug"===t){let t=Number(e[3]),i=Number(e[4]),r=Number(e[5]),n=this.getCUsqFromId(t);return void 0===n?void alert("unknown usqId: "+t):(this.clearPrevPages(),void(yield n.navSheet(i,r)))}}this.showVPage(this.VAppMain)})}getCUsqFromId(e){for(let t in this.cUsqCollection){let i=this.cUsqCollection[t];if(i.id===e)return i}}loadAppUnits(){return r.a(this,void 0,void 0,function*(){let e=yield l.a.userAppUnits(this.id);this.appUnits=e,1===e.length&&(s.meInFrame.unit=e[0].id)})}}class u extends s.VPage{constructor(){super(...arguments),this.appContent=(()=>{let e,{cUsqArr:t}=this.controller;return e=0===t.length?n.createElement("div",{className:"text-danger"},n.createElement(o.b,{name:""})," \u6b64APP\u6ca1\u6709\u7ed1\u5b9a\u4efb\u4f55\u7684USQ"):t.map((e,t)=>n.createElement("div",{key:t},e.render())),n.createElement(n.Fragment,null,e)})}showEntry(e){return r.a(this,void 0,void 0,function*(){this.openPage(this.appPage)})}render(e){return this.appContent()}appPage(){let{caption:e}=this.controller;return n.createElement(s.Page,{header:e,logout:()=>{s.meInFrame.unit=void 0}},this.appContent())}}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var r=i(0),n=i.n(r),s=i(6);function o(e,t){return n.a.createElement(s.b,{className:e,name:t,fixWidth:!0})}const a={tuid:o("text-info","list-alt"),action:o("text-info","hand-o-right"),map:o("text-muted","list-ul"),book:o("text-muted","book"),query:o("text-warning","search"),history:o("text-info","hand-o-right"),pending:o("text-info","forward"),sheet:o("text-primary","wpforms")}},function(e,t,i){"use strict";i.d(t,"a",function(){return n});var r=i(4);class n extends r.Controller{constructor(e,t){super(t),this.cUsq=e}}},function(e,t,i){"use strict";i.d(t,"a",function(){return s});var r=i(2),n=i(4);const s=new class extends n.CenterApi{userAppUnits(e){return r.a(this,void 0,void 0,function*(){return yield this.get("tie/user-app-units",{app:e})})}}("tv/",void 0)},function(e,t,i){"use strict";var r=i(2),n=i(7),s=i(4),o=i(8),a=i(0),l=i.n(a),c=i(9),u=i(140),h=i(6);class d extends o.b{constructor(){super(...arguments),this.newClick=(()=>this.event("new")),this.schemaClick=(()=>this.event("schema")),this.archivesClick=(()=>this.event("archives")),this.sheetStateClick=(e=>this.event("state",e)),this.renderState=((e,t)=>{let{state:i,count:r}=e;if(0===r)return null;let n=a.createElement(u.a,{className:"ml-5 align-self-end",color:"success"},r);return a.createElement(h.d,{className:"px-3 py-2",left:this.controller.getStateLabel(i),right:n})}),this.view=Object(c.a)(()=>{let e,t=this.controller.statesCount.filter(e=>e.count),i=a.createElement("button",{className:"btn btn-outline-primary",onClick:this.archivesClick},"\u5df2\u5f52\u6863");return!0===this.isDev&&(e=a.createElement("button",{className:"btn btn-primary mr-2",color:"primary",onClick:this.schemaClick},"\u6a21\u677f")),a.createElement(s.Page,{header:this.label},a.createElement(h.d,{className:"mx-3 my-2",right:i},a.createElement("button",{className:"btn btn-primary mr-2",color:"primary",onClick:this.newClick},"\u65b0\u5efa"),e),a.createElement(h.e,{className:"my-2",header:a.createElement(h.g,{className:"mx-3 my-1"},"\u5f85\u5904\u7406",this.label),none:"[ \u65e0 ]",items:t,item:{render:this.renderState,onClick:this.sheetStateClick}}))})}showEntry(){return r.a(this,void 0,void 0,function*(){this.openPage(this.view)})}}class p extends o.b{constructor(){super(...arguments),this.onSubmit=(()=>r.a(this,void 0,void 0,function*(){let e=this.vForm.getValues(),t=this.vForm.values;yield this.controller.onSave(e,t)})),this.view=(()=>a.createElement(s.Page,{header:this.label},this.vForm.render()))}showEntry(e){return r.a(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e),this.openPage(this.view)})}}var m=i(34);const f={width:"8rem"};class v extends o.b{constructor(){super(...arguments),this.flowRow=((e,t)=>{let i,{date:r,user:n,preState:s,state:o,action:l}=e;switch(void 0===l&&(l=a.createElement(a.Fragment,null,a.createElement(h.b,{className:"text-primary",name:"pencil-square-o"})," \u5236\u5355")),o){case"$":break;case"#":i=a.createElement(a.Fragment,null,a.createElement(h.b,{className:"text-success",name:"file-archive-o"}));break;default:i=a.createElement(a.Fragment,null,a.createElement(h.b,{className:"text-muted",name:"arrow-right"})," \xa0 ",o)}return a.createElement(h.d,{left:a.createElement("div",{className:"pl-3 py-2",style:f},l),right:a.createElement("div",{className:"p-2"},a.createElement(h.g,null,a.createElement(h.a,{date:r})))},a.createElement("div",{className:"p-2"},i))}),this.sheetView=(()=>{let e,{brief:t,flows:i}=this.sheetData;return"-"===t.state&&(e=a.createElement("div",{className:"mx-3 my-2",style:{color:"red"}},"\u672c\u5355\u636e\u4f5c\u5e9f")),a.createElement("div",null,e,this.vForm.render(),a.createElement(h.e,{header:a.createElement(h.g,{className:"mx-3 my-1"},"\u6d41\u7a0b"),items:i,item:{render:this.flowRow}}))})}}class g extends v{constructor(){super(...arguments),this.onSubmit=(()=>r.a(this,void 0,void 0,function*(){let e=this.vForm.getValues();yield this.controller.saveSheet(e,this.vForm.values),this.closePage(),this.returnCall(this.vForm.values)})),this.view=(()=>a.createElement(s.Page,{header:this.label},this.vForm.render()))}showEntry(e){return r.a(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(this.onSubmit,e.data,m.a.edit),this.openPage(this.view)})}}var y=i(10),b=i.n(y),w=i(142);class E extends v{constructor(){super(...arguments),this.actionClick=(e=>r.a(this,void 0,void 0,function*(){let{id:t,flow:i,state:r}=this.sheetData.brief;yield this.controller.action(t,i,r,e.name);this.ceasePage(),this.openPage(this.acted)})),this.deleteClick=(()=>r.a(this,void 0,void 0,function*(){alert("\u5355\u636e\u4f5c\u5e9f\uff1a\u7a0b\u5e8f\u6b63\u5728\u8bbe\u8ba1\u4e2d")})),this.editClick=(()=>r.a(this,void 0,void 0,function*(){let e=yield this.controller.editSheet(this.sheetData);this.vForm.setValues(e)})),this.page=(()=>{let e,t,{brief:i}=this.sheetData,{state:r,no:n}=i,o=this.controller.getStateLabel(r),{states:a}=this.entity,c=a.find(e=>e.name===r);if(void 0===c){let t,i;switch(r){default:t="\u4e0d\u8ba4\u8bc6\u7684\u5355\u636e\u72b6\u6001'"+r+"'",i="text-info";break;case"-":t="\u5df2\u4f5c\u5e9f",i="text-danger";break;case"#":t="\u5df2\u5f52\u6863",i="text-success"}e=l.a.createElement("div",{className:b()(i)},"[",t,"]")}else e=l.a.createElement("div",{className:"flex-grow-1"},c.actions.map((e,t)=>l.a.createElement(w.a,{key:t,className:"mr-2",color:"primary",onClick:()=>this.actionClick(e)},this.controller.getActionLabel(r,e.name)))),"$"===r&&(t=l.a.createElement("div",null,l.a.createElement(w.a,{outline:!0,className:"ml-2",color:"info",onClick:this.editClick},"\u4fee\u6539"),l.a.createElement(w.a,{outline:!0,className:"ml-2",color:"danger",onClick:this.deleteClick},"\u4f5c\u5e9f")));return l.a.createElement(s.Page,{header:this.label+":"+o+"-"+n},l.a.createElement("div",{className:"mb-2"},l.a.createElement("div",{className:"d-flex px-3 py-2 border-bottom bg-light"},e,t),l.a.createElement(this.sheetView,null)))}),this.acted=(()=>{let{discription:e}=this.sheetData.brief;return l.a.createElement(s.Page,{header:"\u5df2\u5904\u7406",back:"close"},l.a.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},l.a.createElement("div",{className:"p-3"},e),l.a.createElement("div",{className:"text-success"},l.a.createElement(h.b,{name:"check-circle-o"})," \u5355\u636e\u5df2\u5904\u7406\uff01"),l.a.createElement("div",{className:"p-3"},l.a.createElement("button",{className:"btn btn-outline-info",onClick:()=>this.backPage()},"\u8fd4\u56de"))))})}showEntry(e){return r.a(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(void 0,e.data),this.openPage(this.page)})}}class C extends o.b{constructor(){super(...arguments),this.view=(()=>a.createElement(s.Page,{header:this.label+"\u6a21\u677f"},a.createElement("pre",{className:"mx-3 my-2"},this.entity.schemaStringify())))}showEntry(e){return r.a(this,void 0,void 0,function*(){this.openPage(this.view)})}}class k extends o.b{constructor(){super(...arguments),this.archiveClick=(e=>r.a(this,void 0,void 0,function*(){1!==e.processing&&this.event("archived",e)})),this.archiveRow=((e,t)=>{let{id:i,no:r,discription:n,date:s}=e,o=a.createElement(a.Fragment,null,1===e.processing?"... ":"",e.no," \xa0 ",e.discription),l=a.createElement(h.g,null,a.createElement(h.a,{date:s}));return a.createElement(h.d,{className:"px-3 py-2",left:o,right:l})}),this.view=(()=>a.createElement(s.Page,{header:"\u5df2\u5f52\u6863"+this.label},a.createElement(h.e,{items:this.list,item:{render:this.archiveRow,onClick:this.archiveClick}})))}showEntry(){return r.a(this,void 0,void 0,function*(){this.list=yield this.entity.getArchives(void 0,10),this.openPage(this.view)})}}class N extends o.b{constructor(){super(...arguments),this.rowClick=(e=>r.a(this,void 0,void 0,function*(){1!==e.processing?this.event("action",e.id):this.event("processing",e.id)})),this.onScrollBottom=(()=>{console.log("onScrollBottom"),this.controller.pageStateItems.more()}),this.rowContent=(e=>{let{id:t,no:i,discription:r,date:n,processing:s}=e,o=a.createElement(a.Fragment,null,i," \xa0 ",a.createElement(h.g,null,r)," ",1===s?"...":""),l=a.createElement(h.g,null,a.createElement(h.a,{date:n}));return a.createElement(h.d,{className:"px-3 py-2",left:o,right:l})}),this.renderRow=((e,t)=>a.createElement(this.row,Object.assign({},e))),this.view=(()=>{let{pageStateItems:e}=this.controller;return a.createElement(s.Page,{header:this.label+" - "+this.stateLabel,onScrollBottom:this.onScrollBottom},a.createElement(h.e,{items:e,item:{render:this.renderRow,onClick:this.rowClick}}))})}showEntry(e){return r.a(this,void 0,void 0,function*(){this.row=this.ui.listRow||this.rowContent,this.stateName=e.state,this.stateLabel=this.controller.getStateLabel(this.stateName),yield this.controller.pageStateItems.first(this.stateName),this.openPage(this.view)})}}class x extends v{constructor(){super(...arguments),this.view=(()=>{let{brief:e}=this.sheetData;return a.createElement(s.Page,{header:this.label+":-"+e.no},a.createElement(this.sheetView,null))})}showEntry(e){return r.a(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(void 0,this.sheetData.data),this.openPage(this.view)})}}class S extends o.b{}class P extends S{constructor(){super(...arguments),this.restart=(()=>r.a(this,void 0,void 0,function*(){this.ceasePage(),yield this.event("new")})),this.actionClick=(e=>r.a(this,void 0,void 0,function*(){this.ceasePage();let{id:t,flow:i,state:r}=this.brief;yield this.controller.action(t,i,r,e.name);this.openPage(this.acted)})),this.buttons=a.createElement(a.Fragment,null,a.createElement("button",{className:"btn btn-outline-primary mr-3",onClick:this.restart},"\u7ee7\u7eed\u5f00\u5355"),a.createElement("button",{className:"btn btn-outline-info",onClick:()=>this.backPage()},"\u8fd4\u56de")),this.view=(()=>{let{states:e}=this.entity;let t=e.find(e=>"$"===e.name),i=a.createElement(a.Fragment,null,t.actions.map((e,t)=>a.createElement("button",{key:t,className:"btn btn-primary mr-3",onClick:()=>this.actionClick(e)},this.controller.getActionLabel("$",e.name))));return a.createElement(s.Page,{header:"\u5df2\u4fdd\u5b58",back:"close"},a.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},a.createElement("div",{className:"text-success"},a.createElement(h.b,{name:"check-circle-o"})," \u5355\u636e\u5df2\u4fdd\u5b58\uff01\u7cfb\u7edf\u5c1a\u672a\u5904\u7406"),a.createElement("div",{className:"p-3"},i,this.buttons)))}),this.acted=(()=>a.createElement(s.Page,null,a.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},a.createElement("div",{className:"text-success"},a.createElement(h.b,{name:"check-circle-o"})," \u5355\u636e\u5df2\u5904\u7406\uff01"),a.createElement("div",{className:"p-3"},this.buttons))))}showEntry(e){return r.a(this,void 0,void 0,function*(){this.brief=e,this.openPage(this.view)})}}class O extends v{constructor(){super(...arguments),this.page=(()=>{let{brief:e}=this.sheetData,{state:t,no:i}=e,r=this.controller.getStateLabel(t);return l.a.createElement(s.Page,{header:this.label+":"+r+"-"+i},l.a.createElement("div",{className:"mb-2"},l.a.createElement("div",{className:"d-flex px-3 py-2 border-bottom bg-light"},"\u6b63\u5728\u5904\u7406\u4e2d..."),l.a.createElement(this.sheetView,null)))})}showEntry(e){return r.a(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(void 0,e.data),this.openPage(this.page)})}}class F extends o.a{constructor(){super(...arguments),this.statesCount=n.l.array([],{deep:!0}),this.onSave=((e,t)=>r.a(this,void 0,void 0,function*(){let i=yield this.saveSheet(e,t);this.ceasePage(),yield this.showSaved(i)}))}internalStart(){return r.a(this,void 0,void 0,function*(){yield this.loadStateSheetCount(),this.pageStateItems=this.entity.createPageStateItems(),yield this.showVPage(this.VSheetMain)})}onMessage(e){return r.a(this,void 0,void 0,function*(){let{type:t,body:i,from:r,to:n,push:s}=e;"sheet"===t&&this.onSheet(r,n,i)})}onSheet(e,t,i){let r=this.user.id,{id:n,preState:s,state:o}=i;console.log({$:"onMessage sheet",from:e,to:t.join(","),id:n,preState:s,state:o,me:r,sheetData:i}),e===r&&this.sheetActPreState(n,s),void 0!==t.find(e=>e===r)&&this.sheetActState(n,o,i)}sheetActPreState(e,t){if(this.changeStateCount(t,-1),void 0===this.curState||this.curState!==t)return;let i=this.pageStateItems.items.findIndex(t=>t.id===e);i>=0&&this.pageStateItems.items.splice(i,1)}sheetActState(e,t,i){this.changeStateCount(t,1),void 0!==this.curState&&this.curState===t&&this.pageStateItems.items.findIndex(t=>t.id===e)<0&&this.pageStateItems.items.push(i)}changeStateCount(e,t){if(void 0===e)return;let i=this.statesCount.findIndex(t=>t.state===e);if(console.log({$:"changeState",state:e,delta:t,index:i}),i<0)return;let r=this.statesCount[i];r.count+=t,r.count<0&&(r.count=0)}get VSheetMain(){return this.ui&&this.ui.main||d}get VSheetNew(){return this.ui.sheetNew||p}get VSheetSaved(){return this.ui.sheetSaved||P}get VSheetEdit(){return this.ui.sheetEdit||g}get VSheetSchema(){return C}get VArchives(){return k}get VArchived(){return x}get VSheetList(){return N}get VSheetAction(){return this.ui.sheetAction||E}get VSheetProcessing(){return O}onEvent(e,t){return r.a(this,void 0,void 0,function*(){let i;switch(e){default:return;case"new":i=this.VSheetNew;break;case"schema":i=this.VSheetSchema;break;case"archives":i=this.VArchives;break;case"state":this.curState=t.state,i=this.VSheetList;break;case"archived":return void(yield this.showArchived(t));case"action":return void(yield this.showAction(t));case"processing":return void(yield this.showProcessing(t))}yield this.showVPage(i,t)})}startSheet(e){return r.a(this,void 0,void 0,function*(){!1!==(yield this.beforeStart())&&(yield this.onEvent("action",e))})}showAction(e){return r.a(this,void 0,void 0,function*(){let t=yield this.getSheetData(e);Object(s.postWsToTop)({body:{$type:"msg",action:"$sheet",msg:{id:e,usq:this.cUsq.id,state:t.brief.state}}}),yield this.showVPage(this.VSheetAction,t)})}showProcessing(e){return r.a(this,void 0,void 0,function*(){let t=yield this.getSheetData(e);yield this.showVPage(this.VSheetProcessing,t)})}editSheet(e){return r.a(this,void 0,void 0,function*(){return yield this.vCall(this.VSheetEdit,e)})}showArchived(e){return r.a(this,void 0,void 0,function*(){let t=yield this.getArchived(e.id);yield this.showVPage(this.VArchived,t)})}showSaved(e){return r.a(this,void 0,void 0,function*(){yield this.showVPage(this.VSheetSaved,e)})}getStateUI(e){let{states:t}=this.res;if(void 0!==t)return t[e]}getStateLabel(e){let t=this.getStateUI(e),i=t&&t.label||e;switch(i){default:return i;case"$":return"\u65b0\u5355"}}getActionLabel(e,t){let i=this.getStateUI(e);if(void 0===i)return t;let r=i.actions;if(void 0===r)return t;let n=r[t];return n&&n.label||t}loadStateSheetCount(){return r.a(this,void 0,void 0,function*(){this.statesCount.clear();let e=yield this.entity.stateSheetCount();this.statesCount.splice(0,0,...e)})}getSheetData(e){return r.a(this,void 0,void 0,function*(){return yield this.entity.getSheet(e)})}getArchived(e){return r.a(this,void 0,void 0,function*(){return yield this.entity.getArchive(e)})}saveSheet(e,t){return r.a(this,void 0,void 0,function*(){let{sheetTitle:i}=this.ui,r=void 0===i?this.label:i(t,this.x);return yield this.entity.save(r,e)})}action(e,t,i,n){return r.a(this,void 0,void 0,function*(){return yield this.entity.action(e,t,i,n)})}}i.d(t,"a",function(){return F})},function(e,t,i){"use strict";var r=i(2),n=i(4),s=i(40),o=i(24),a=i(8),l=i(0),c=i.n(l);class u extends a.b{constructor(){super(...arguments),this.view=(()=>l.createElement(n.Page,{header:this.label},"Book"))}showEntry(e){return r.a(this,void 0,void 0,function*(){this.openPage(this.view)})}}class h extends a.a{internalStart(){return r.a(this,void 0,void 0,function*(){yield this.showVPage(this.VBookMain)})}get VBookMain(){return u}}var d=i(53),p=i(56),m=i(45),f=i(32),v=i(55),g=i(17),y=i(6);class b extends n.View{constructor(e){super(e),this.isSysVisible=!1,this.view=(()=>{let e,{res:t,usq:i,error:r}=this.controller,n={render:(e,t)=>e.render(),onClick:void 0},s=[{header:t.tuid||"TUID",items:this.tuidLinks},{cn:"my-2",header:t.map||"MAP",items:this.mapLinks},{cn:"my-2",header:t.sheet||"SHEET",items:this.sheetLinks},{cn:"my-2",header:t.action||"ACTION",items:this.actionLinks},{cn:"my-2",header:t.query||"QUERY",items:this.queryLinks},{cn:"mt-2 mb-4",header:t.book||"BOOK",items:this.bookLinks},{cn:"mt-2 mb-4",header:t.history||"HISTORY",items:this.historyLinks},{cn:"mt-2 mb-4",header:t.pending||"PENDING",items:this.pendingLinks}];return e=void 0!==r?c.a.createElement("div",{className:"p-3 text-danger"},"\u8fde\u63a5\u9519\u8bef: ",r):s.map(({cn:e,header:t,items:i},r)=>i.length>0&&c.a.createElement(y.e,{key:r,className:e,header:c.a.createElement("div",{className:"px-3 py-1 bg-light"},c.a.createElement(y.g,null,t)),items:i,item:n})),c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"px-3 py-1 small"},t.usq||i),e)});let{tuidArr:t,mapArr:i,sheetArr:r,actionArr:n,queryArr:s,bookArr:a,historyArr:l,pendingArr:u}=e.entities;this.tuidLinks=t.filter(e=>this.isVisible(e)).map(e=>new o.a(this.controller.cTuidMain(e))),this.mapLinks=i.filter(e=>this.isVisible(e)).map(e=>new o.a(this.controller.cMap(e))),this.sheetLinks=r.filter(e=>this.isVisible(e)).map(e=>new o.a(this.controller.cSheet(e))),this.actionLinks=n.filter(e=>this.isVisible(e)).map(e=>new o.a(this.controller.cAction(e))),this.queryLinks=s.filter(e=>this.isVisible(e)).map(e=>new o.a(this.controller.cQuery(e))),this.bookLinks=a.filter(e=>this.isVisible(e)).map(e=>new o.a(this.controller.cBook(e))),this.historyLinks=l.filter(e=>this.isVisible(e)).map(e=>new o.a(this.controller.cHistory(e))),this.pendingLinks=u.filter(e=>this.isVisible(e)).map(e=>new o.a(this.controller.cPending(e)))}isVisible(e){return!0!==e.sys||this.isSysVisible}render(e){return void 0===this.view?c.a.createElement("div",null,"??? viewModel \u5fc5\u987b\u5b9a\u4e49 view ???"):c.a.createElement(this.view)}}var w=i(58),E=i(57);function C(e){if(void 0!==e)for(let t in e)e[t.toLowerCase()]=e[t]}class k extends n.Controller{constructor(e,t,i,r,o,a){super(Object(n.resLang)(a.res)),this.schemaLoaded=!1,this.isSysVisible=!1,this.cApp=e,this.usq=t,this.id=r,C(a.tuid),C(a.sheet),C(a.map),C(a.query),C(a.action),C(a.book),C(a.history),C(a.pending),this.ui=a,this.CTuidMain=a.CTuidMain||f.d,this.CTuidEdit=a.CTuidEdit||f.a,this.CTuidList=a.CTuidList||f.c,this.CTuidSelect=a.CTuidSelect||f.e,this.CTuidInfo=a.CTuidInfo||f.b,this.CQuery=a.CQuery||m.a,this.CQuerySelect=a.CQuerySelect||m.b,this.CMap=a.CMap||v.a,this.CAction=a.CAction||p.a,this.CSheet=a.CSheet||d.a,this.CBook=a.CBook||h,this.CHistory=a.CHistory||w.a,this.CPending=a.CPending||E.a;let l,c,u=t.split("/");switch(u.length){case 1:l="$$$",c=u[0];break;case 2:l=u[0],c=u[1];break;default:return void console.log("usq must be usqOwner/usqName format")}let g,y,b=document.location.hash,k=void 0===b||""===b?"debug/":"tv/";g=null===o||void 0===o||"*"===o?[]:o.split(";").map(e=>e.trim()).filter(e=>e.length>0),y="$$$/$unitx"===t?new n.UnitxApi(n.meInFrame.unit):new n.UsqApi(k,l,c,g,!0),this.entities=new s.a(this,y,i)}internalStart(){return r.a(this,void 0,void 0,function*(){})}loadEntites(){return r.a(this,void 0,void 0,function*(){yield this.entities.loadAccess()})}loadSchema(){return r.a(this,void 0,void 0,function*(){try{if(!0===this.schemaLoaded)return;yield this.loadEntites(),void 0===this.id&&(this.id=this.entities.usqId);for(let e in this.ui){let t=this.ui[e];if(void 0===t)continue;let{caption:i,collection:r}=t;if(void 0!==r)for(let n in r)void 0===this.entities[e](n)&&console.warn(e+":'"+n+"' is not usql entity")}return void(this.schemaLoaded=!0)}catch(e){return console.error(e),this.error=e}})}getQuerySearch(e){return r.a(this,void 0,void 0,function*(){let t=this.entities.query(e);if(void 0===t)alert(`QUERY ${e} \u6ca1\u6709\u5b9a\u4e49!`);else{yield t.loadSchema();let{returns:i}=t;i.length>1&&alert(`QUERY ${e} \u8fd4\u56de\u591a\u5f20\u8868, \u65e0\u6cd5\u505aQuerySearch`)}return t})}getTuidPlaceHolder(e){let t,{tuidPlaceHolder:i,entity:r}=this.res,{name:n}=e;if(void 0!==r){let e=r[n];void 0!==e&&(t=e.label)}return i||"Select"}getNone(){let{none:e}=this.res;return e||"none"}isVisible(e){return!0!==e.sys||this.isSysVisible}navSheet(e,t){return r.a(this,void 0,void 0,function*(){let i=this.entities.sheetFromTypeId(e);if(void 0===i)return void alert("sheetTypeId "+e+" is not exists!");let r=this.cSheet(i);yield r.startSheet(t)})}sheet(e){return this.entities.sheet(e)}action(e){return this.entities.action(e)}query(e){return this.entities.query(e)}book(e){return this.entities.book(e)}map(e){return this.entities.map(e)}history(e){return this.entities.history(e)}pending(e){return this.entities.pending(e)}tuid(e){return this.entities.tuid(e)}tuidDiv(e,t){let i=this.entities.tuid(e);if(void 0===i)return;let{divs:r}=i;return void 0!==r?r[t]:void 0}cSheetFromName(e){let t=this.entities.sheet(e);if(void 0!==t)return this.cSheet(t)}cActionFromName(e){let t=this.entities.action(e);if(void 0!==t)return this.cAction(t)}cQueryFromName(e){let t=this.entities.query(e);if(void 0!==t)return this.cQuery(t)}cBookFromName(e){let t=this.entities.book(e);if(void 0!==t)return this.cBook(t)}cMapFromName(e){let t=this.entities.map(e);if(void 0!==t)return this.cMap(t)}cHistoryFromName(e){let t=this.entities.history(e);if(void 0!==t)return this.cHistory(t)}cPendingFromName(e){let t=this.entities.pending(e);if(void 0!==t)return this.cPending(t)}cTuidMainFromName(e){let t=this.entities.tuid(e);if(void 0!==t)return this.cTuidMain(t)}cTuidEditFromName(e){let t=this.entities.tuid(e);if(void 0!==t)return this.cTuidEdit(t)}cTuidInfoFromName(e){let t=this.entities.tuid(e);if(void 0!==t)return this.cTuidInfo(t)}cTuidSelectFromName(e){let t=this.entities.tuid(e);if(void 0!==t)return this.cTuidSelect(t)}cFromName(e,t){switch(e){case"sheet":let i=this.entities.sheet(t);if(void 0===i)return;return this.cSheet(i);case"action":let r=this.entities.action(t);if(void 0===r)return;return this.cAction(r);case"tuid":let n=this.entities.tuid(t);if(void 0===n)return;return this.cTuidMain(n);case"query":let s=this.entities.query(t);if(void 0===s)return;return this.cQuery(s);case"book":let o=this.entities.book(t);if(void 0===o)return;return this.cBook(o);case"map":let a=this.entities.map(t);if(void 0===a)return;return this.cMap(a);case"history":let l=this.entities.history(t);if(void 0===l)return;return this.cHistory(l);case"pending":let c=this.entities.pending(t);if(void 0===c)return;return this.cPending(c)}}linkFromName(e,t){return this.link(this.cFromName(e,t))}getUI(e){let t,i,{name:r,typeName:n}=e;if(void 0!==this.ui){let e=this.ui[n];void 0!==e&&(t=e[r])}let{entity:s}=this.res;return void 0!==s&&(i=s[r]),{ui:t||{},res:i||{}}}link(e){return new o.a(e)}get tuidLinks(){return this.entities.tuidArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cTuidMain(e)))}cTuidMain(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidMain||this.CTuidMain)(this,e,t,i)}cTuidEdit(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidEdit||this.CTuidEdit)(this,e,t,i)}cTuidList(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidList||this.CTuidList)(this,e,t,i)}cTuidSelect(e){let{ui:t,res:i}=this.getUI(e.owner||e);return new(t&&t.CTuidSelect||this.CTuidSelect)(this,e,t,i)}cTuidInfo(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidInfo||this.CTuidInfo)(this,e,t,i)}cSheet(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CSheet||this.CSheet)(this,e,t,i)}get sheetLinks(){return this.entities.sheetArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cSheet(e)))}cAction(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CAction||this.CAction)(this,e,t,i)}get actionLinks(){return this.entities.actionArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cAction(e)))}cQuery(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CQuery||this.CQuery)(this,e,t,i)}cQuerySelect(e){let t=this.entities.query(e);if(void 0===t)return;let{ui:i,res:r}=this.getUI(t);return new(i&&i.CQuerySelect||this.CQuerySelect)(this,t,i,r)}get queryLinks(){return this.entities.queryArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cQuery(e)))}cBook(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CBook||this.CBook)(this,e,t,i)}get bookLinks(){return this.entities.bookArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cBook(e)))}cHistory(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CHistory||this.CHistory)(this,e,t,i)}get historyLinks(){return this.entities.historyArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cHistory(e)))}cPending(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CPending||this.CPending)(this,e,t,i)}get pendingLinks(){return this.entities.pendingArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cPending(e)))}cMap(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CMap||this.CMap)(this,e,t,i)}get mapLinks(){return this.entities.mapArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cMap(e)))}getTuidContent(e){let{owner:t}=e;if(void 0===t){let{ui:t}=this.getUI(e);return t&&t.content||g.b}{let{ui:i}=this.getUI(t);return i&&i.divs&&i.divs[e.name].content||g.b}}showTuid(e,t){return r.a(this,void 0,void 0,function*(){let{owner:i}=e,r=this.cTuidInfo(i||e);yield r.start(t)})}get VUsq(){return b}render(){return new this.VUsq(this).render()}}i.d(t,"a",function(){return k})},function(e,t,i){"use strict";var r=i(2),n=i(14),s=i.n(n),o=i(8),a=i(40),l=i(0),c=i(9),u=i(10),h=i.n(u),d=i(6),p=i(4),m=i(18),f=i(17);class v extends o.b{constructor(){super(...arguments),this.itemRender=((e,t)=>l.createElement(this.ItemRow,{item:e})),this.ItemRow=Object(c.a)(({item:e})=>{let t,i,r,n,s,o,{tuid:a,box:c,children:u,isLeaf:p,keyIndex:v,values:g}=e,y=this.controller.keyUIs[v],{content:b,valuesContent:w,none:E}=y;if(!1===this.isFrom&&(t=l.createElement("button",{className:"btn btn-link btn-sm",onClick:()=>this.controller.addClick(e)},l.createElement(d.b,{name:"plus"})),i=l.createElement("button",{className:"btn btn-link btn-sm",onClick:()=>this.controller.removeClick(e)},l.createElement(d.b,{className:"text-info",name:"trash"}))),!1===p?r=0===v?t:l.createElement(l.Fragment,null,i," \xa0 ",t):v>0&&(r=i),!0===p)n=void 0,g&&(o=(w||f.b)(g,this.x));else{s="border-bottom";let e=E&&E(this.x);n=l.createElement(d.e,{className:"ml-4",items:u,item:{onClick:void 0,render:this.itemRender},none:e})}return l.createElement("div",{className:"d-flex flex-column"},l.createElement(d.d,{className:h()("px-3","py-2",s),right:r},l.createElement("div",{className:"py-1"},Object(m.b)(c,b,this.x)),l.createElement("div",{className:"py-1 font-weight-bold"},o)),n)})}showEntry(e){return r.a(this,void 0,void 0,function*(){this.isFrom=this.controller.isFrom,this.openPage(this.view)})}get view(){return()=>l.createElement(p.Page,{header:this.label},l.createElement(d.e,{items:this.controller.items,item:{className:"my-2",onClick:void 0,render:this.itemRender}}))}}var g=i(7);class y extends o.b{constructor(){super(...arguments),this.onValuesSubmit=(()=>r.a(this,void 0,void 0,function*(){this.ceasePage();let e=this.vForm.getValues();this.returnCall(e)})),this.view=(()=>l.createElement(p.Page,null,this.vForm.render()))}showEntry(e){return r.a(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onValuesSubmit),this.openPageElement(l.createElement(this.view,null))})}}class b{constructor(e,t,i,r){this.children=g.l.array([],{deep:!0}),this.parent=e,this.tuid=t,this.box=i,this.keyIndex=r,this.isLeaf=!1}}class w extends o.a{constructor(){super(...arguments),this.addClick=(e=>r.a(this,void 0,void 0,function*(){let{keyIndex:t,children:i}=e,r=this.keyFields.length,n=r-1,s=t+1;if(s>=r)return;let o=this.keyFields[s],l=o.name,c=o._tuid,u={},h={};for(let a=e;void 0!==a;a=a.parent){let{keyIndex:e,box:t}=a,i=this.keyFields[e].name;u[i]=h[i]=t.id}let d=yield this.searchOnKey(o,u);if(void 0===d||d<=0)return;c.useId(d);let p=c.boxId(d),m={},f={};if(t+1===n){if(c.useId(d),f[l]=m[l]=p,this.entity.fields.length>0){let e=yield this.vCall(y,h);for(let t in e)f[t]=m[t]=e[t]}}else{f[l]=h[l]=p;for(let t=s+1;t<n;t++)h[this.keyFields[t].name]=0;m[this.keyFields[n].name]=0;let{fields:e}=this.entity;for(let t of e){let{name:e,type:i,null:r}=t;!0!==r&&(m[t.name]=Object(a.b)(i))}}h.arr1=[m],yield this.entity.actions.add.submit(h);let v=i.findIndex(e=>e.box.id===d);if(v<0)i.push(this.createItem(e,c,p,s,f));else{let{fields:e}=this.entity;if(void 0!==e&&e.length>0){let e=i[v];i.splice(v,1),e.values=f,i.splice(v,0,e)}}this.removeCeased()})),this.removeClick=(e=>r.a(this,void 0,void 0,function*(){let t=this.keyFields[e.keyIndex]._tuid,i=this.cUsq.cTuidMain(t.Main).getLable(t),r=this.res.confirmDelete||s.a.template("do you really want to remove ${label}?");if(!1===confirm(r({label:i})))return;let n=this.entity,o={},a={};(o.arr1=[]).push(a);for(let s=e;void 0!==s;s=s.parent){let e=s.keyIndex;a[this.keyFields[e].name]=s.box.id}let l=this.keyFields.length;for(let s=e.keyIndex+1;s<l;s++){a[this.keyFields[s].name]=-1}yield n.actions.del.submit(o);let c=e.parent.children,u=c.findIndex(t=>t===e);u>=0&&c.splice(u,1)}))}internalStart(){return r.a(this,void 0,void 0,function*(){let{keys:e,schemaFrom:t}=this.entity;this.isFrom=void 0!==t;let i=this.entity.queries.all,r=(yield i.query({})).ret,n=e.length;this.keyUIs=s.a.clone(this.ui.keys||[]),this.keyFields=[];let o=i.returns[0].fields;for(let s=0;s<n;s++)this.keyFields.push(o[s]),s>=this.keyUIs.length&&this.keyUIs.push({content:f.b});this.items=Object(g.l)([]);let a=void 0;for(let s of r){let e=this.addItem(a,s);void 0!==e&&(this.items.push(e),a=e)}yield this.showVPage(this.VMapMain)})}createItem(e,t,i,r,n){let s=new b(e,t,i,r);return r===this.keyFields.length-1&&(s.isLeaf=!0,s.values=n),s}addItem(e,t){let i=void 0,r=this.keyFields.length,n=e;for(let s=0;s<r;s++){let e=this.keyFields[s],{name:r}=e,o=e._tuid,a=t[r];if(void 0===a)break;let{id:l}=a;if(0===s){if(0===l)continue;void 0!==n&&n.box.id===l||(i=n=this.createItem(void 0,o,a,s,t));continue}let{children:c,box:u}=n,h=c.length;if(h>0){let e=c[h-1];if(e.box.id===l){n=e;continue}}l>0&&c.push(n=this.createItem(n,o,a,s,t))}return i}searchOnKey(e,t){return r.a(this,void 0,void 0,function*(){let{_tuid:i,_ownerField:r}=e,n=this.cUsq.cTuidSelect(i),s=t;void 0!==r&&"object"===typeof(s=t[r.name])&&(s=s.id);let o=yield n.call(s);return i.getIdFromObj(o)})}get VMapMain(){return v}}i.d(t,"a",function(){return w})},function(e,t,i){"use strict";var r=i(2),n=i(8),s=i(0),o=i(4),a=i(18);class l extends n.b{constructor(){super(...arguments),this.onSubmit=(()=>r.a(this,void 0,void 0,function*(){let e=this.vForm.getValues();this.returns=yield this.controller.submit(e),this.closePage(),this.openPage(this.resultPage)})),this.mainPage=(()=>{let{label:e}=this.controller;return s.createElement(o.Page,{header:e},this.vForm.render("mx-3 my-2"))}),this.resultPage=(()=>{let{label:e}=this.controller;return s.createElement(o.Page,{header:e,back:"close"},"\u5b8c\u6210\uff01",s.createElement("pre",null,Object(a.a)(this.returns)))})}showEntry(e){return r.a(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e),this.openPage(this.mainPage)})}}class c extends n.a{internalStart(){return r.a(this,void 0,void 0,function*(){yield this.showVPage(this.VActionMain)})}get VActionMain(){return l}submit(e){return r.a(this,void 0,void 0,function*(){return this.entity.submit(e)})}}i.d(t,"a",function(){return c})},function(e,t,i){"use strict";var r=i(2),n=i(8),s=i(0),o=i(4);class a extends n.b{constructor(){super(...arguments),this.view=(()=>s.createElement(o.Page,{header:this.label},"pending"))}showEntry(e){return r.a(this,void 0,void 0,function*(){this.openPage(this.view)})}}class l extends n.a{internalStart(){return r.a(this,void 0,void 0,function*(){yield this.showVPage(this.VPendingMain)})}get VPendingMain(){return a}}i.d(t,"a",function(){return l})},function(e,t,i){"use strict";var r=i(2),n=i(8),s=i(0),o=i(4);class a extends n.b{constructor(){super(...arguments),this.view=(()=>s.createElement(o.Page,{header:this.label},"History"))}showEntry(e){return r.a(this,void 0,void 0,function*(){this.openPage(this.view)})}}class l extends n.a{internalStart(){return r.a(this,void 0,void 0,function*(){yield this.showVPage(this.VHistoryMain)})}get VHistoryMain(){return a}}i.d(t,"a",function(){return l})},,,,,,function(e,t,i){"use strict";i.d(t,"a",function(){return s});var r=i(23),n=i(25);const s={set(e){Object(r.h)(e),n.a.setCenterToken(e)},clear(){Object(r.h)(void 0),n.a.setCenterToken(void 0)}}},,,,function(e,t,i){"use strict"},,,function(e,t,i){"use strict";i(0)},function(e,t,i){"use strict";i(0),i(10)},function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"c",function(){return c}),i.d(t,"b",function(){return u});var r=i(2),n=i(0),s=i(13),o=i(37),a=i(19);class l{constructor(e){this.isDev=a.g,this.onMessageReceive=(e=>r.a(this,void 0,void 0,function*(){yield this.onMessage(e)})),this.res=e||{},this.x=this.res.x||{}}get user(){return s.c.user}get isLogined(){let{user:e}=s.c;return void 0!==e&&e.id>0}dispose(){s.c.unregisterReceiveHandler(this.receiveHandlerId),this.onDispose()}onDispose(){}showVPage(e,t){return r.a(this,void 0,void 0,function*(){yield new e(this).showEntry(t)})}renderView(e,t){return new e(this).render(t)}event(e,t){return r.a(this,void 0,void 0,function*(){yield this.onEvent(e,t)})}onEvent(e,t){return r.a(this,void 0,void 0,function*(){})}msg(e){alert(e)}errorPage(e,t){this.openPage(n.createElement(o.a,{header:"App error!"},n.createElement("pre",null,"string"===typeof t?t:t.message)))}onMessage(e){}beforeStart(){return r.a(this,void 0,void 0,function*(){return this.registerReceiveHandler(),!0})}registerReceiveHandler(){this.receiveHandlerId=s.c.registerReceiveHandler(this.onMessageReceive)}start(e){return r.a(this,void 0,void 0,function*(){this.disposer=this.dispose.bind(this),!1!==(yield this.beforeStart())&&(yield this.internalStart(e))})}get isCalling(){return void 0!==this._resolve_$}call(e){return r.a(this,void 0,void 0,function*(){return void 0===this._resolve_$&&(this._resolve_$=[]),new Promise((t,i)=>r.a(this,void 0,void 0,function*(){this._resolve_$.push(t),yield this.start(e)}))})}vCall(e,t){return r.a(this,void 0,void 0,function*(){return void 0===this._resolve_$&&(this._resolve_$=[]),new Promise((i,n)=>r.a(this,void 0,void 0,function*(){this._resolve_$.push(i),yield new e(this).showEntry(t)}))})}returnCall(e){if(void 0===this._resolve_$)return;let t=this._resolve_$.pop();void 0!==t?t(e):alert("the Coordinator call already returned, or not called")}openPage(e){s.c.push(e,this.disposer),this.disposer=void 0}replacePage(e){s.c.replace(e,this.disposer),this.disposer=void 0}backPage(){s.c.back()}closePage(e){s.c.pop(e)}ceasePage(e){s.c.ceaseTop(e)}removeCeased(){s.c.removeCeased()}regConfirmClose(e){s.c.regConfirmClose(e)}}class c{constructor(e){this.controller=e,this.res=e.res,this.x=e.x}get isDev(){return a.g}renderVm(e,t){return new e(this.controller).render(t)}showVPage(e,t){return r.a(this,void 0,void 0,function*(){yield new e(this.controller).showEntry(t)})}event(e,t){return r.a(this,void 0,void 0,function*(){yield this.controller.event(e,t)})}returnCall(e){this.controller.returnCall(e)}openPage(e,t){this.controller.openPage(n.createElement(e,t))}replacePage(e,t){this.controller.replacePage(n.createElement(e,t))}openPageElement(e){this.controller.openPage(e)}replacePageElement(e){this.controller.replacePage(e)}backPage(){this.controller.backPage()}closePage(e){this.controller.closePage(e)}ceasePage(e){this.controller.ceasePage(e)}removeCeased(){this.controller.removeCeased()}regConfirmClose(e){this.controller.regConfirmClose(e)}}class u extends c{constructor(e){super(e)}render(e){return null}}},function(e,t,i){"use strict";var r=i(83);i.d(t,"Form",function(){return r.a});var n=i(75);i.d(t,"Field",function(){return n.a});var s=i(76);i.o(s,"Loading")&&i.d(t,"Loading",function(){return s.Loading}),i.o(s,"TabCaptionComponent")&&i.d(t,"TabCaptionComponent",function(){return s.TabCaptionComponent}),i.o(s,"Tabs")&&i.d(t,"Tabs",function(){return s.Tabs}),i.o(s,"resLang")&&i.d(t,"resLang",function(){return s.resLang});var o=i(77);i.o(o,"Loading")&&i.d(t,"Loading",function(){return o.Loading}),i.o(o,"TabCaptionComponent")&&i.d(t,"TabCaptionComponent",function(){return o.TabCaptionComponent}),i.o(o,"Tabs")&&i.d(t,"Tabs",function(){return o.Tabs}),i.o(o,"resLang")&&i.d(t,"resLang",function(){return o.resLang});i(16)},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var r=i(0),n=i(41),s=i(16);class o extends r.Component{render(){let{name:e,children:t}=this.props,i=this.context;if(void 0===i)return r.createElement("span",{className:"text-danger"},"!only in Form!");let s=i.getItemSchema(e),o=Object(n.b)(i,s,t,this.props);return void 0===o?r.createElement("span",{className:"text-danger"},"!!",e," is not defined!!"):o}}o.contextType=s.a},function(e,t){},function(e,t){},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var r=i(2),n=i(7),s=i(31);class o{constructor(e=!1){this.isFirst=!0,this.loading=!1,this.beforeLoad=!0,this.loaded=!1,this.allLoaded=!1,this.firstSize=100,this.pageStart=void 0,this.pageSize=30,this.appendPosition="tail",this._items=n.l.array([],{deep:e})}get items(){return!0===this.beforeLoad?null:!1!==this.loaded?this._items:void 0}scrollToTop(){this.topDiv="$$"+Object(s.a)()}scrollToBottom(){this.bottomDiv="$$"+Object(s.a)()}reset(){this.isFirst=!0,this.beforeLoad=!0,this.loaded=!1,this.param=void 0,this.allLoaded=!1,this._items.clear(),this.setPageStart(void 0)}append(e){"tail"===this.appendPosition?this._items.unshift(e):this._items.push(e)}first(e){return r.a(this,void 0,void 0,function*(){this.reset(),this.beforeLoad=!1,this.param=e,yield this.more()})}more(){return r.a(this,void 0,void 0,function*(){if(!0===this.allLoaded)return;if(!0===this.loading)return;this.loading=!0;let e=this.pageSize+1;!0===this.isFirst&&this.firstSize>this.pageSize&&(e=this.firstSize+1);let t=yield this.load(this.param,this.pageStart,e);this.loading=!1,this.loaded=!0;let i=t.length;!0===this.isFirst&&i>this.firstSize||!1===this.isFirst&&i>this.pageSize?(this.allLoaded=!1,--i,t.splice(i,1)):this.allLoaded=!0,0!==i?(this.setPageStart(t[i-1]),"tail"===this.appendPosition?this._items.push(...t):this._items.unshift(...t.reverse()),this.isFirst=!1):this._items.clear()})}}r.b([n.l],o.prototype,"loading",void 0),r.b([n.l],o.prototype,"beforeLoad",void 0),r.b([n.l],o.prototype,"loaded",void 0),r.b([n.l],o.prototype,"allLoaded",void 0),r.b([n.e],o.prototype,"items",null),r.b([n.l],o.prototype,"topDiv",void 0),r.b([n.l],o.prototype,"bottomDiv",void 0)},function(e,t,i){"use strict";var r=i(2),n=i(7);r.b([n.l],class{constructor(e=100){this.arr=[],this.dict=new Map,this.maxCount=e}loadIds(e){let t=[];for(let i of e){if(null===i)continue;let e=this.dict.get(i);void 0===e&&(t.push(i),e={id:i},this.dict.set(i,e))}this.loadId(t)}get(e){if(void 0===e||null===e)return null;let t=this.dict.get(e);return void 0===t&&(this.dict.set(e,{id:e}),this.loadId([e]),t=this.dict.get(e)),t}setItem(e,t){void 0===t?(this.dict.set(e,null),this.arr.push({id:e})):(this.dict.set(e,t),this.arr.push(t)),this.arr.length>this.maxCount&&(t=this.arr.shift(),this.dict.delete(t.id))}loadId(e){return r.a(this,void 0,void 0,function*(){let t=yield this._loadIds(e);if(void 0===t)for(let i of e){if(null===i)continue;let e=yield this._loadId(i);this.setItem(i,e)}else for(let i of e){let e=t.find(e=>e.id===i);this.setItem(i,e)}})}}.prototype,"dict",void 0)},,function(e,t,i){"use strict";i(2),i(0),i(49)},function(e,t){},function(e,t,i){"use strict";var r=i(2),n=i(0),s=i(7),o=i(10),a=i.n(o),l=i(41),c=(i(70),i(16));const u={_:{required:"required",number:"not valid number",integer:"not valid integer",min:"min value is ${min}",max:"max value is ${max}"},zh:{_:{required:"\u5fc5\u987b\u586b",number:"\u9700\u8981\u6570\u5b57",integer:"\u9700\u8981\u6574\u6570",min:"\u4e0d\u80fd\u5c0f\u4e8e${min}",max:"\u4e0d\u80fd\u5927\u4e8e${max}"}}};var h=i(38);i.d(t,"a",function(){return d});class d extends n.Component{constructor(e){super(e),this.DefaultContainer=(e=>n.createElement("form",{className:a()(this.props.className)},e)),this.DefaultFieldContainer=((e,t)=>{let{fieldLabelSize:i}=this.props;if(i>0){let r;null===e?i=0:r=n.createElement("label",{className:a()("col-sm-"+i,"col-form-label")},e);let s="col-sm-"+(12-i);return n.createElement("div",{className:"form-group row"},r,n.createElement("div",{className:s},t))}return n.createElement("div",{className:"form-group"},null===e?null:n.createElement("label",{className:"col-form-label"},e),t)}),this.DefaultFieldClass=void 0,this.DefaultButtonClass="text-center py-2",this.DefaultRes=Object(h.a)(u),this.ArrContainer=((e,t)=>n.createElement("div",null,n.createElement("div",{className:a()("small text-muted text-center bg-light py-1 px-3 mt-4 mb-1")},e),t)),this.RowContainer=(e=>{let t=a()({"py-3":!0});return n.createElement("div",{className:t},e)}),this.RowSeperator=n.createElement("div",{className:"border border-gray border-top"});let{schema:t,uiSchema:i,formData:r,Container:s,FieldContainer:o,FieldClass:d,ButtonClass:p,res:m}=e;this.Container=s||this.DefaultContainer,this.FieldContainer=o||this.DefaultFieldContainer,this.FieldClass=void 0!==d&&""!==d&&null!==d?d:this.DefaultFieldClass,this.res=m||this.DefaultRes,this.ButtonClass=p||this.DefaultButtonClass,this.schema=t,this.itemSchemas={};for(let n of this.schema)this.itemSchemas[n.name]=n;this.uiSchema=i,this.data={},this.initData(r);void 0!==this.props.children||this.uiSchema&&this.uiSchema.Templet;let{children:f}=this.props;if(void 0!==f)this.content=n.createElement(n.Fragment,null,f),this.formContext=new c.b(this,!0);else{let e;void 0!==this.uiSchema&&(e=this.uiSchema.Templet),void 0!==e?(this.content="function"===typeof e?e(this.data):e,this.formContext=new c.b(this,!0)):(this.formContext=new c.b(this,!1),this.content=n.createElement(n.Fragment,null,this.schema.map((e,t)=>n.createElement(n.Fragment,{key:t},Object(l.b)(this.formContext,e,f)))))}}initData(e){void 0===e&&(e={});for(let t of this.schema)this.initDataItem(t,this.data,e)}initDataItem(e,t,i){let{name:r,type:n}=e;if("button"!==n)if("arr"!==n)t[r]=i[r];else{let n=e,{arr:o}=n;if(void 0===o)return;let a=n.itemSchemas={};for(let e of o)a[e.name]=e;let l=i[r];void 0===l?l=[]:!1===Array.isArray(l)&&(l=[l]);let c=[];for(let e of l){let t={};for(let i of o)this.initDataItem(i,t,e);c.push(t)}t[r]=Object(s.l)(c)}}componentDidMount(){let{beforeShow:e}=this.props;void 0!==e&&e(this.formContext)}render(){return n.createElement(c.a.Provider,{value:this.formContext},n.createElement(this.formContext.renderErrors,null),this.Container(this.content))}}r.b([s.l],d.prototype,"data",void 0)},function(e,t,i){"use strict";var r=i(2),n=i(0),s=i(7),o=i(9),a=i(10),l=i.n(a);class c{get content(){return!0!==this.selected?this._content:void 0!==this._content?this._content:this._content=this.contentBuilder()}}r.b([s.l],c.prototype,"selected",void 0);const u=(e,t,i)=>n.createElement("div",{className:"d-flex justify-content-center align-items-center flex-column cursor-pointer "+i},n.createElement("div",null,n.createElement("i",{className:"fa fa-lg fa-"+t})),n.createElement("small",null,e));let h=class extends n.Component{constructor(e){super(e),this.tabs=[],this.tabClick=(e=>{this.selectedTab.selected=!1,e.selected=!0,this.selectedTab=e});let{size:t,tabs:i,tabBack:r,contentBack:n,sep:s,selected:o}=this.props;switch(t){default:case"md":this.size="3.2rem";break;case"sm":this.size="4rem";break;case"lg":this.size="2.5rem"}this.tabs.push(...i.map(e=>{let t=new c;return t.name=e.name,t.selected=!1,t.caption=e.caption,t.contentBuilder=e.content,t.notify=e.notify,t})),this.tabBack=r||"bg-light",this.contentBack=n,this.sep=s||"border-top border-gray",void 0!==o&&(this.selectedTab=this.tabs.find(e=>e.name===o)),void 0===this.selectedTab&&(this.selectedTab=this.tabs[0]),this.selectedTab.selected=!0}render(){return n.createElement("div",{className:"tab"},n.createElement("div",{className:this.contentBack,style:{height:"calc(100% - "+this.size+")"}},this.tabs.map((e,t)=>{let i={display:!0===e.selected?void 0:"none"};return n.createElement("div",{key:t,style:i},e.content)})),n.createElement("div",{className:l()(this.tabBack,this.sep),style:{height:this.size}},this.tabs.map((e,t)=>{let i,{selected:r,caption:s,notify:o}=e;if(void 0!==o){let e=o.get();void 0!==e&&(e>0?i=n.createElement("u",null,e>99?"99+":e):e<0&&(i=n.createElement("u",{className:"dot"})))}return n.createElement("div",{key:t,className:"",onClick:()=>this.tabClick(e)},n.createElement("div",{className:"align-self-center"},i,s(r)))})))}};r.b([s.l],h.prototype,"selectedTab",void 0),r.b([s.l],h.prototype,"tabs",void 0),h=r.b([o.a],h),i.d(t,"a",function(){return u}),i.d(t,"b",function(){return h})},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var r=i(2),n=i(0),s=i(19);class o extends n.Component{constructor(){super(...arguments),this.reApi=(()=>r.a(this,void 0,void 0,function*(){this.props.clearError();const{channel:e,url:t,options:i,resolve:r,reject:n}=this.props;yield Object(s.l)(e,t,i,r,n)})),this.close=(()=>r.a(this,void 0,void 0,function*(){this.props.clearError()}))}render(){let e,{error:t,url:i}=this.props;if("object"===typeof t){let i=[];for(let e in t)i.push(n.createElement("li",{key:e},n.createElement("label",null,e),n.createElement("div",null,t[e])));e=n.createElement("ul",null,i)}else e=n.createElement("div",null,t);return n.createElement("li",null,n.createElement("article",{className:"page-container"},n.createElement("section",null,n.createElement("div",{className:"va-error"},n.createElement("div",null,"\u7f51\u7edc\u51fa\u73b0\u95ee\u9898"),n.createElement("div",null,"\u70b9\u51fb\u91cd\u65b0\u8bbf\u95ee"),n.createElement("div",null,"url: ",i),e,n.createElement("div",{className:"p-3"},n.createElement("button",{type:"button",onClick:this.reApi},"\u91cd\u65b0API"),n.createElement("button",{type:"button",onClick:this.close},"\u5173\u95ed"))))))}}},function(e,t,i){"use strict";i.d(t,"a",function(){return n});class r{constructor(e){this.name=e}get(){if(void 0!==this.value)return this.value;let e=localStorage.getItem(this.name);return this.value=null===e?void 0:JSON.parse(e)}set(e){e?(this.value=e,localStorage.setItem(this.name,JSON.stringify(e))):this.clear()}clear(){this.value=void 0,localStorage.removeItem(this.name)}}class n{constructor(){this.user=new r("user"),this.guest=new r("guest"),this.unit=new r("unit"),this.homeTabCur=new r("homeTabCur")}logoutClear(){[this.user,this.homeTabCur].map(e=>e.clear())}}},,,,,function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAABz1SURBVHja1Ht5eBzVle+5tXb1JnWrtcuSbNmSjY2RWcxmiIGEDIEJMEmALB8fecMkhJdMlknCy3skE4YhkH0jTDIZAsO8gQyEhLwQJiFgMEsMBizvkixrX1otqffu6q6qW/e+c6sleZNsky//pP2VW6rl1j3b7/zOuVeEcw47128B3zndAIzB4ocA0LEpUDtWAcfzUsAPUlUYiCJD4Ze/AZbJgtLSAtwqg7Z2DZCaGsCh8DmC5yywX3sDuOMASybBTaVAX9cFbjaH1yXgpgmsWARjy0Xg33opgE8DbtvgJmZg2Y8Yt2wBy+UBJAlO64MTIqoKPJf7YOnNXV8/f7SnVYG/lA8KyUslcEdHPSFO9xmQlag7l/x4OZdfIU795QgsrGUYINfVAqeuZ/FT3S+8hqWz77EHhy5Jq1LxL0tgDCsSMEBqqAeeyZ2WWzuzs808lf4KI0Sa0aT4X5bAntAIEsK6rgsVwICTx3wqfRufTa4pIEZkm2NDpyuwUKUsnAQPesoXLULe4jMM+DEPkfkxRSAG8Mh548474indWsPHqsPLuDRZ/EIAfAedit8u4+tTuhovVocfO1bgEwYgAp2vc4aGbkKtBtWu1dvkjrbvmS/+kQmE9lyK4EOEcHEvQZdjmQwiMxWxcy0CzAc5pTJQ+v+Iz/cIyLKY8GX43//AwYPgMsrL9nbURZBI0ll4fS+O+T28VjqZ1bz3Vt59oj7Q8t5ZSa6iI2N3SaVSlOF7Mwp5yyHkmSMCs0qASz4fAgKtqIgQPzdLH3X6Dr0XdI3JK5pfZvkiE0iJL2zBmNqC6WUN3t+P9/4RNHUSheaEOuBMTl2GqegGFATkttYDxrouwiYnrqej418DRekiqgJSKPhjIpPtck30QRyzGzSN4/tDpxJYpEiR9o6JYQ/By+CMjgsEl8C2vkDHJy+RMQVmZXCnNfIq3jWzKLCwijMwjHm1CaTq6oV8vJoVCp1cyK7pE1K46hnn0CC4E5NXcc7uwTfXsHyuzMxypzMy+qRslj4mogaNbrj5wpmACpRbmvKha646ZI+O3mYPj30DJxuUNC2jdnY8TCcm70RlWSyZ6ncz2QOsVHwSBTJPGcMuXR6whBc59HI6NHordylqW4EZXUrkA8arflqJGk9gIkvA8gUov/EWaKs7PA0Sv389KxQbOQ4ihwIjbnz6MOEsjNb4Ki+a3UpT4yVqe1un1bPnZzQx24iTkLmLSEqkNaxorhSTkiIRlc4l7yi98PJKls0GcczDJBT8RzkafZROTnnehMr6KnqQD8MmiYounDKvLiesiC7OY2x45EvpXLbej8Ji+ELcJ+9QDKOHmkU4JoaJonjoh25XcRlVbcL4q0IXoeiGL7izcyU5HGzAeIySfMECx7nCGR59N1ptVNa0e/E7KUKa5bKbkGHVEU0DdCsfutmZgGFAdB2kcOgFbV3no55rIgvzAFCSBr14XDiWFXbp69680Sg4Z12amftcNp28LCMTqMZ7kwq3Erry32CVC4xxOAGlOXNBaW4CuTYWLu/bfw4UCgKXTElVd+I58b46KRBQEAF9bjJ9l9zSPKKsaPkoJvYXZNsCFakmWuo8jGVjgRl5VtdVzm0HpeRbpGBgE/7co52xDuNN86zsIe/JPkhnl1QGKsw60CuIiCwr6u1sNvnpMaCkWtJBQQHHwlqf0dD4NHrmIv4v+IcAi050iprKFd4mSdK53mQVZVquqtotydJ7rYO9j9L4dJVkGHnOERFVZRKBKYJT+RzG5nl4r4bx3YWuSTwcUJW0HI38GM/vJmgF5MFr7AN9Zwjr43nk58Z8PiVLI7K4JksntbwIRZaY2SL1HfrspJn1F3QV6ogKyOD5uCH/X0VREqgNDGfliMC8XP4OL5nPIHX7FE3MyOWdb651c/l6MQ+5oX4nc90Wa9+B+91kqg7d55MkGv0UWmecDg1f6AwcflwKh7+MYNdEZ2dX4QRavXjSdQuF+pYcqb6dBIMD81RPwXR0Jf7sBwEiboVEiAxxjFuLOMX7nYFBvOYIxVYEl44cooiZd/MWJV+4J1vIrxivq4a22noIOAyGg3oKve8ZfCtwvE8cR1A6X7jVC6dYzUfQEjKz6TsxRsNSdbgkRaMPOYcPb2KZ3ArJb7yCk9uJSpmSDeOvmeO8T0wWh0qCrh4mtnIBuvMqhtZVamufxee/gQKKd824cykQaQoR/CqWTJ+Fb91RsW7WEw4V61VSnnHRxe3+Q+CmMyA11gHD6krE6mLRgEpyEWcQE2qgULwXXfnioaYohDd1w+p9wzBuFWFyRdcvo21tg+Q4KlNBacMYw4m3InHoQO3d6bk1gYR+5oZ/xbjejmVhqyDszLK24IsRdCCHsN+F8TjMSnILouNK4rob3aJ5JsYkw3tMydCfQytTtDDQqalX0CI3codV82LR7ybnLpZCodeOZmDOyNhRQCRXhETXt/oGgMUTINfXgxKLzisth/dPSGpby53aTPIjQ0EdrCsugfMQmtyhEak3ZuSaNN8PjLJjnQAHXvqKRv7eTadvwuQdFAaXI5EiKuA/0RUR4Uqu1r3xv52h0a+w6cR5KFCV5PerxKX3I2Jvk+rr36GuaDZ4Pv88y+WSnPExSZXLiMLPQrnsuSiO96Kk619kth0WbIiXrH4mCAJDIFgudgWqitAQltW1ebeWK+6MliaG73bSf/i2ObsE/Stir3QzeTbyxq5r9ykUzDXrfnDJdG5/rrYBGJFOFBhT0K8x9fwBf9KIJGMODtiYZkwPeMRBaQKteTcPBqqgYMrIkhhaKuO9PBR8g0SqCbIyjq72LI7x7OKkPSAVwCMn8NzDR+VT4k3+eH8Tz2G6EqxJpDi+THpi5fLHlLJ1j8OZr6cpOhGtq7un7cXXr0nH49LeiLZ9JVceN5n7lZFE/ElOyIETBRaT4lywHHOhFDuhSKgIn61onx17uC73zi+HpicWHHxJ2ojWZ6k0onegAkrHP4cKRmZ3GyRmvsHLpdBbATmNqfDOc225zZlO3NwXC0LNed0/X3No4sp4If/F4ZLyMj61hMCnKLMWBVmYgHC1gN+LJ49AHN0a+pOKexwikwa3iARlOYKBXoFx/TE+NvlNKWcGX5cda1RRP3tD1j7gm8v8YoI5oezaNb9ZX9+yJrjr0C2zdvEQ0+p2k+NSnnLKtoplV+whhAyFvOLb19gIgXvu9HpQ+Qce9DoR6OJvX3AhmKiy8sVKnSuel5Wl7pNYqfR30vT0tyGTC+wyCJQ2n//vN+bpM/LhoQeyqVTbxPoOvqKzKxp+7pXLCslUtNAS2a5mCwWJwGkKLGgiap0Oj4o8Dfo5m0CqqwNraKRyHfMoMi2I3v9NcHbtgRKCizVwGGMQgdGnn56wSGxcUWrySqW5zH0EXf1j0lzyXqSogR6Nw8yF5/7npZGmf9CnDt5ZKpXeP2KgqwcCpH7XgYshmYKMJkM5UvViiQp6dyqBF9wWBRCJ38t98nw8zVtQTE6S5+leNgfq2k7wXXIRqKvaIfuVr3mxuKTnCrIhxvNATbCkvFepSeIcX1LYBnzms2rZvh2zRrAnJLPJLRc+dF5rxydqduy+qTg0/KmcxMHG51cOjAKzMQOgC2fCftu/etUewPGP97pjBUaNg654nJp4lE5dahJBzMl/Vy4UxsGxf7GooFQK5OveAz4kBPQ7P4JFEJtnRpi3AZkPMFSQiHuey1cQnCxNK7kstdCZ2W/7LHoDRQW+pFiFQaL8042z5reDAzsuKM7O/NCViF/Ms4tJYOL4ObRsddmB2YC+vUTpHrWq6gR8XERpwXUJ8lsPHV26RDzLmBHImTJ17x4YHnhn8be/+TQg+T8WSbkX58ql58Ga4UkAUXXNJT1mpDU2ACAJccxSJfWIppwoHpbADebQd0jl8j2+dP7iPCq/pzaQHAwE77o+7f6wZt+hbpPaP3E5q+JITGqQtiddC/okCpuYDDldhilmPa4VclksKE5AemURdYVbLdSax90kkj8dGT2TlK1/s1xncz+3nvbNJJ5QlgAYPjMDWl0UYCxeIeylSgNDpBpRogmrkuVKQUKQYrEbMV7vVG1nXUKTYBsvvVFq67jvA2PZX9X6jE0Flv8ZA2kD4RIY6JBZy4T9jdXQrBpQPTYDfRF9gNfWvo5exDGEYUmm5fV5teWBBq1f6yaT98nJ9Oa0Lpet6vAjxaEhDB++VIYBL4IRSC7B2sRZsOGpEbwOefj/1E3789ym/j6w3RcM6YnGtq67biprfcyyu4vMehDZWrfQlQ8ZVN4sQE/XCrv54i3krOdeV8edEoz6g09gldbr0qU7mxUuvVwnn1Qk4KZ5NTNL79GwiM9pEGe6voMI6y7TwWyiHC4G9YiwJ0drDHD2LrlU+oxetv4q4zqwS4fp14PKjwOMfP0aJWL5y+ZFKdP8PpflTcjtwMBhU9SCV6u14brW1kc3HJq4vjQydMYBjfUnqPU4mYov212tcOnamuWbZrbd4MzO3kpENwTHcKqrh1QOJYIF//HyCP2IPHCRScA11FP3jQGaERM+rJbLn6Zlq+kQofBHH30+79fvXaX6n/8rW4NgvviJVDr1JUbICh3foKKjTPIyvB7zv95+/gX/a8PBkXOc/b0rRkO6le5c+Uhd0L9fPomelfl6ePkcaDtXMeqcjxQeiThAzrZ2uXOzWfn4OBftRhSiy5WBh6KnWvNR0MWvV8zC7SSb2xonLvT7pMN7DennBvH/4CotPLtJ8VcVndLtyeHhO3CSVX58hGKt8QYvwa4a/1Od1ZFPXODI77KnZu6ec0rGVPemwsXXXTsUzQm85icXWPDXZQXmfAsRhTviiVea+TRuIRIqx4UkRYk7ygzWlbBgDy0rqGjOb0Xyf7Ni2ddlsHrq9UOuV5V+XZDY/ZcbtTvbiQaNstY1k0n+Ey/Z70f1ScJikxStqtJ+uaPtXy/VAt9duX/ootJI8uvUKhvja9qhtq096Pvtc9fEZxJPS7KydDPw/3xm3sKi47D0J4KTW7NQmIu40P1+2QjoRGHHarEkE2hPYVFO6DwTJcfGOCFRRN+vSqXSDQgn9Qg+QIN+iJ259leXxxN/79f0XHPJkQlnH8mkk59nheIGWeRvPN7Swdxv6E8EytI9N9SvGqjKFz80R+2vU6Y0DvrQCI110LF3AHoG+1qGFR7A4nFJgd+9YGHRuFu6LoU6e2CwRqSShRYJE+QED36UwBZe25CnEEGmQ0Xlh+ypODEJxdaWCjqTSuBQagd8rlsfFp6CQBnG+6KHRq/SOdyitNQcKKTjH8aa+ibM0YbgBV4Kw3e1xhpfW0PI5/1VWlodHf9qMp3+Ilc1Y1ZikEVbbBiYwpRfhpnm2EEzEsoqLju5S5PjimSPR4u4dtmZeKlZwAuft1htKuf48zI/kpIQoJAc1GAeJLJaaQHiNQmLjhr8vSQzTB9FkQnMg3WhL5fNTKLFcq7vsHin4TKJZtJ1RVX9rjQ6WsICIXB0mSneybBmjiVS3WoweBPV3YsL8ekbiddVkEDlDFowljS3DHFDTmdDwW1E08qcnSKGldUrj5VXVaDcsxfcdJrysiWIsyeIjJqLGYHmoKFrqHmPjgmXM7CCCiOlc4PasR6CrE1PJEGNT0N5ZSs4ujJVIPC/34wGHkyazm3rSuyWWLEcI5RJDi0EZMHRQQb3KNARuEEdO+qkkj9c4CaK4C3oOXn0JluVoKZE4SDhO+bAfUGlTqVbcjKBj89ZmPhB71odtqYSq51cTvE6jMLFcEKK5Vzg6mqUuY4pXJshm9JOtuznWUmCkMuhtexCOhiCfU5xMKcpX9gdNv64Lqt9c0Uy12GLrRRozaBY4xI9LVk+pv72JovfPlSJjUL1gJUprO2Kn58srkuUp5xCNPp4F5OTrOicvMW9uCZzDLNCrc7Mvo9NxT+FMeivNAFQcahRLV9oDfi0dWpz04SEdbCLrk/6D6PA0pFSm2DVQUgYKalYghHccsaVpfyGIgUaxVo6gTGH0Dso818Nb+zKGhOzP4kMDK/OR8KQwTEj8USlxXMU/RTMSgDlJFiwQ6ejoY41/7xVNrrp9PC6vSH96Quq6n5xtquCK518zdUT2J2aPtEquXwLS8y0eG3YhfJNcG7G9VCu+DeBTQ1/kBrqgM7NQbF3AF3bQ2bkp+QyVjL/GvP3Cnt4tJOUSjl8eIgXCgctn2+7wtjLmyWDFRHVTUw1JUPfljh7/W2+ZOaBmGV1FrZ0l4p9A8zYdzAgChFvOvjuBN47rBNz0Cc/2wrBL29Vq1q0g/13vloTGGtf0fLrhvHZK7YZUk+C2eMyLF1bf2aReJgnLtoRTX0TLT+NQjQc4+6ibi8Wb6Rm8Q2Z0p+5rruQhrq4bd0hhIUii1UUOeX1mokinecm5lzQtVlSy35dJPw76AKHznUk6KUMbF17vhCr/pyvf+iXoUOD44Vg4D9cw/dBlbEzuKjSkHBMNNe+1Ufsf77Qlrd1lXiTsr/vm7slu029eMvkRfHsJw8k9kZ31Rq35AlfVuBFC9uDQ0tdG8OKYw4UpWGJRemI1XvobnkmOcRsS7Rgz2Tp7AOYhLcc0/dSlKMW112ZF80Gpzzxccnv76Kx2O2Kovau6R+BaZ8BTFN/xxrqHyO9Ax+QOlpHzJWtDwVHJr8mcaYyHHONasTriP+pFrO4idDSwyPM2pAzNNiwp7/JnJxujjfF3iRVxpiRTFaaEydNS+HwUmijIc1SuegaSPIJNaubmGly51J3yc0Nj6E0N2HNuwUlPLbsO/pn0dKVKlUTKxa3Et13HwsaNyNCZzuH4yDpfpfXq0/SdOZmlkx/gG5Y+4/gsL8hExMXMny/byZ1dqAm+h3Xdq50bHt9EM+tLqHTjE+SOLVpXA/8PNDYMEpiNUuvVR0tsO/ss5ZC1wlr1+5xJ5nqIr4lNCasx+FSNzG7BVOE5P1OTr7pgy+s8Qoik05tBah+rxUJ/wf3+6BKcAWV7Ceh4G55du4S3aZcbaj7FovHH8EHA+htTXQ68Vkxjo6aS2O1NKMSvIAFfyQ0adfVbldopcVzqg0rYk13qWNWCod2S4av0vpZTgpKJb7IppbWKDIpTF1Y6fD53nulWxkmVvnGZGOsur+uCijmfsSBCU7pNvyOQCZzFd64gwRDvQthoiCA+HAug0g09q9fyZuitVDAcnKstvoprmm7KTI3iteXO46sHuYLJx7ZfLUcDNYTw++1Y06rb328sDjPEtYuPVhLbuPF/nGg2QU9IdqL/v1mlOVccR+dioMzPumwgplS0IJmIX+25dKULCs7xDN6ZTsQ7CQW7WmofrC7uf33DTkT+sLaYbe58WFd1aiGKU3z+ZY9Fl3a2t+31HxX4XGht2CtyG+7ty7KRxMn2NNQNT3M7Ts3Fegr/bq8Osj170cyxQ4mXJvS2szQ4KqspkJXtozPoG1DIVVKpcA2fDU0i/SkVO51ZIkNuZa0X2KH9PWdX3tnrKm/fvvOB3qsvJm68KxvocJ3czit7VQLoBVaeoEkhxXBPMs61YYsNt/aIYu7CdCNAga0Nrf+rvvw2KMxpA1zqlGtFIpJVyIdfnw1WhDSIyNaCr9ZXXtlpd9xmSAdLoFOWZHq9WjELqaTfL9KfuGXlc9cWSTMyE8+vK+Y2VS69spd77z2ut+AQ0/bEBUuXRtbylWHMceOuqXS2uWFRYKC/4TbYnmDh4Q0knhcmKKSgo4Lkf7Ry9xy6SFTlsOBDD3ftaywAK4514Zev5xjazfOVRs6FgA6KLbDnf4Bx+trE2JBtMblAZqRUsnS5uZVO1pjdZaz7aVv9bn2lfEVMdjokHUjjz1+Naatn56OsBd+6PqlufT8uQwJBA9CKvPu5RbKZERFS1ehf2XTGM1mJltSua5qkMM6FqoiBzP0jrJltWGp1ybSkSQW3ZG27pWcxH6NvgLR8C/PuuD8Z8INjaC+1gOSWdaUSHXMyU9ArlAciMXoHFdkP75ZrTLLHy+PT95IVXkz6AZszDmQf34721ulFthp7ib+8CLTWqbhRfz6fxGJXI3u2bkcMAknhHDwX/pp4d8P2dIWw3LWb/IHb+go0XV0YZfNkQYKojSzkQn9qKzr90k+n+P6dPAXTdAbGxFMyq18eORSEUKzZbNYH58qc9UfRfdWyMh4p8CFPHqUISkQKlrwVkTfI7ev+J1yqp21x7u02t623PUe2We8Zu3b3ykKf2814ugVVPwdQYU3JnOmXdcU32OVnpjB46z2FS8oQ/HfOsVCgBwV/wJYKCG02YXhzUXXmVZNqN7TC/WmA7bY/M1ZO1a13UVNYWW/vtsIhh2SzlPZccCPITNNS3AwoILYLTeGJVq6pfZRIxhMEw5vT2BpHrKXiOOVru7byI/QhuM2xnGxGqGFOGzt9lU91B5tzT85lwJJ07fTWORJks/dfPS+SBHz6E3SmGsFLCxBfZN5MKYzWEdXgYuVEmQLm9WypSZUMpktm8+H6uqAmPZ6LEnlXrBh7Nz1+bW1TQH/71+UehrDr8o1Nf8ldhq9DXkrAtOJ8eUWbpNseCwuUbebLZWaxGo8ajs4l1mr+QKt9T7jwHvWnwNBrHIKqn6/Npu8VC0W2110a6+BACJVMTLu17TDiOCbLAJRRwNXxLZhXENSmU+WUTe9iruvo67lYIvia5k2zUtfIuV8Sle+u4XKMy3DUz98JaCWaGfH3cFgaO7tLtF6PkrE4tkSBw42Z4eC38ciPy0tsyJY+VuEcic1zfcVDZ1s2Hg2+NFjLJ/2Rjbs/57YGyAhyRC7HMRK4UzYbzactbH/by0DLnA1zESKWDW5ns3MPSBZVuOkT6bqxvXPdbevyTqJmXekC9lVgSu23re1YeW/NL114F2v7H3LGWmquSMYrvqDLLZFKsppH0eIh7w8zJl+48VSNPhv1cnc5zXOCTseIMTiF+OyOzZ+g15T81ui6W/VtLTC9N49YNbFfjpXEzmv5uDhD8mUEYcziBh+uanIzg46YNmcrXEJvRoc53IZqWYRlbxPhT+0UfKzdoeQ2cT0VrlYMjYqgWsDJfvqHgMunOve/ONotPoBmRBGKnz+bX08gX8fCyy/0602aPna637UdWjs8ob+4XOIono18Qn7IEvOep7N3ovM7G9hbm68um8IYrruWFZ5D4bD+zC3Ir/TIDydDMNc5t4SVqWoKbH3cD7GCfRV+1LVPv2nl42l0tmuyI2O67w/hIFAn31h8ytu0Zo6o+O7Gy+//JuBQNBllMKf8vEEXl1Vs+wNLlolHAyP1vkiT7nDE+f4LAccrdKdJEfzaSwynInJd5GXX73DGRq+Q6qurnEpvV3KF29FM/i4XOm9sErBIZ7RFni4QIdR0W3v3ji5OVMupnsHb4UDvf+gZXPVSXzsgF+a3O/K98Zk+Ufezj3Glk2lpyXwZStWn5Q6IhLDRNB8YnRdx9aGXQeu8LkK2DLx6CQ/an1ZTKS0d99H5aqqemRoTZw6FwnrextL+PLFhiueVwhsGE+ujCYzPzGtcrtllWBEB3evyp/NhrRvaGX+IvyJQp4gcJmeqtNHgPqN/qm2plvihw9/aZUDH63D/C+MIpZYvP7xAhurqvJjXnw/Eb0wBCvRfRT5lx2X2MgiDycecnZRCWjfQDCBjHRaV+CwLu2ZDfseMV3nMYPzOP0zCPu2/qrF+5sG4BNZVfpC3pBfjxatmxq5fEmIsqCOMCt7m8MrUlC815rfeKZzF1SEanV+TwifDwbJ22HBwMbrFgJfllAaD6szk5zuTKrsKRbwvaSp6rAijEHgz/Z5W3/GIxiNwrlZlskjvT7y9GFNuSJI4TKfWV4b8ilnIMWLIFsCS/MVMy7dqUdipprOxKoYOUuzbZ+3BCJVdk45KKypKVDU1WSSll/KMvosM4xByxGlHmR9Qil/Jqse/fn/AgwAOY4uqSLnKwwAAAAASUVORK5CYII="},function(e,t,i){},function(e,t,i){e.exports=i.p+"static/media/logo.ee7cd8ed.svg"},function(e,t,i){e.exports=i(138)},,,,,function(e,t,i){},,,,,,function(e,t,i){},,function(e,t,i){},,,,,,,,,,,,,,,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,,,,,,,function(e,t,i){},,function(e,t,i){"use strict";i.r(t);var r=i(0),n=i(36),s=i(2),o=(i(99),i(4)),a=i(15),l=i(7),c=i(90),u=i.n(c);const h=()=>{let e=u()({loader:()=>i.e(2).then(i.bind(null,141)),loading:o.Loading});return r.createElement(e,null)},d={homeCount:l.l.box(-1)},p=e=>!0===e?"text-primary":"text-muted";var m=i(9);class f extends o.View{constructor(){super(...arguments),this.showCart=(()=>s.a(this,void 0,void 0,function*(){yield this.controller.start()})),this.content=Object(m.a)(()=>r.createElement("div",null,r.createElement("button",{className:"btn btn-info btn-sm",onClick:this.showCart},"Cart: ",r.createElement("span",{className:"badge badge-light"},this.controller.cart.count.get()))))}render(e){return r.createElement(this.content,null)}}var v=i(6),g=i(10),y=i.n(g),b=i(41);const w=[107,109,110,187,189];class E extends b.a{constructor(){super(...arguments),this.minusClick=(()=>{let e=this.getValue();e||(e=0),this.setValue(e-1)}),this.plusClick=(()=>{let e=this.getValue();e||(e=0),this.setValue(e+1)}),this.ref=(e=>{if(this.input=e,null===this.input)return;let t;for(t=this.input;t;t=t.parentElement)if("FIELDSET"===t.tagName){!0===t.disabled&&(this.disabled=!0);break}}),this.renderContent=Object(m.a)(()=>{let e=this.renderTemplet();if(void 0!==e)return e;let t={};!0===this.hasError?t["is-invalid"]=!0:t["required-item"]=!0===this.itemSchema.required;let i,n,s,o,a=this.hasFocus,l=!0!==this.readOnly&&!0!==this.disabled,c=NaN!==this.value&&void 0!==this.value&&this.value>0;!0===this.disabled?(i="cursor-pointer",n="text-light"):(s=this.minusClick,o=this.plusClick,n="text-danger");let u=r.createElement("i",{className:y()("fa","fa-minus-circle","fa-lg",n,i,{invisible:!(!0===a||!0===l&&!0===c)}),onClick:s}),h=r.createElement("input",{ref:this.ref,className:y()(this.className,t,"mx-1 w-4c form-control",{invisible:!(!0===a||!0===c)}),type:"text",defaultValue:this.value,onChange:this.onInputChange,placeholder:this.placeholder,readOnly:this.readOnly,disabled:this.disabled,onKeyDown:this.onKeyDown,onFocus:()=>this.onFocus(),onBlur:()=>this.onBlur(),maxLength:10}),d=r.createElement("i",{className:y()("fa fa-plus-circle fa-lg",n,i,{invisible:!(!0===l)}),onClick:o});return r.createElement("div",{className:"d-flex align-items-center"},u,h,d,this.renderErrors())})}isValidKey(e){return void 0===w.find(t=>t===e)&&super.isValidKey(e)}onBlur(){super.onBlur(),this.hasFocus=!1}onFocus(){super.onFocus(),this.hasFocus=!0}render(){return r.createElement(this.renderContent,null)}}s.b([l.l],E.prototype,"value",void 0),s.b([l.l],E.prototype,"disabled",void 0),s.b([l.l],E.prototype,"hasFocus",void 0);const C=[{name:"list",type:"arr",arr:[{name:"checked",type:"boolean"},{name:"product",type:"object"},{name:"packs",type:"arr",arr:[{name:"pack",type:"object"},{name:"price",type:"number"},{name:"quantity",type:"number"}]}]}];class k extends o.VPage{constructor(){super(...arguments),this.inputRefs={},this.checkBoxs={},this.mapInputRef=((e,t)=>{if(null!==e)return e.value=t.quantity,this.inputRefs[t.pack.id]=e}),this.mapCheckBox=((e,t)=>{if(null!==e)return e.checked=t.checked||!1,this.checkBoxs[t.pack.id]=e}),this.updateChecked=(e=>s.a(this,void 0,void 0,function*(){let t=this.checkBoxs[e.pack.id];yield this.controller.cart.updateChecked(e,t.checked)})),this.updateQuantity=(e=>s.a(this,void 0,void 0,function*(){let t=this.inputRefs[e.pack.id];yield this.controller.cart.updateQuantity(e,Number(t.value))})),this.minusQuantity=(e=>s.a(this,void 0,void 0,function*(){e.quantity>1&&(yield this.controller.cart.updateQuantity(e,e.quantity-1))})),this.plusQuantity=(e=>s.a(this,void 0,void 0,function*(){yield this.controller.cart.updateQuantity(e,e.quantity+1)})),this.renderProduct=(e=>r.createElement("strong",null,e.description)),this.renderPack=(e=>r.createElement(r.Fragment,null,(1===e.radiox?"":e.radiox+"*")+e.radioy+e.unit)),this.renderItem=(e=>{let{product:t,pack:i,price:n,quantity:s}=e,o=r.createElement("img",{src:"favicon.ico",alt:"structure image"}),l=r.createElement("div",{className:"w-6c text-right"},r.createElement("span",{className:"text-primary"},s));return r.createElement(v.d,{left:o,right:l,className:"px-3 py-2"},r.createElement("div",{className:"px-3"},r.createElement("div",null,Object(a.tv)(t,this.renderProduct)),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-3"},Object(a.tv)(i,this.renderPack)),r.createElement("div",{className:"col-3"},r.createElement("strong",{className:"text-danger"},n))),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-12"},"\u8d27\u671f"))))}),this.onCartItemRender=(e=>{let t,i,n,{isDeleted:s}=e,o=r.createElement(r.Fragment,null,this.renderItem(e));r.createElement("input",{className:"text-center",style:{width:"60px"},ref:t=>this.mapInputRef(t,e),type:"number",onChange:()=>this.updateQuantity(e),disabled:s});!0===s?(n=r.createElement("del",null,o),t=(()=>e.isDeleted=!1),i=r.createElement(v.b,{name:"rotate-left"})):(n=r.createElement("div",null,o),t=(()=>e.isDeleted=!0),i=r.createElement(v.b,{name:"trash-o"}));let a=r.createElement("button",{className:"btn btn-light",type:"button",onClick:t},i);return r.createElement(v.d,{className:"px-2 py-2",left:r.createElement("input",{className:"mr-3",type:"checkbox",ref:t=>this.mapCheckBox(t,e),onChange:()=>this.updateChecked(e),disabled:s}),right:r.createElement(r.Fragment,null,a)},n)}),this.CheckOutButton=Object(m.a)(()=>{let{checkOut:e,cart:t}=this.controller,i=t.amount.get(),n=i>0?r.createElement(r.Fragment,null,"\u53bb\u7ed3\u7b97"," (",i," \u5143)"):r.createElement(r.Fragment,null,"\u53bb\u7ed3\u7b97");return r.createElement("button",{className:"btn btn-success w-100",type:"button",onClick:e,disabled:i<=0},n)}),this.onQuantityChanged=((e,t,i)=>s.a(this,void 0,void 0,function*(){let{data:i}=e,{product:r,pack:n}=i,{retail:s,currency:o}=n,{cCart:a}=this.controller.cApp;yield a.cart.AddToCart(r,n,t,s,o)})),this.productRow=(e=>{let{product:t}=e;return r.createElement("div",{className:"row"},r.createElement("div",{className:"col-sm-6"},Object(a.tv)(t)),r.createElement("div",{className:"col-sm-6"},r.createElement(o.Field,{name:"packs"})))}),this.packsRow=(e=>{let{pack:t,quantity:i,price:n}=e;return r.createElement("div",{className:"d-flex align-items-center"},r.createElement("div",{className:"d-flex flex-grow-1"},r.createElement("div",{className:"flex-grow-1"},Object(a.tv)(t)),r.createElement("div",{className:"w-6c mr-4 text-right"},r.createElement("span",{className:"text-danger h5"},n),"\u5143")),r.createElement(o.Field,{name:"quantity"}))}),this.uiSchema={selectable:!0,deletable:!0,restorable:!0,items:{list:{widget:"arr",Templet:this.productRow,ArrContainer:(e,t)=>t,RowContainer:e=>r.createElement("div",{className:"p-3"},e),items:{packs:{widget:"arr",Templet:this.packsRow,selectable:!1,deletable:!1,ArrContainer:(e,t)=>t,RowContainer:e=>e,RowSeperator:r.createElement("div",{className:"border border-gray border-top my-3"}),items:{quantity:{widget:"custom",className:"text-center",WidgetClass:E,onChanged:this.onQuantityChanged}}}}}}},this.cartData={list:[{product:{discription:"aaa"},packs:[{pack:{name:"1g"},quantity:10,price:12.1},{pack:{name:"10g"},quantity:12,price:22.1}]},{product:{discription:"bbb"},packs:[{pack:{name:"1g"},quantity:13,price:12.1},{pack:{name:"10g"},quantity:14,price:22.1}]}]},this.page=(()=>{let{cart:e}=this.controller,t={list:e.items.map(e=>({product:e.product,packs:[{pack:e.pack,quantity:e.quantity,price:e.price}]}))};return r.createElement(r.Fragment,null,r.createElement("header",{className:"p-3 text-center"},"\u8d2d\u7269\u8f66"),r.createElement(o.Form,{className:"bg-white",schema:C,uiSchema:this.uiSchema,formData:t}),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-12"},r.createElement(v.e,{items:e.items,item:{render:this.onCartItemRender}}))),r.createElement("footer",null,r.createElement(this.CheckOutButton,null)))})}showEntry(){return s.a(this,void 0,void 0,function*(){this.openPage(this.page)})}render(e){return this.page()}}var N=i(14),x=i.n(N);class S{constructor(e){this.calcSum=(()=>{let e=this.items.reduce((e,t)=>{let{isDeleted:i,quantity:r,price:n,checked:s}=t,{count:o,amount:a}=e;return!0===i?e:n===Number.NaN||r===Number.NaN?e:{count:o+r,amount:a+(!0!==s?0:r*n)}},{count:0,amount:0}),{count:t,amount:i}=e;this.count.set(t),this.amount.set(i)}),this.items=[],this.count=l.l.box(0),this.amount=l.l.box(0),this.productTuid=e.tuid("productx"),this.packTuid=e.tuidDiv("productx","packx"),this.disposer=Object(l.d)(this.calcSum)}dispose(){this.disposer()}AddToCart(e,t,i,r,n){return s.a(this,void 0,void 0,function*(){let s=this.items.find(e=>e.pack.id===t.id);s?(s.quantity=i,s.price=r):(s=this.createCartItem(e,t,i,r,n),this.items.push(s)),yield this.storeCart(s)})}createCartItem(e,t,i,r,n){return{checked:!0,pack:t,product:e,price:r,currency:n,quantity:i,isDeleted:!1,createdate:Date.now()}}updateChecked(e,t){return s.a(this,void 0,void 0,function*(){let i=this.items.find(t=>t.pack.id===e.pack.id);i&&(i.checked=t)})}updateQuantity(e,t){return s.a(this,void 0,void 0,function*(){let i=this.items.find(t=>t.pack.id===e.pack.id);i&&(t<=0?this.removeFromCart([i]):(i.quantity=t,yield this.storeCart(i)))})}removeDeletedItem(){return s.a(this,void 0,void 0,function*(){let e=this.items.filter(e=>!0===e.isDeleted);e&&e.length>0&&(yield this.removeFromCart(e))})}getSelectItem(){let e=this.items.filter(e=>e.checked&&!(!0===e.isDeleted));if(e&&0!==e.length)return e}getItem(e){return this.items.find(t=>t.pack.id===e)}}s.b([l.l],S.prototype,"items",void 0);class P extends S{constructor(e,t){super(e),this.addToCartAction=t.action("addtocart"),this.getCartQuery=t.query("getcart"),this.setCartAction=t.action("setcart"),this.removeFromCartAction=t.action("removefromcart")}load(){return s.a(this,void 0,void 0,function*(){let e=yield this.getCartQuery.page(void 0,0,100);this.items.push(...e)})}storeCart(e){return s.a(this,void 0,void 0,function*(){yield this.setCartAction.submit(e)})}removeFromCart(e){return s.a(this,void 0,void 0,function*(){yield this.removeFromCartAction.submit({rows:e}),x.a.pullAllBy(this.items,e,"pack.id")})}}const O="cart";class F extends S{constructor(e){super(e)}load(){return s.a(this,void 0,void 0,function*(){let e=window.localStorage.getItem(O),t=JSON.parse(e);t&&t.length>0&&(t.forEach(e=>{e.product=this.productTuid.boxId(e.product),e.pack=this.packTuid.boxId(e.pack)}),this.items.push(...t))})}storeCart(e){return s.a(this,void 0,void 0,function*(){window.localStorage.setItem(O,JSON.stringify(this.items.map(e=>{e.product.id,e.pack.id,e.price,e.currency&&e.currency.id,e.quantity})))})}removeFromCart(e){return s.a(this,void 0,void 0,function*(){x.a.remove(this.items,e=>!0===e.isDeleted),yield this.storeCart(void 0)})}}class V extends o.Controller{constructor(e,t){super(t),this.renderCart=(()=>this.renderView(k)),this.checkOut=(()=>s.a(this,void 0,void 0,function*(){if(this.isLogined){let e=this.cart.getSelectItem();if(void 0===e)return;let{cOrder:t}=this.cApp;yield t.start(e)}else;})),this.tab=(()=>r.createElement(this.renderCart,null)),this.cApp=e;let{cUsqOrder:i,cUsqProduct:n,currentUser:o}=this.cApp;o.isLogined?this.cart=new P(n,i):this.cart=new F(n)}internalStart(e){return s.a(this,void 0,void 0,function*(){this.showVPage(k)})}onDispose(){this.cart.removeDeletedItem()}renderCartLabel(){return this.renderView(f)}}const A=[{name:"list",type:"arr",arr:[{name:"pack",type:"object"},{name:"retail",type:"number"},{name:"vipPrice",type:"number"},{name:"currency",type:"string"},{name:"quantity",type:"number"}]}];class I extends o.VPage{constructor(){super(...arguments),this.onQuantityChanged=((e,t,i)=>s.a(this,void 0,void 0,function*(){let{data:i}=e,{pack:r}=i,{retail:n,currency:s}=r,{cApp:o,productBox:a}=this.controller,{cCart:l}=o;yield l.cart.AddToCart(a,r,t,n,s)})),this.arrTemplet=(e=>{let t,{pack:i}=e,{retail:n,vipPrice:s,inventoryAllocation:l,futureDeliveryTimeDescription:c}=i,u=r.createElement(r.Fragment,null);n&&(t=r.createElement("div",{className:"d-flex"},r.createElement(o.Field,{name:"quantity"})),u=r.createElement("div",null,"retail:",n," vipPrice:",s));let h=r.createElement(r.Fragment,null);return h=l.length>0?l.map((e,t)=>r.createElement("div",{key:t},Object(a.tv)(e.warehouse,e=>r.createElement(r.Fragment,null,e.name)),e.deliveryTimeDescription)):r.createElement("div",null,c),r.createElement(v.d,{className:"mx-3",right:t},r.createElement("div",null,Object(a.tv)(i)),u,h)}),this.page=Object(m.a)(()=>{let{product:e,cApp:t}=this.controller,i=t.cHome.renderSearchHeader(),n=t.cCart.renderCartLabel();r.createElement(v.d,{className:"pt-3",right:"quantity  cart  favorite"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-2"},"SKU"),r.createElement("div",{className:"col-2"},"price"),r.createElement("div",{className:"col-2"},"vip price")));return r.createElement(o.Page,{header:i,right:n},r.createElement("div",{className:"px-2 py-2 bg-white"},Object(a.tv)(e,D)),r.createElement(o.Form,{schema:A,uiSchema:this.uiSchema,formData:this.data}))})}showEntry(e){return s.a(this,void 0,void 0,function*(){this.uiSchema={items:{list:{widget:"arr",Templet:this.arrTemplet,items:{quantity:{widget:"custom",className:"text-center",WidgetClass:E,onChanged:this.onQuantityChanged}},ArrContainer:(e,t)=>r.createElement("div",{className:"bg-white"},t),Rowseperator:r.createElement("div",{className:"border border-danger border-top"})}}},this.packRows=this.controller.buildPackRows(),this.data={list:this.packRows},this.openPage(this.page,e)})}}class T extends o.VPage{constructor(){super(...arguments),this.onProductClick=(e=>s.a(this,void 0,void 0,function*(){this.controller.showProductDetail(e)})),this.onScrollBottom=(()=>s.a(this,void 0,void 0,function*(){yield this.controller.pageProducts.more()})),this.page=Object(m.a)(()=>{let{pageProducts:e,cApp:t}=this.controller,i=t.cHome.renderSearchHeader(),n=t.cCart.renderCartLabel();return r.createElement(o.Page,{header:i,right:n,onScrollBottom:this.onScrollBottom},r.createElement(v.e,{before:"",items:e,item:{render:D,onClick:this.onProductClick},className:"bg-white px-2"}))})}showEntry(e){return s.a(this,void 0,void 0,function*(){let t=e;this.controller.pageProducts.first({key:t}),this.openPage(this.page)})}}class q extends o.PageItems{constructor(e){super(),this.firstSize=this.pageSize=3,this.searchProductQuery=e}load(e,t,i){return s.a(this,void 0,void 0,function*(){let{key:r}=e;return void 0===t&&(t=0),yield this.searchProductQuery.page({key:r},t,i)})}setPageStart(e){return void 0===e?0:e.id}}class j extends o.Controller{constructor(e,t){super(t),this.showProductDetail=(e=>s.a(this,void 0,void 0,function*(){this.productBox=e;let{currentSalesRegion:t,currentUser:i}=this.cApp,r=[];r.push(this.productTuid.load(e.id)),r.push(this.productChemicalMap.obj({product:e.id})),r.push(this.priceMap.table({product:e.id,salesRegion:t.id})),r.push(this.getFutureDeliveryTimeDescription(e.id,t.id));let n=yield Promise.all(r);this.product=n[0],this.productChemical=n[1],this.productChemical&&(this.product.chemical=this.productChemical.chemical,this.product.purity=this.productChemical.purity);let s=n[2],o=0;if(i.hasCustomer){let e=yield this.getCustomerDiscount.table({brand:this.product.brand.id,customer:i.currentCustomer.id});o=e&&e[0]&&e[0].discount}s.forEach(e=>{e.vipprice=e.price*(1-o),e.currency=t.currency.obj});for(let e=0;e<this.product.packx.length;e++){const i=this.product.packx[e];i.futureDeliveryTimeDescription=n[3],i.inventoryAllocation=yield this.getInventoryAllocations(this.product.id,i.id,t.id)}this.product.packx.forEach(e=>{let i=s.find(t=>t.pack.id===e.id);e.retail=i&&i.retail,e.vipPrice=i&&i.vipPrice,e.currency=t.currency}),this.showVPage(I,this.product)})),this.getInventoryAllocations=((e,t,i)=>s.a(this,void 0,void 0,function*(){return yield this.getInventoryAllocationQuery.table({product:e,pack:t,salesRegion:i})})),this.getFutureDeliveryTimeDescription=((e,t)=>s.a(this,void 0,void 0,function*(){let i=yield this.getFutureDeliveryTime.table({product:e,salesRegion:t});if(i.length>0)return i[0].deliveryTimeDescription})),this.cApp=e;let{cUsqProduct:i,cUsqCustomerDiscount:r,cUsqWarehouse:n}=e,o=i.query("searchProduct");this.pageProducts=new q(o),this.productTuid=i.tuid("productx"),this.packTuid=this.productTuid.divs.packx,this.productChemicalMap=i.map("productChemical"),this.priceMap=i.map("pricex"),this.getCustomerDiscount=r.query("getdiscount"),this.getInventoryAllocationQuery=n.query("getInventoryAllocation"),this.getFutureDeliveryTime=i.query("getFutureDeliveryTime")}internalStart(e){return s.a(this,void 0,void 0,function*(){this.showVPage(T,e)})}buildPackRows(){let e=[];for(let t of this.product.packx){let i={pack:t},r=this.cApp.cCart.cart.getItem(t.id);r&&(i.quantity=r.quantity),e.push(i)}return e}}function R(e){return r.createElement(r.Fragment,null,r.createElement("div",{className:"col-4 col-md-2 text-muted"},"\u54c1\u724c:"),r.createElement("div",{className:"col-8 col-md-4"},e.name))}function D(e,t){return r.createElement("div",{className:"row d-flex"},r.createElement("div",{className:"col-12"},r.createElement("div",{className:"row py-2"},r.createElement("div",{className:"col-12"},r.createElement("strong",null,e.description))),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-3"},r.createElement("img",{src:"favicon.ico",alt:"structure"})),r.createElement("div",{className:"col-9"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-4 col-md-2 text-muted"},"CAS:"),r.createElement("div",{className:"col-8 col-md-4"},e.CAS),r.createElement("div",{className:"col-4 col-md-2 text-muted"},"\u7eaf\u5ea6:"),r.createElement("div",{className:"col-8 col-md-4"},e.purity),r.createElement("div",{className:"col-4 col-md-2 text-muted"},"\u5206\u5b50\u5f0f:"),r.createElement("div",{className:"col-8 col-md-4"},e.molecularFomula),r.createElement("div",{className:"col-4 col-md-2 text-muted"},"\u5206\u5b50\u91cf:"),r.createElement("div",{className:"col-8 col-md-4"},e.molecularWeight),r.createElement("div",{className:"col-4 col-md-2 text-muted"},"\u4ea7\u54c1\u7f16\u53f7:"),r.createElement("div",{className:"col-8 col-md-4"},e.origin),Object(a.tv)(e.brand,R))))))}class U extends o.VPage{constructor(){super(...arguments),this.nullContact=(()=>r.createElement(r.Fragment,null,"\u8bf7\u70b9\u51fb\u8f93\u5165\u5730\u5740")),this.renderProduct=(e=>r.createElement("strong",null,e.description)),this.renderPack=(e=>r.createElement(r.Fragment,null,(1===e.radiox?"":e.radiox+"*")+e.radioy+e.unit)),this.renderItem=(e=>{let{product:t,pack:i,price:n,quantity:s}=e,o=r.createElement("img",{src:"favicon.ico",alt:"structure image"}),l=r.createElement("div",{className:"w-6c text-right"},r.createElement("span",{className:"text-primary"},s));return r.createElement(v.d,{left:o,right:l,className:"px-3 py-2"},r.createElement("div",{className:"px-3"},r.createElement("div",null,Object(a.tv)(t,this.renderProduct)),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-3"},Object(a.tv)(i,this.renderPack)),r.createElement("div",{className:"col-3"},r.createElement("strong",{className:"text-danger"},n))),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-12"},"\u8d27\u671f"))))}),this.renderOrderItem=(e=>r.createElement(r.Fragment,null,Object(a.tv)(e,this.renderItem),r.createElement("br",null))),this.page=Object(m.a)(()=>{let{orderData:e,submitOrder:t,openContactList:i}=this.controller,{orderItems:n,shippingContact:s}=e,l=r.createElement("button",{type:"button",className:"btn btn-danger w-100",onClick:t},"\u63d0\u4ea4\u8ba2\u5355",e.amount),c=r.createElement(v.b,{name:"chevron-right"});return r.createElement(o.Page,{header:"\u8ba2\u5355\u9884\u89c8",footer:l},r.createElement(v.d,{right:c,onClick:i,className:"px-3 py-3"},Object(a.tv)(s,void 0,void 0,this.nullContact)),r.createElement(v.e,{items:n,item:{render:this.renderOrderItem}}))})}showEntry(e){return s.a(this,void 0,void 0,function*(){this.openPage(this.page)})}}class L{constructor(){this.orderItems=[]}get amount(){return this.orderItems.reduce((e,t)=>e+t.subAmount,0)}}s.b([l.l],L.prototype,"shippingContact",void 0),s.b([l.l],L.prototype,"orderItems",void 0),s.b([l.e],L.prototype,"amount",null);class M{get subAmount(){return this.price*this.quantity}}s.b([l.l],M.prototype,"price",void 0),s.b([l.l],M.prototype,"quantity",void 0),s.b([l.e],M.prototype,"subAmount",null);class _ extends o.VPage{constructor(){super(...arguments),this.page=(e=>r.createElement(o.Page,null,r.createElement("div",null,e.no)))}showEntry(e){return s.a(this,void 0,void 0,function*(){this.openPage(this.page,e)})}}class B extends o.Controller{constructor(e,t){super(t),this.orderData=new L,this.createOrderFromCart=(e=>s.a(this,void 0,void 0,function*(){if(this.orderData.webUser=this.cApp.currentUser.id,void 0===this.orderData.shippingContact){let e=yield this.cApp.currentUser.getShippingContacts();if(e&&e.length>0){let t=e.find(e=>{if(!0===e.isDefault)return e});t||(t=e[0]),this.setContact(t.contact)}}void 0!==e&&e.length>0&&(this.orderData.currency=e[0].currency,this.orderData.orderItems=e.map((e,t)=>{var i=new M;return i.product=e.product,i.pack=e.pack,i.price=e.price,i.quantity=e.quantity,i}))})),this.setContact=(e=>{this.orderData.shippingContact=e}),this.submitOrder=(()=>s.a(this,void 0,void 0,function*(){if(!this.orderData.shippingContact)return void this.openContactList();let e=yield this.orderSheet.save("order",this.orderData);yield this.orderSheet.action(e.id,e.flow,e.state,"submit"),this.cApp.cCart.cart.removeFromCart(this.orderData.orderItems),this.closePage(1),this.showVPage(_,e)})),this.openContactList=(()=>{this.cApp.cUser.start()}),this.cApp=e;let{cUsqOrder:i}=e;this.orderSheet=i.sheet("order")}internalStart(e){return s.a(this,void 0,void 0,function*(){let t=e;yield this.createOrderFromCart(t),this.showVPage(U)})}}s.b([l.l],B.prototype,"orderData",void 0);var H=i(91),K=i.n(H);class W extends o.View{render(){let e=r.createElement(v.b,{name:"globe"}),t=(r.createElement("div",null,"\u767b\u5f55"),r.createElement("img",{className:"m-1",src:K.a,alt:"logo"})),i=r.createElement("div",{className:"d-flex flex-row mr-1 align-items-center"},e," \xa0");return r.createElement(v.d,{className:"align-items-end pb-1",left:t,right:i},r.createElement("div",{className:"h4 px-3 mb-0"},"\u767e\u7075\u5a01\u79d1\u6280"))}}class Q extends o.View{constructor(){super(...arguments),this.onSearch=(e=>s.a(this,void 0,void 0,function*(){let{cProduct:t}=this.controller.cApp;t.start(e)}))}render(e){return r.createElement(v.i,{className:"px-1 my-2 w-100",onSearch:this.onSearch,placeholder:"Search product name, CAS, MDL etc."})}}const J=5;class z extends o.View{constructor(){super(...arguments),this.renderSection=((e,t)=>r.createElement("section",null,r.createElement("h4",null,e.title,r.createElement("small",{className:"text-muted"},e.subtitle)),r.createElement("p",null,e.content))),this.page=Object(m.a)(()=>{let{openMetaView:e}=this.controller,t=r.createElement(r.Fragment,null);return this.controller.isLogined&&this.controller.user.id===J&&(t=r.createElement("button",{type:"button",className:"btn w-100",onClick:e},"view")),r.createElement(o.Page,{header:!1,footer:t},this.content())}),this.content=(()=>{let e=this.controller.renderSiteHeader();return r.createElement(r.Fragment,null,e,this.controller.renderSearchHeader(),this.controller.renderCategoryRootList())})}showEntry(e){return s.a(this,void 0,void 0,function*(){this.openPage(this.page)})}render(e){return r.createElement(this.content,null)}}class X extends o.Controller{constructor(e,t){super(t),this.renderSiteHeader=(()=>this.renderView(W)),this.renderSearchHeader=(()=>this.renderView(Q)),this.renderCategoryRootList=(()=>{let{cProductCategory:e}=this.cApp;return e.renderRootList()}),this.renderHome=(()=>this.renderView(z)),this.openMetaView=(()=>{this.cApp.startDebug()}),this.tab=(()=>r.createElement(this.renderHome,null)),this.cApp=e}internalStart(e){return s.a(this,void 0,void 0,function*(){let{cProductCategory:e}=this.cApp;yield e.start(),this.showVPage(z)})}}class Z extends o.View{constructor(){super(...arguments),this.categoryClick=(e=>s.a(this,void 0,void 0,function*(){yield this.controller.openMainPage(e)})),this.onRootCategoryRender=((e,t)=>{let{productCategory:i,name:n,children:s}=e,o=r.createElement("div",{className:"h4"},n);return r.createElement("div",{className:"row bg-light py-2"},r.createElement("div",{className:"col-12"},r.createElement(v.d,{left:o,right:"\u66f4\u591a...",className:"px-3 cursor-pointer",onClick:()=>this.categoryClick(e)})),r.createElement("div",{className:"col-12"},r.createElement("div",{className:"row mx-3 cussor-pointer"},s&&s.map((e,t)=>r.createElement("div",{className:"col-12 col-md-4 py-2",onClick:()=>this.categoryClick(e),key:t},e.name,r.createElement("hr",{className:"my-1"}))))))})}render(e){let{rootCategories:t}=this.controller;return r.createElement(v.e,{items:t,item:{render:this.onRootCategoryRender},className:"mx-1"})}}class G extends o.VPage{constructor(){super(...arguments),this.renderChild=(e=>r.createElement("div",{className:"py-2"},r.createElement(v.b,{name:"hand-o-right mr-2"}),e.name)),this.catClick=(e=>s.a(this,void 0,void 0,function*(){yield this.controller.openMainPage(e)})),this.page=(e=>{let{cHome:t}=this.controller.cApp,i=t.renderSearchHeader(),n=this.controller.cApp.cCart.renderCartLabel(),{name:s,children:a}=e;return r.createElement(o.Page,{header:i,right:n},r.createElement("h3",null,s),r.createElement("hr",null),r.createElement(v.e,{items:a,item:{render:this.renderChild,onClick:this.catClick},className:"bg-white px-2"}))})}showEntry(e){return s.a(this,void 0,void 0,function*(){this.openPage(this.page,e)})}}class Y extends o.Controller{constructor(e,t){super(t),this.rootCategories=[],this.renderRootList=(()=>this.renderView(Z)),this.cApp=e;let{cUsqProduct:i}=this.cApp;this.getRootCategoryQuery=i.query("getRootCategory"),this.getChildrenCategoryQuery=i.query("getChildrenCategory")}internalStart(e){return s.a(this,void 0,void 0,function*(){let{currentSalesRegion:e,currentLanguage:t}=this.cApp,i=yield this.getRootCategoryQuery.query({salesRegion:e.id,language:t.id});this.rootCategories=i.ret;let r=i.sub;this.rootCategories.forEach(e=>s.a(this,void 0,void 0,function*(){e.children=r.filter(t=>t.parent===e.productCategory.id)}))})}getCategoryChildren(e){return s.a(this,void 0,void 0,function*(){return yield this.getChildrenCategoryQuery.table({parent:e})})}openMainPage(e){return s.a(this,void 0,void 0,function*(){let{productCategory:t,children:i}=e;t.obj.isleaf||(i||(e.children=yield this.getCategoryChildren(e.id)),this.showVPage(G,e))})}}s.b([l.l],Y.prototype,"rootCategories",void 0);class $ extends o.VPage{constructor(){super(...arguments),this.onContactRender=(e=>{let{contact:t}=e,{onContactEdit:i,onContactSelected:n}=this.controller,s=r.createElement("div",{className:"p-2 cursor-pointer text-info",onClick:()=>i(e)},r.createElement(v.b,{name:"edit"}));return r.createElement(v.d,{right:s,className:"px-3 py-2"},r.createElement("div",{onClick:()=>n(t)},Object(a.tv)(t)))}),this.page=(()=>{let{onContactEdit:e,userShippingContacts:t}=this.controller,i=r.createElement("button",{type:"button",className:"btn btn-primary w-100",onClick:()=>e()},"\u6dfb\u52a0\u65b0\u5730\u5740");return r.createElement(o.Page,{footer:i,header:"\u7ba1\u7406\u5730\u5740"},r.createElement(v.e,{items:t,item:{render:this.onContactRender},none:"\u4f60\u8fd8\u6ca1\u6709\u8bbe\u7f6e\u6536\u8d27\u5730\u5740\uff0c\u8bf7\u6dfb\u52a0\u65b0\u5730\u5740"}))})}showEntry(){return s.a(this,void 0,void 0,function*(){this.openPage(this.page)})}}const ee=[{name:"id",type:"id",required:!1},{name:"name",type:"string",required:!0},{name:"organizationName",type:"string",required:!0},{name:"mobile",type:"string",required:!0},{name:"telephone",type:"string",required:!1},{name:"email",type:"string",required:!1},{name:"address",type:"id",required:!1},{name:"addressString",type:"string",required:!0},{name:"isDefault",type:"integer",required:!0},{name:"submit",type:"submit"}],te={items:{name:{widget:"text",label:"\u59d3\u540d",visible:!1},organizationName:{widget:"text",label:"\u5355\u4f4d\u540d\u79f0"},mobile:{widget:"text",label:"\u624b\u673a\u53f7"},telephone:{widget:"text",label:"\u7535\u8bdd"},email:{widget:"email",label:"email",rules:e=>e&&!/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(e)?"email\u683c\u5f0f\u4e0d\u6b63\u786e\u3002":void 0},address:{widget:"id",label:"address"},addressString:{widget:"text",label:"\u8be6\u7ec6\u5730\u5740",rules:e=>e&&e.length<8?"\u8be6\u7ec6\u5730\u5740\u4e0d\u80fd\u5c0f\u4e8e8\u4e2a\u5b57\u7b26\u3002":void 0},isDefault:{widget:"checkbox",label:"\u4f5c\u4e3a\u9ed8\u8ba4\u5730\u5740"},submit:{widget:"button",label:"\u63d0\u4ea4"}}};class ie extends o.VPage{constructor(){super(...arguments),this.contactData={},this.saveContact=(()=>s.a(this,void 0,void 0,function*(){})),this.onFormButtonClick=((e,t)=>s.a(this,void 0,void 0,function*(){t.form.data.isDefault?t.form.data.isDefault=1:t.form.data.isDefault=0,yield this.controller.saveContact(t.form.data)})),this.page=(()=>{let e=r.createElement("button",{type:"button",className:"btn btn-primary w-100",onClick:this.saveContact},"\u4fdd\u5b58\u5e76\u4f7f\u7528");return r.createElement(o.Page,{header:"\u6dfb\u52a0\u6536\u8d27\u4eba",footer:e},r.createElement("div",{className:"App-container container text-left"},r.createElement(o.Form,{schema:ee,uiSchema:te,formData:this.contactData,onButtonClick:this.onFormButtonClick,fieldLabelSize:3,className:"my-3"})))})}showEntry(e){return s.a(this,void 0,void 0,function*(){if(void 0!==e.shippingContact){let{shippingContact:t}=e;this.contactData={id:t.id,name:t.name,organizationName:t.organizationName,mobile:t.mobile,telephone:t.telephone,email:t.email,addressString:t.addressString,isDefault:t.isDefault}}this.openPage(this.page)})}}class re extends o.Controller{constructor(e,t){super(t),this.userShippingContacts=[],this.onContactEdit=(e=>s.a(this,void 0,void 0,function*(){let t={};void 0!==e&&(t.shippingContact=yield this.contactTuid.load(e.contact.id)),this.showVPage(ie,t)})),this.saveContact=(e=>s.a(this,void 0,void 0,function*(){let t=yield this.contactTuid.save(void 0,e);yield this.cApp.currentUser.addShippingContact(t.id),void 0!==e.id&&this.cApp.currentUser.delShippingContact(e.id),this.backPage(),this.onContactSelected(e)})),this.onContactSelected=(e=>{let{cOrder:t}=this.cApp;t.setContact(e),this.backPage()}),this.cApp=e;let{cUsqCustomer:i}=e;this.contactTuid=i.tuid("contact")}internalStart(e){return s.a(this,void 0,void 0,function*(){this.userShippingContacts=yield this.cApp.currentUser.getShippingContacts(),this.showVPage($)})}}class ne extends o.VPage{constructor(){super(...arguments),this.content=(()=>{let{member:e,user:t}=this.controller,i=r.createElement("img",{src:t.icon,alt:"\u5934\u50cf"}),n=r.createElement("p",{className:"h4"},"\u6211\u7684\u79ef\u5206"),s=r.createElement("p",{className:"small align-self-end"},"\u67e5\u770b\u8be6\u60c5 ",r.createElement(v.b,{name:"angle-right"})),o=r.createElement(r.Fragment,null,r.createElement("p",{className:"h5 mb-0"},"0"),r.createElement(v.g,null,"\u672c\u5468")),a=r.createElement(r.Fragment,null,r.createElement("p",{className:"h5 mb-0"},e.point),r.createElement(v.g,null,"\u7d2f\u8ba1")),l=r.createElement("p",{className:"h4"},"\u6211\u7684\u7c89\u4e1d"),c=r.createElement("p",{className:"small align-self-end"},"\u67e5\u770b\u8be6\u60c5 ",r.createElement(v.b,{name:"angle-right"}));return r.createElement("div",null,r.createElement(v.d,{className:"shadow bg-white rounded p-3 mb-1",left:i},r.createElement("div",null,r.createElement("div",null,t.name),r.createElement("div",null,"\u9080\u8bf7\u7801:",e.recommendationCode))),r.createElement("div",{className:"shadow bg-white rounded p-3 mb-1"},r.createElement(v.d,{left:n,right:s}),r.createElement(v.d,{className:"pb-2"},r.createElement("p",{className:"h4 mb-0"},"0"),r.createElement(v.g,null,"\u4eca\u65e5")),r.createElement(v.d,{left:o,right:a})),r.createElement("div",{className:"shadow bg-white rounded p-3 mb-1"},r.createElement(v.d,{left:l,right:c}),r.createElement(v.d,{className:"pb-2"},r.createElement("p",{className:"h4 mb-0"},"0"),r.createElement(v.g,null,"\u4eca\u65e5")),r.createElement(v.d,{left:o,right:a})))})}showEntry(e){return s.a(this,void 0,void 0,function*(){})}render(e){return r.createElement(this.content,null)}}class se extends o.Controller{constructor(e,t){super(t),this.renderMember=(()=>this.renderView(ne)),this.render=Object(m.a)(()=>void 0===this.member?r.createElement(o.Loading,null):this.renderMember()),this.tab=(()=>r.createElement(this.render,null)),this.cApp=e}internalStart(e){return s.a(this,void 0,void 0,function*(){let e=this.cApp.cUsqMember.tuid("member"),t=yield e.load(this.user.id),i=this.cApp.cUsqMember.query("getPoint"),r=yield i.obj({member:t.id});t.point=void 0===r?0:r.point,this.member=t})}}s.b([l.l],se.prototype,"member",void 0);class oe{constructor(e){this.webUserCustomerMap=e.map("webUserCustomer"),this.webUserShippingContactMap=e.map("webUserConsigneeContact")}set user(e){void 0!==e&&(this._user=e,this.id=e.id,this.name=e.name,this.nick=e.nick,this.icon=e.icon,this.guest=e.guest,this.token=e.token,void 0!==this._user&&this.webUserCustomerMap.obj({webUser:this.id}).then(e=>{void 0!=e&&(this.currentCustomer=new ae(e.Customer))}))}get isLogined(){return void 0!==this._user}get hasCustomer(){return void 0!==this.currentCustomer}getShippingContacts(){return s.a(this,void 0,void 0,function*(){return void 0!==this.currentCustomer&&(yield this.currentCustomer.getShippingContacts()),this.webUserShippingContactMap.table({webUser:this.id})})}addShippingContact(e){return s.a(this,void 0,void 0,function*(){void 0!==this.currentCustomer&&(yield this.currentCustomer.addShippingContact(e)),yield this.webUserShippingContactMap.add({webUser:this.id,arr1:[{contact:e}]})})}delShippingContact(e){return s.a(this,void 0,void 0,function*(){void 0!==this.currentCustomer&&(yield this.currentCustomer.delShippingContact(e)),yield this.webUserShippingContactMap.del({webUser:this.id,arr1:[{contact:e}]})})}}class ae{constructor(e){}getShippingContacts(){return s.a(this,void 0,void 0,function*(){return yield this.shippingContactMap.table({customer:this.id})})}addShippingContact(e){return s.a(this,void 0,void 0,function*(){yield this.shippingContactMap.add({webUser:this.id,arr1:[{contact:e}]})})}delShippingContact(e){return s.a(this,void 0,void 0,function*(){yield this.shippingContactMap.del({webUser:this.id,arr1:[{contact:e}]})})}}var le=i(29);const ce={content:e=>{let t=e;r.createElement("div",null,"image");return r.createElement("div",{className:"row d-flex"},r.createElement("div",{className:"col-12"},r.createElement("div",{className:"row py-2"},r.createElement("div",{className:"col-12"},r.createElement("strong",null,t.description))),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-3"},r.createElement("img",{src:"favicon.ico",alt:"structure"})),r.createElement("div",{className:"col-9"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-4 col-md-2 text-muted"},"\u4ea7\u54c1\u7f16\u53f7:"),r.createElement("div",{className:"col-8 col-md-4"},t.origin))))))},divs:{packx:{content:e=>{let{radiox:t,radioy:i,unit:n}=e;return r.createElement(r.Fragment,null,t," ",i," ",n)}}}};const ue={content:e=>{let{children:t}=e;return r.createElement(r.Fragment,null,"aaa")}};var he={CApp:class extends a.CApp{internalStart(){return s.a(this,void 0,void 0,function*(){this.cUsqOrder=this.getCUsq(le.a.usqOrder),this.cUsqProduct=this.getCUsq(le.a.usqProduct),this.cUsqCommon=this.getCUsq(le.a.usqCommon),this.cUsqWebUser=this.getCUsq(le.a.usqWebUser),this.cUsqCustomer=this.getCUsq(le.a.usqCustomer),this.cUsqCustomerDiscount=this.getCUsq(le.a.usqCustomerDiscount),this.cUsqWarehouse=this.getCUsq(le.a.usqWarehouse),this.cUsqMember=this.getCUsq(le.a.usqMember);let e=this.cUsqCommon.tuid("salesregion");this.currentSalesRegion=yield e.load(1);let t=this.cUsqCommon.tuid("language");this.currentLanguage=yield t.load(197),this.currentUser=new oe(this.cUsqWebUser),this.isLogined&&(this.currentUser.user=this.user),this.cProductCategory=new Y(this,void 0),this.cCart=new V(this,void 0),this.cHome=new X(this,void 0),this.cProduct=new j(this,void 0),this.cOrder=new B(this,void 0),this.cUser=new re(this,void 0),this.cMember=new se(this,void 0);let i=[];i.push(this.cCart.cart.load()),i.push(this.cProductCategory.start()),yield Promise.all(i),this.showVPage(this.VAppMain)})}},main:class extends o.VPage{constructor(){super(...arguments),this.render=(e=>{let{cHome:t,cMember:i,cCart:n}=this.controller,s=[{name:"home",label:"\u9996\u9875",icon:"home",content:t.tab,notify:d.homeCount},{name:"member",label:"\u4f1a\u5458",icon:"vcard",content:i.tab},{name:"cart",label:"\u8d2d\u7269\u8f66",icon:"shopping-cart",content:n.tab,notify:n.cart.count},{name:"me",label:"\u6211\u7684",icon:"user",content:h}].map(e=>{let{name:t,label:i,icon:r,content:n,notify:s}=e;return{name:t,caption:e=>Object(o.TabCaptionComponent)(i,r,p(e)),content:n,notify:s}});return r.createElement(o.Page,{header:!1},r.createElement(o.Tabs,{tabs:s}))})}showEntry(e){return s.a(this,void 0,void 0,function*(){this.openPage(this.render)})}},usqs:{"\u767e\u7075\u5a01\u7cfb\u7edf\u5de5\u7a0b\u90e8/order":{tuid:{product:ce,productx:ce,address:{content:e=>{let{description:t}=e;return r.createElement("div",null,t)}},contact:{content:e=>r.createElement("div",null,"gee")}}},"\u767e\u7075\u5a01\u7cfb\u7edf\u5de5\u7a0b\u90e8/product":{tuid:{product:ce,productx:ce,productCategory:ue,productcategory:ue}},"\u767e\u7075\u5a01\u7cfb\u7edf\u5de5\u7a0b\u90e8/webUser":{tuid:{contact:{content:e=>{let{name:t,mobile:i,addressString:n}=e;return r.createElement("div",null,r.createElement("b",null,t),"\xa0 ",i,r.createElement("br",null),n)}}}}}};const de="\u767e\u7075\u5a01\u7cfb\u7edf\u5de5\u7a0b\u90e8/cart";var pe=class extends r.Component{constructor(){super(...arguments),this.onLogined=(()=>s.a(this,void 0,void 0,function*(){yield Object(a.startApp)(de,he)}))}render(){return r.createElement(o.NavView,{onLogined:this.onLogined,notLogined:this.onLogined})}};const me=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function fe(e){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=(()=>{const t=e.installing;t&&(t.onstatechange=(()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}))})}).catch(e=>{console.error("Error during service worker registration:",e)})}i(134),i(136);n.render(r.createElement(pe,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL(".",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="./service-worker.js";me?(function(e){fetch(e).then(t=>{404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):fe(e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):fe(e)})}}()}],[[94,4,3]]]);
//# sourceMappingURL=main.36284fc3.chunk.js.map